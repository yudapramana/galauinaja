import{_ as $,e as l,f as j,c as S,o as U,b as N,a as n,F as B,I as C,$ as I,m as D,q as E}from"./app-DLkmHih5.js";import"./style-DWeoiJEL.js";import{u as T}from"./MasterDataStore-Dmg8ax9J.js";import"./LoadingStore-Eh2G7Em_.js";const R={__name:"WorkUnitMonitor",setup(A){const y=D(),d=l([]),f=l(new Map),g=l(!1),v=l(null);l(new Map);const u=t=>String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),h=t=>{const e=new Map,a=s=>{var o;for(const i of s)e.set(String(i.id),i),(o=i.children)!=null&&o.length&&a(i.children)};return a(t),e},k=()=>d.value.map(e=>({id:String(e.id),text:u(e.unit_name),type:"workunit",children:!0})),b=t=>{const e=f.value.get(String(t));return e?(e.children||[]).map(s=>({id:String(s.id),text:u(s.unit_name),type:"workunit",children:!0})):[]},w=async t=>{const e=String(t);if(r.employeesCacheByUnit[e])return r.employeesCacheByUnit[e];const a=await E.get(`/api/work-units/${e}/employees`),s=Array.isArray(a.data)?a.data:a.data.data??[];return r.setEmployees(e,s),s},m=async()=>{await C();const t=I("#tree-container");t.jstree(!0)&&t.jstree(!0).destroy(),t.off("click",".js-doc-link"),t.off(".jstree").jstree({core:{check_callback:!0,themes:{stripes:!0},html_titles:!0,data:async(e,a)=>{try{if(e.id==="#"){a(k());return}if(e.type==="employee"){a([]);return}const s=e.id,o=b(s),p=(await w(s)).map(c=>{const x=Number(c.progress_dokumen??0).toFixed(2),M=u(c.full_name);return{id:`emp-${s}-${c.id}`,type:"employee",children:!1,text:`
                  <span class="emp-label">${M} â€” ${x}%</span>
                  <a href="#"
                     class="badge badge-sm badge-info ml-2 js-doc-link"
                     data-user-id="${c.id}">
                     <i class="far fa-folder"></i> dokumen
                  </a>
                `}});if(o.length===0&&p.length===0){a([{id:`info-empty-${s}`,text:"Belum ada data.",type:"info",children:!1,li_attr:{class:"text-muted"}}]);return}a([...o,...p])}catch{a([{id:`info-error-${e.id}-${Date.now()}`,text:"Gagal memuat data.",type:"info",children:!1,li_attr:{class:"text-danger"}}])}}},plugins:["types","state"],state:{key:"monitor-tree-v1"},types:{workunit:{icon:"far fa-folder"},employee:{icon:"far fa-user"},info:{icon:"far fa-circle"}}}),v.value=t.jstree(!0),g.value=!0,t.on("click",".js-doc-link",e=>{e.preventDefault(),e.stopPropagation();const a=e.currentTarget.getAttribute("data-user-id");a&&y.push(`/admin/users/${a}/documents`)}),t.on("select_node.jstree",(e,a)=>{})},_=async()=>{r.clearEmployeesCache(),await m()},r=T();return j(async()=>{r.hydrateEmployeesCache(),await r.getWorkUnitMonitorList();const t=r.workUnitMonitorList;console.log("resMaster"),console.log(t),d.value=t.data||[],f.value=h(d.value),await m()}),(t,e)=>(U(),S(B,null,[e[2]||(e[2]=N('<div class="content-header" data-v-806e0f70><div class="container-fluid" data-v-806e0f70><div class="row mb-2" data-v-806e0f70><div class="col-sm-6" data-v-806e0f70><h1 class="m-0" data-v-806e0f70>Monitor Satuan Kerja</h1></div><div class="col-sm-6" data-v-806e0f70><ol class="breadcrumb float-sm-right" data-v-806e0f70><li class="breadcrumb-item" data-v-806e0f70><a href="#" data-v-806e0f70>Home</a></li><li class="breadcrumb-item active" data-v-806e0f70>Daftar Satker</li></ol></div></div></div></div>',1)),n("div",{class:"content"},[n("div",{class:"container-fluid"},[n("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e[0]||(e[0]=n("h5",{class:"mb-0"},"Monitoring Pegawai",-1)),n("button",{class:"btn btn-sm btn-primary",onClick:_},"Refresh")]),e[1]||(e[1]=n("div",{id:"tree-container"},null,-1))])])],64))}},L=$(R,[["__scopeId","data-v-806e0f70"]]);export{L as default};
