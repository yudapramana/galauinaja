import{A as oe,r as d,B as H,C as U,f as re,c as l,o as i,a as e,t as o,s as k,d as C,k as G,v as z,F as V,D as J,n as S,j as I,E as de,m as q,x as b,G as ue}from"./app-DAaZhZ-B.js";import{S as f}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const me={class:"content-header"},ce={class:"container-fluid d-flex justify-content-between align-items-end"},pe={class:"d-flex align-items-center"},ve={class:"badge badge-info mr-3"},fe={class:"btn-group"},ge=["disabled"],ke={key:0,class:"fas fa-spinner fa-spin mr-1"},be={class:"content"},_e={class:"container-fluid"},ye={class:"card"},he={class:"card-header d-flex"},xe={class:"card-body table-responsive p-0"},we={class:"table table-bordered table-hover text-sm"},De={key:0},Ce={key:1},Ae={class:"text-truncate",style:{"max-width":"240px"}},Me=["onClick"],Pe={key:1,type:"button",class:"btn btn-warning btn-sm mr-1 mb-1",disabled:""},Ge=["onClick","disabled"],Ve={key:0,class:"fas fa-spinner fa-spin mr-1"},Se={class:"card-footer clearfix"},Ie={class:"d-flex justify-content-between align-items-center"},Ne={class:"text-muted"},je={class:"pagination pagination-sm m-0"},Fe={class:"page-item disabled"},Le={class:"page-link"},Re={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},$e={class:"modal-dialog modal-xl",role:"document"},Be={class:"modal-content"},Ee={class:"modal-body row"},Te={class:"col-md-7"},He={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},Ue=["src"],ze={key:1,class:"text-muted text-center py-5"},Je={key:0},qe={key:1},Ke={class:"col-md-5"},Oe={class:"mb-3"},Ye={class:"table table-bordered table-sm"},Qe=["innerHTML"],We={style:{"font-size":"smaller"}},Xe={class:"form-group"},Ze={key:0,class:"form-group"},et=["value"],tt={class:"form-group"},at={class:"text-end mt-3"},st=["disabled"],nt={key:0,class:"fas fa-spinner fa-spin me-1"},lt={key:1,type:"button",class:"btn btn-warning btn-sm mr-1 mb-1",disabled:""},dt={__name:"VervalList",setup(it){const _=oe();_.setting.maintenance=["1",1,!0,"true","on"].includes(_.setting.maintenance);const y=d(""),g=d([]),A=d(!1),h=d(!1),x=d(!1),w=d(null),D=d(null),K=H(()=>D.value===null?"—":D.value),O=d(null),c=d(!1),u=d(null),m=d({status:"",verif_notes:""}),Y=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Q=H(()=>{var t;const a=(t=u.value)==null?void 0:t.file_url;return a?Y?`https://docs.google.com/gview?url=${encodeURIComponent(a)}`:a:""}),r=d({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),W=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],M=async(a=1)=>{A.value=!0;try{const t=await b.get("/api/emp-documents",{params:{search:y.value,page:a,per_page:r.value.per_page}});g.value=t.data.data||[],r.value={...r.value,...t.data.meta,...t.data}}catch(t){console.error("Gagal memuat dokumen",t)}finally{A.value=!1}},X=async()=>{try{const{data:a}=await b.get("/api/emp-documents/remaining");D.value=typeof(a==null?void 0:a.remaining)=="number"?a.remaining:null}catch{D.value=null}},p=async()=>{await Promise.all([M(r.value.current_page),X()])},Z=async()=>{var a,t;x.value=!0;try{const{data:n}=await b.post("/api/emp-documents/claim",{count:5});await p();const v=(n==null?void 0:n.claimed)??(Array.isArray(n==null?void 0:n.data)?n.data.length:n!=null&&n.data?1:0);f.fire({icon:"success",title:"Berhasil",text:`${v} dokumen berhasil diambil dari antrian.`,timer:1800,showConfirmButton:!1}),Array.isArray(n==null?void 0:n.data)&&n.data.length?P(n.data[0]):g.value.length&&P(g.value[0])}catch(n){const v=((t=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:t.message)||"Tidak ada dokumen tersedia untuk di-claim";f.fire({icon:"info",title:"Info",text:v})}finally{x.value=!1}},ee=async a=>{if(!(!(a!=null&&a.id)||!confirm("Lepaskan assignment dokumen ini? Dokumen akan kembali ke antrian umum."))){w.value=a.id;try{await b.post(`/api/emp-documents/${a.id}/release`),await p(),f.fire({icon:"success",title:"Dilepas",text:"Dokumen berhasil dilepas dari tugas Anda.",timer:1500,showConfirmButton:!1})}catch{f.fire({icon:"error",title:"Gagal",text:"Gagal melepas dokumen."})}finally{w.value=null}}},N=a=>{a>=1&&a<=r.value.last_page&&M(a)},P=a=>{u.value=a,m.value={status:a.status==="Pending"?"Approved":a.status,verif_notes:a.verif_notes||""},$("#verifModal").modal("show")},te=async()=>{h.value=!0;try{const a=await b.put(`/api/emp-documents/${u.value.id}/verify`,m.value);$("#verifModal").modal("hide"),await p(),f.fire({icon:"success",title:"Berhasil",text:a.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(a){let t="Gagal memverifikasi dokumen.";a.response&&(a.response.status===409&&a.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||a.response.data.message)&&(t=a.response.data.message),f.fire({icon:"error",title:"Verifikasi Gagal",text:t}),$("#verifModal").modal("hide"),await p()}finally{h.value=!1}},ae=a=>{const t=a.target.value;t&&(m.value.verif_notes=t)},se=()=>{c.value=!1},ne=()=>{c.value=!0};return U(()=>{var a;return(a=u.value)==null?void 0:a.file_url},async a=>{var t;if(c.value=!1,!!a)try{const n=await fetch(a,{method:"HEAD"});(!n.ok||!((t=n.headers.get("content-type"))!=null&&t.includes("pdf")))&&(c.value=!0)}catch{c.value=!0}}),U(y,ue(()=>M(1),300)),re(()=>p()),(a,t)=>{var n,v,j,F,L,R,B,E,T;return i(),l(V,null,[e("section",me,[e("div",ce,[t[7]||(t[7]=e("h1",{class:"mb-2"},"Verifikasi Dokumen Pegawai",-1)),e("div",pe,[e("span",ve," Sisa antrian: "+o(K.value),1),e("div",fe,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:Z,disabled:x.value},[x.value?(i(),l("i",ke)):k("",!0),t[6]||(t[6]=C(" Ambil 5 Dokumen "))],8,ge),e("button",{class:"btn btn-secondary btn-sm ml-2",onClick:p}," Refresh ")])])])]),e("section",be,[e("div",_e,[e("div",ye,[e("div",he,[G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai (tugas saya)..."},null,512),[[z,y.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:p}," Refresh ")]),e("div",xe,[e("table",we,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nama File"),e("th",null,"Status"),e("th",{style:{width:"160px"}},"Aksi")])],-1)),e("tbody",null,[A.value?(i(),l("tr",De,t[8]||(t[8]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):g.value.length===0?(i(),l("tr",Ce,t[9]||(t[9]=[e("td",{colspan:"7",class:"text-center"},[C(" Belum ada dokumen yang ditugaskan ke Anda. "),e("br"),e("small",{class:"text-muted"},"Klik “Ambil 5 Dokumen” untuk mengambil dari antrian umum.")],-1)]))):k("",!0),(i(!0),l(V,null,J(g.value,(s,le)=>(i(),l("tr",{key:s.id},[e("td",null,o(le+1+(r.value.current_page-1)*r.value.per_page),1),e("td",null,o(s.employee.full_name),1),e("td",null,o(s.employee.nip),1),e("td",null,o(s.doc_type.type_name),1),e("td",Ae,o(s.file_name),1),e("td",null,[e("span",{class:S({"badge badge-warning":s.status==="Pending","badge badge-success":s.status==="Approved","badge badge-danger":s.status==="Rejected"})},o(s.status),3)]),e("td",null,[q(_).setting.maintenance?(i(),l("button",Pe," Maintenance ")):(i(),l("button",{key:0,class:"btn btn-sm btn-primary mr-1 mb-1",onClick:ie=>P(s)}," Verifikasi ",8,Me)),e("button",{class:"btn btn-sm btn-outline-danger",onClick:ie=>ee(s),disabled:w.value===s.id,title:"Lepaskan assignment dokumen ini"},[w.value===s.id?(i(),l("i",Ve)):k("",!0),t[10]||(t[10]=C(" Lepas "))],8,Ge)])]))),128))])])]),e("div",Se,[e("div",Ie,[e("div",Ne," Menampilkan "+o(r.value.from)+" - "+o(r.value.to)+" dari "+o(r.value.total)+" dokumen (tugas saya) ",1),e("ul",je,[e("li",{class:S(["page-item",{disabled:r.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=I(s=>N(r.value.current_page-1),["prevent"]))},"«")],2),e("li",Fe,[e("span",Le,"Halaman "+o(r.value.current_page)+" / "+o(r.value.last_page),1)]),e("li",{class:S(["page-item",{disabled:r.value.current_page===r.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=I(s=>N(r.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Re,[e("div",$e,[e("div",Be,[t[23]||(t[23]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",Ee,[e("div",Te,[e("div",He,[(n=u.value)!=null&&n.file_url&&!c.value?(i(),l("iframe",{key:0,ref_key:"pdfFrame",ref:O,src:Q.value,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"},onLoad:se,onError:ne},null,40,Ue)):(i(),l("div",ze,[c.value?(i(),l("p",Je,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses.")):(i(),l("p",qe,"File tidak tersedia."))]))])]),e("div",Ke,[e("div",Oe,[e("table",Ye,[e("tbody",null,[e("tr",null,[t[12]||(t[12]=e("th",null,"Nama",-1)),e("td",null,o(((j=(v=u.value)==null?void 0:v.employee)==null?void 0:j.full_name)||"-"),1)]),e("tr",null,[t[13]||(t[13]=e("th",null,"NIP",-1)),e("td",null,o(((L=(F=u.value)==null?void 0:F.employee)==null?void 0:L.nip)||"-"),1)]),e("tr",null,[t[14]||(t[14]=e("th",null,"Jenis Dokumen",-1)),e("td",null,o(((B=(R=u.value)==null?void 0:R.doc_type)==null?void 0:B.type_name)||"-"),1)]),e("tr",null,[t[15]||(t[15]=e("th",null,"Parameter",-1)),e("td",{innerHTML:((E=u.value)==null?void 0:E.parameter)||"<i>no_param</i>"},null,8,Qe)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Filename",-1)),e("td",We,o(((T=u.value)==null?void 0:T.file_name)||"-"),1)])])])]),e("form",{onSubmit:I(te,["prevent"])},[e("div",Xe,[t[18]||(t[18]=e("label",null,"Status Verifikasi",-1)),G(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>m.value.status=s),class:"form-control",required:""},t[17]||(t[17]=[e("option",{value:"Approved"},"Disetujui",-1),e("option",{value:"Rejected"},"Ditolak",-1)]),512),[[de,m.value.status]])]),m.value.status==="Rejected"?(i(),l("div",Ze,[t[20]||(t[20]=e("label",null,"Pilih Alasan Penolakan (opsional)",-1)),e("select",{class:"form-control mb-2",onChange:t[4]||(t[4]=s=>ae(s))},[t[19]||(t[19]=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1)),(i(),l(V,null,J(W,s=>e("option",{key:s.code,value:s.note},o(s.code)+" - "+o(s.note),9,et)),64))],32)])):k("",!0),e("div",tt,[t[21]||(t[21]=e("label",null,"Catatan Verifikasi",-1)),G(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>m.value.verif_notes=s),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[z,m.value.verif_notes]])]),e("div",at,[q(_).setting.maintenance?(i(),l("button",lt," Maintenance ")):(i(),l("button",{key:0,type:"submit",class:"btn btn-sm btn-primary",disabled:h.value},[h.value?(i(),l("i",nt)):k("",!0),t[22]||(t[22]=C(" Simpan Verifikasi "))],8,st))])],32)])])])])])])],64)}}};export{dt as default};
