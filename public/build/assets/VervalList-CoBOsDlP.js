import{g as r,x as U,y as z,c as l,a as e,j as g,v as S,l as k,F as f,z as I,t as n,A as b,i as y,b as m,B as J,m as T,o as i,C as q}from"./app-DKYEko9h.js";import{S as A}from"./sweetalert2.all-B-44TrQ9.js";const H=e("section",{class:"content-header"},[e("div",{class:"container-fluid"},[e("h1",{class:"mb-2"},"Verifikasi Dokumen Pegawai")])],-1),O={class:"content"},Y={class:"container-fluid"},K={class:"card"},Q={class:"card-header d-flex"},W={class:"card-body table-responsive p-0"},X={class:"table table-bordered table-hover text-sm"},Z=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nomor"),e("th",null,"Tanggal"),e("th",null,"Status"),e("th",null,"Aksi")])],-1),ee={key:0},ae=e("td",{colspan:"8",class:"text-center"},"Memuat data...",-1),te=[ae],se={key:1},ne=e("td",{colspan:"8",class:"text-center"},"Tidak ada dokumen ditemukan.",-1),oe=[ne],le=["onClick"],ie={class:"card-footer clearfix"},de={class:"d-flex justify-content-between align-items-center"},ue={class:"text-muted"},re={class:"pagination pagination-sm m-0"},ce={class:"page-item disabled"},me={class:"page-link"},_e={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},pe={class:"modal-dialog modal-xl",role:"document"},ve={class:"modal-content"},he=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1),ge={class:"modal-body row"},ke={class:"col-md-7"},fe={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},be=["src"],ye={key:1,class:"text-muted text-center py-5"},xe=e("p",null,"File tidak tersedia.",-1),De=[xe],we={class:"col-md-5"},Ve={class:"mb-3"},Ne=e("strong",null,"Nama:",-1),Ce=e("strong",null,"NIP:",-1),Ge=e("strong",null,"Jenis Dokumen:",-1),Me=e("strong",null,"Nomor:",-1),je=e("strong",null,"Tanggal:",-1),Pe={class:"form-group"},Se=e("label",null,"Status Verifikasi",-1),Ie=e("option",{value:"Approved"},"Disetujui",-1),Te=e("option",{value:"Rejected"},"Ditolak",-1),Ae=[Ie,Te],Fe={key:0,class:"form-group"},Re=e("label",null,"Pilih Alasan Penolakan (opsional)",-1),$e=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1),Be=["value"],Ee={class:"form-group"},Le=e("label",null,"Catatan Verifikasi",-1),Ue={class:"text-end mt-3"},ze=["disabled"],Je={key:0,class:"fas fa-spinner fa-spin me-1"},Ke={__name:"VervalList",setup(qe){const _=r(""),v=r([]),h=r(!1),p=r(!1),d=r(null),u=r({status:"",verif_notes:""}),o=r({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),F=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],c=async(s=1)=>{h.value=!0;try{const t=await T.get("/api/emp-documents",{params:{search:_.value,page:s,per_page:o.value.per_page}});v.value=t.data.data,o.value={...o.value,...t.data.meta,...t.data}}catch(t){console.error("Gagal memuat dokumen",t)}finally{h.value=!1}},x=s=>{s>=1&&s<=o.value.last_page&&c(s)},R=s=>{d.value=s,u.value={status:s.status,verif_notes:s.verif_notes||""},$("#verifModal").modal("show")},B=async()=>{p.value=!0;try{const s=await T.put(`/api/emp-documents/${d.value.id}/verify`,u.value);$("#verifModal").modal("hide"),c(o.value.current_page),A.fire({icon:"success",title:"Berhasil",text:s.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(s){let t="Gagal memverifikasi dokumen.";s.response&&(s.response.status===409&&s.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||s.response.data.message)&&(t=s.response.data.message),A.fire({icon:"error",title:"Verifikasi Gagal",text:t}),$("#verifModal").modal("hide"),c(o.value.current_page)}finally{p.value=!1}},E=s=>{const t=s.target.value;t&&(u.value.verif_notes=t)};return U(_,q(()=>c(1),300)),z(()=>c()),(s,t)=>{var D,w,V,N,C,G,M,j,P;return i(),l(f,null,[H,e("section",O,[e("div",Y,[e("div",K,[e("div",Q,[g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai..."},null,512),[[S,_.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:c}," Refresh ")]),e("div",W,[e("table",X,[Z,e("tbody",null,[h.value?(i(),l("tr",ee,te)):v.value.length===0?(i(),l("tr",se,oe)):k("",!0),(i(!0),l(f,null,I(v.value,(a,L)=>(i(),l("tr",{key:a.id},[e("td",null,n(L+1+(o.value.current_page-1)*o.value.per_page),1),e("td",null,n(a.employee.full_name),1),e("td",null,n(a.employee.nip),1),e("td",null,n(a.doc_type.type_name),1),e("td",null,n(a.doc_number),1),e("td",null,n(a.doc_date),1),e("td",null,[e("span",{class:b({"badge badge-warning":a.status==="Pending","badge badge-success":a.status==="Approved","badge badge-danger":a.status==="Rejected"})},n(a.status),3)]),e("td",null,[e("button",{class:"btn btn-sm btn-primary mr-1",onClick:He=>R(a)}," Verifikasi ",8,le)])]))),128))])])]),e("div",ie,[e("div",de,[e("div",ue," Menampilkan "+n(o.value.from)+" - "+n(o.value.to)+" dari "+n(o.value.total)+" dokumen ",1),e("ul",re,[e("li",{class:b(["page-item",{disabled:o.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=y(a=>x(o.value.current_page-1),["prevent"]))},"«")],2),e("li",ce,[e("span",me,"Halaman "+n(o.value.current_page)+" / "+n(o.value.last_page),1)]),e("li",{class:b(["page-item",{disabled:o.value.current_page===o.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=y(a=>x(o.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",_e,[e("div",pe,[e("div",ve,[he,e("div",ge,[e("div",ke,[e("div",fe,[(D=d.value)!=null&&D.file_url?(i(),l("iframe",{key:0,src:d.value.file_url,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"}},null,8,be)):(i(),l("div",ye,De))])]),e("div",we,[e("div",Ve,[e("p",null,[Ne,m(" "+n((V=(w=d.value)==null?void 0:w.employee)==null?void 0:V.full_name),1)]),e("p",null,[Ce,m(" "+n((C=(N=d.value)==null?void 0:N.employee)==null?void 0:C.nip),1)]),e("p",null,[Ge,m(" "+n((M=(G=d.value)==null?void 0:G.doc_type)==null?void 0:M.type_name),1)]),e("p",null,[Me,m(" "+n((j=d.value)==null?void 0:j.doc_number),1)]),e("p",null,[je,m(" "+n((P=d.value)==null?void 0:P.doc_date),1)])]),e("form",{onSubmit:y(B,["prevent"])},[e("div",Pe,[Se,g(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>u.value.status=a),class:"form-control",required:""},Ae,512),[[J,u.value.status]])]),u.value.status==="Rejected"?(i(),l("div",Fe,[Re,e("select",{class:"form-control mb-2",onChange:t[4]||(t[4]=a=>E(a))},[$e,(i(),l(f,null,I(F,a=>e("option",{key:a.code,value:a.note},n(a.code)+" - "+n(a.note),9,Be)),64))],32)])):k("",!0),e("div",Ee,[Le,g(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=a=>u.value.verif_notes=a),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[S,u.value.verif_notes]])]),e("div",Ue,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:p.value},[p.value?(i(),l("i",Je)):k("",!0),m(" Simpan Verifikasi ")],8,ze)])],32)])])])])])])],64)}}};export{Ke as default};
