import{_ as ee,f as _e,g as _,N as Z,y as te,x as me,o,c as i,a as e,b as p,t as d,j as D,v as M,F as C,z as N,A as U,O as pe,l as f,i as ve,I as he,m as $,p as fe,e as be,P as ge,J as ye}from"./app-V0-BWaBe.js";import{S as L}from"./sweetalert2.all-oNAp2VCC.js";import{u as xe}from"./MasterDataStore-DJyB6e-k.js";import"./LoadingStore-DSiXWE7Q.js";const l=g=>(fe("data-v-7abcfe52"),g=g(),be(),g),ke={class:"content-header"},we={class:"container-fluid"},De={class:"text-primary"},Ce={class:"text-muted text-sm"},Ue=l(()=>e("i",{class:"fas fa-arrow-left mr-1"},null,-1)),Fe={class:"content"},Ie={class:"container-fluid"},Se={class:"card shadow-sm rounded-lg"},Pe={class:"card-body p-3"},Te={class:"input-group mb-3"},Ve={class:"input-group-append"},Me={key:0,class:"text-center p-5"},Ne=l(()=>e("div",{class:"spinner-border text-primary mb-2",role:"status"},null,-1)),$e=l(()=>e("div",{class:"text-muted"},"Memuat dokumen...",-1)),Le=[Ne,$e],Be={key:1,class:"tree"},je={class:"list-unstyled mb-0"},Re={class:"d-flex align-items-center justify-between cursor-pointer py-1 px-2 bg-light rounded small"},Ae=["onClick"],qe={class:"ml-2 font-weight-bold"},ze={class:"badge badge-pill badge-primary ml-2"},Ke=["onClick"],Ge={class:"pl-4 mt-1"},Ee={class:"d-flex align-items-center justify-content-between w-100"},Je=["onClick"],Oe=l(()=>e("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),Qe=["onClick"],He={key:0,class:"text-danger mt-1 ml-4 small"},We=l(()=>e("i",{class:"fas fa-info-circle"},null,-1)),Xe={key:0,class:"text-muted small ml-4 mt-1"},Ye={key:2,class:"text-center p-5"},Ze=l(()=>e("span",{class:"text-muted"},"Data tidak ditemukan.",-1)),et=[Ze],tt={key:0,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},st={class:"modal-dialog modal-xl"},at={class:"modal-content"},lt={class:"modal-header p-2"},ot=l(()=>e("h5",{class:"modal-title"},"ðŸ“„ Preview Dokumen",-1)),nt=l(()=>e("span",null,"Ã—",-1)),it=[nt],dt={class:"modal-body p-3"},rt={class:"row"},ct={class:"col-md-6 mb-3"},ut={class:"table table-sm table-bordered"},_t=l(()=>e("th",{style:{width:"40%"}},"Tipe Dokumen",-1)),mt=l(()=>e("th",null,"Nomor Dokumen",-1)),pt=l(()=>e("th",null,"Tanggal Dokumen",-1)),vt=l(()=>e("th",null,"Parameter",-1)),ht=l(()=>e("th",null,"Status",-1)),ft={key:0},bt=l(()=>e("th",null,"Catatan Verifikator",-1)),gt={class:"text-danger"},yt=l(()=>e("h6",{class:"text-secondary mb-2"},[e("i",{class:"fas fa-clipboard-check mr-1"}),p(" Riwayat Verifikasi ")],-1)),xt={key:0,class:"text-muted small d-flex align-items-center"},kt=l(()=>e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1)),wt={key:1,class:"list-group list-group-unbordered small mb-2"},Dt={class:"font-weight-bold text-sm"},Ct=l(()=>e("span",{class:"text-muted mx-1"},"oleh",-1)),Ut={class:"font-italic text-sm"},Ft={class:"text-muted"},It={key:0,class:"text-danger mt-1 small"},St=l(()=>e("i",{class:"fas fa-comment-dots mr-1"},null,-1)),Pt={key:2,class:"text-muted small"},Tt={class:"col-md-6"},Vt=["src"],Mt={key:1,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},Nt={class:"modal-dialog modal-lg modal-dialog-scrollable"},$t={class:"modal-content",style:{"max-height":"90vh",display:"flex","flex-direction":"column"}},Lt={class:"modal-header"},Bt={class:"modal-title"},jt=l(()=>e("span",null,"Ã—",-1)),Rt=[jt],At={class:"modal-body overflow-auto",style:{flex:"1 1 auto"}},qt=["value"],zt={class:"form-group"},Kt=l(()=>e("label",null,"Tipe Dokumen",-1)),Gt=["value"],Et={class:"form-group"},Jt=l(()=>e("label",null,"Nomor Dokumen",-1)),Ot={class:"form-group"},Qt=l(()=>e("label",null,"Tanggal Dokumen",-1)),Ht={class:"form-group"},Wt=l(()=>e("label",null,"Pilih Parameter (Opsional)",-1)),Xt=l(()=>e("br",null,null,-1)),Yt={class:"btn-group mb-2 flex-wrap"},Zt=["onClick"],es={class:"input-group mb-3"},ts={class:"input-group-append"},ss=l(()=>e("small",{class:"form-text text-muted mb-2"},[e("strong",null,"Info:"),p(" Gunakan parameter diatas jika dokumen pada tipe ini bersifat multiple atau lebih dari satu, seperti "),e("em",null,"Akte Kelahiran Anak"),p(", "),e("em",null,"SKP 2 Tahun Terakhir"),p(", "),e("em",null,"SK Jabatan"),p(", dan sejenisnya. ")],-1)),as={class:"form-group"},ls=l(()=>e("label",null,"Pilih File (PDF)",-1)),os={class:"custom-file"},ns={class:"custom-file-label",for:"exampleInputFile"},is={key:0,class:"mb-3"},ds={class:"progress",style:{height:"20px"}},rs=["aria-valuenow"],cs={class:"modal-footer"},us=["disabled"],_s={key:0},ms=l(()=>e("i",{class:"fas fa-spinner fa-spin"},null,-1)),ps={key:1},vs={__name:"AdminDocumentViewer",props:{userId:Number},setup(g){const B=_e(),F=()=>{B.back()},y=g,k=_([]),I=_(null),S=_(""),j=_(!1),v=_(null),P=_(!1),b=_(null),w=_(!1),h=_(0),A=_(""),T=_([]),R=_(!1),n=_({doc_number:"",doc_date:"",parameter:"",file:null,fileName:"",file_id:null}),q=xe(),z=async t=>{const s=await $.get(`/api/user-documents/${t}`);return A.value=s.data.user.name,s.data.data},K=async()=>{j.value=!0,await q.getDoctypeList(y.userId);const t=await z(y.userId),s=q.doctypeList;k.value=s.map(u=>{const c=t.filter(r=>r.id_doc_type===u.id||r.doc_type_id===u.id).sort((r,x)=>r.file_name.localeCompare(x.file_name));return{id:u.id,text:u.text,expanded:!0,files:c.map(r=>({...r,doc_type_text:u.text}))}}),j.value=!1},se=async t=>{const u=(await z(y.userId)).filter(r=>r.id_doc_type===t||r.doc_type_id===t).sort((r,x)=>r.file_name.localeCompare(x.file_name)),c=k.value.find(r=>r.id===t);c&&(c.files=u)},ae=Z(()=>h.value<30?"bg-danger":h.value<70?"bg-warning":"bg-success"),G=Z(()=>{if(!S.value)return k.value;const t=S.value.toLowerCase();return k.value.filter(s=>s.text.toLowerCase().includes(t)||s.files.some(u=>u.file_name.toLowerCase().includes(t)))}),E=t=>{switch(t){case"Approved":return"badge-success";case"Rejected":return"badge-danger";default:return"badge-secondary"}},le=t=>{t.expanded=!t.expanded},oe=async t=>{R.value=!0;try{const s=await $.get(`/api/document-log/${t}`);T.value=s.data.data||[]}catch(s){console.error("Gagal mengambil log verval:",s),T.value=[]}finally{R.value=!1}},ne=async t=>{v.value=t,I.value=t.file_url,await oe(t.id)},ie=t=>{b.value=t,P.value=!0,n.value={doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}},de=(t,s)=>{b.value=s,P.value=!0,n.value={doc_number:t.doc_number||"",doc_date:t.doc_date||"",parameter:t.parameter||"",file:null,file_id:t.id}},J=()=>{P.value=!1},re=t=>{const s=t.target.files[0];if(!s||s.type!=="application/pdf"||s.size>1024*1024){L.fire({icon:"error",title:"File Tidak Valid",text:"File harus PDF dan ukuran maksimal 1MB."}),t.target.value="",n.value.fileName="";return}n.value.file=s,n.value.fileName=s.name},ce=async()=>{var s,u;if(!n.value.file&&!n.value.file_id)return L.fire({icon:"warning",title:"File Belum Dipilih"});w.value=!0;const t=new FormData;t.append("doc_number",n.value.doc_number),t.append("doc_date",n.value.doc_date),t.append("parameter",n.value.parameter),n.value.file&&t.append("file",n.value.file),t.append("id_doc_type",b.value.id),t.append("user_id",y.userId);try{n.value.file_id?await $.post(`/api/reupload-document/${n.value.file_id}`,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:c=>{c.total&&(h.value=Math.round(c.loaded*100/c.total))}}):await $.post("/api/upload-document",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:c=>{c.total&&(h.value=Math.round(c.loaded*100/c.total))}}),L.fire({icon:"success",title:"Upload Berhasil",timer:1500}),await se(b.value.id),J()}catch(c){const r=((u=(s=c.response)==null?void 0:s.data)==null?void 0:u.message)||"Terjadi kesalahan.";L.fire({icon:"error",title:"Upload Gagal",text:r})}finally{w.value=!1,h.value=0}};return te(K),me(()=>y.userId,K),(t,s)=>{var u,c,r,x,O,Q,H,W,X,Y;return o(),i(C,null,[e("section",ke,[e("div",we,[e("h3",De,[p("ðŸ“‚ Dokumen "),e("small",Ce,d(A.value),1)]),e("button",{class:"btn btn-sm btn-secondary mt-2",onClick:F},[Ue,p(" Kembali ")])])]),e("section",Fe,[e("div",Ie,[e("div",Se,[e("div",Pe,[e("div",Te,[D(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>S.value=a),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[M,S.value]]),e("div",Ve,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[1]||(s[1]=(...a)=>t.clearSearch&&t.clearSearch(...a))},"Reset")])]),j.value?(o(),i("div",Me,Le)):G.value.length?(o(),i("div",Be,[e("ul",je,[(o(!0),i(C,null,N(G.value,(a,V)=>(o(),i("li",{key:a.id,class:"mb-2"},[e("div",Re,[e("div",{onClick:m=>le(a),class:"flex-grow-1 d-flex align-items-center"},[e("i",{class:U([a.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),e("span",qe,[p(d(V+1)+". "+d(a.text)+" ",1),e("span",ze,d(a.files.length),1)])],8,Ae),e("button",{class:"btn btn-sm btn-success ml-2",onClick:m=>ie(a)},"+ Upload",8,Ke)]),D(e("ul",Ge,[(o(!0),i(C,null,N(a.files,m=>(o(),i("li",{key:m.id,class:"cursor-pointer p-1 rounded hover-bg-light small"},[e("div",Ee,[e("div",{onClick:ue=>ne(m),class:"d-flex align-items-center"},[Oe,e("span",null,d(m.file_name),1),e("span",{class:U(["badge badge-sm ml-2",E(m.status)])},d(m.status||"Pending"),3)],8,Je),m.status==="Rejected"?(o(),i("button",{key:0,class:"btn btn-sm btn-outline-danger ml-2",onClick:ue=>de(m,a)},"Reupload",8,Qe)):f("",!0)]),m.status==="Rejected"&&m.verif_notes?(o(),i("div",He,[We,p(" Catatan: "+d(m.verif_notes),1)])):f("",!0)]))),128)),a.files.length?f("",!0):(o(),i("li",Xe," Tidak ada file diupload. "))],512),[[pe,a.expanded]])]))),128))])])):(o(),i("div",Ye,et))])])])]),I.value?(o(),i("div",tt,[e("div",st,[e("div",at,[e("div",lt,[ot,e("button",{type:"button",class:"close",onClick:s[2]||(s[2]=a=>{I.value=null,v.value=null})},it)]),e("div",dt,[e("div",rt,[e("div",ct,[e("table",ut,[e("tbody",null,[e("tr",null,[_t,e("td",null,d(((u=v.value)==null?void 0:u.doc_type_text)||"â€”"),1)]),e("tr",null,[mt,e("td",null,d(((c=v.value)==null?void 0:c.doc_number)||"â€”"),1)]),e("tr",null,[pt,e("td",null,d(((r=v.value)==null?void 0:r.doc_date)||"â€”"),1)]),e("tr",null,[vt,e("td",null,d(((x=v.value)==null?void 0:x.parameter)||"â€”"),1)]),e("tr",null,[ht,e("td",null,[e("span",{class:U(["badge",E((O=v.value)==null?void 0:O.status)])},d(((Q=v.value)==null?void 0:Q.status)||"Pending"),3)])]),(H=v.value)!=null&&H.verif_notes?(o(),i("tr",ft,[bt,e("td",gt,d(v.value.verif_notes),1)])):f("",!0)])]),yt,R.value?(o(),i("div",xt,[kt,p(" Mengambil data... ")])):T.value.length?(o(),i("ul",wt,[(o(!0),i(C,null,N(T.value,(a,V)=>(o(),i("li",{key:V,class:"list-group-item py-2 px-2",style:{"line-height":"1.4"}},[e("div",null,[e("span",Dt,d(a.status),1),Ct,e("span",Ut,d(a.verifier_name),1),e("small",Ft," pada "+d(a.verified_at),1)]),a.notes?(o(),i("div",It,[St,p(d(a.notes),1)])):f("",!0)]))),128))])):(o(),i("div",Pt,"Tidak ada log verifikasi."))]),e("div",Tt,[e("iframe",{src:`${I.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",style:{height:"70vh",border:"1px solid #ccc"}},null,8,Vt)])])])])])])):f("",!0),P.value?(o(),i("div",Mt,[e("div",Nt,[e("div",$t,[e("div",Lt,[e("h5",Bt,"Upload Dokumen Pegawai: "+d((W=b.value)==null?void 0:W.text),1),e("button",{type:"button",class:"close",onClick:J},Rt)]),e("div",At,[e("form",{onSubmit:ve(ce,["prevent"]),id:"uploadForm"},[e("input",{type:"hidden",value:(X=b.value)==null?void 0:X.id},null,8,qt),e("div",zt,[Kt,e("input",{type:"text",class:"form-control",value:(Y=b.value)==null?void 0:Y.text,readonly:""},null,8,Gt)]),e("div",Et,[Jt,D(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>n.value.doc_number=a),type:"text",class:"form-control",required:"",autofocus:""},null,512),[[M,n.value.doc_number]])]),e("div",Ot,[Qt,D(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>n.value.doc_date=a),type:"date",class:"form-control",required:""},null,512),[[M,n.value.doc_date]])]),e("div",Ht,[Wt,Xt,e("div",Yt,[(o(),i(C,null,N([1,2,3,4,2022,2023,2024,2025,"D2","D3","S1","S2","S3"],a=>e("button",{key:a,type:"button",class:U(["btn btn-xs btn-outline-secondary mb-1",{active:n.value.parameter===a}]),onClick:V=>n.value.parameter=a},d(a),11,Zt)),64))]),e("div",es,[D(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>n.value.parameter=a),type:"text",class:"form-control",readonly:""},null,512),[[M,n.value.parameter]]),e("div",ts,[e("button",{type:"button",class:"btn btn-info",onClick:s[6]||(s[6]=a=>n.value.parameter="")},"Reset")])]),ss]),e("div",as,[ls,e("div",os,[e("input",{type:"file",class:"custom-file-input",id:"exampleInputFile",accept:"application/pdf",onChange:re,required:""},null,32),e("label",ns,d(n.value.fileName||"Pilih file"),1)])]),w.value?(o(),i("div",is,[e("div",ds,[e("div",{class:U(["progress-bar progress-bar-striped progress-bar-animated",ae.value]),role:"progressbar",style:he({width:h.value+"%"}),"aria-valuenow":h.value,"aria-valuemin":"0","aria-valuemax":"100"},d(h.value)+"% ",15,rs)])])):f("",!0)],32)]),e("div",cs,[e("button",{type:"submit",class:"btn btn-primary",disabled:w.value,form:"uploadForm"},[w.value?(o(),i("span",_s,[ms,p(" Uploading... ")])):(o(),i("span",ps," Upload "))],8,us)])])])])):f("",!0)],64)}}},hs=ee(vs,[["__scopeId","data-v-7abcfe52"]]),fs={__name:"UserDocs",setup(g){const B=ge(),F=_(null);return te(()=>{F.value=parseInt(B.params.id,10)}),(y,k)=>(o(),ye(hs,{userId:F.value},null,8,["userId"]))}},ks=ee(fs,[["__scopeId","data-v-c53bb1c5"]]);export{ks as default};
