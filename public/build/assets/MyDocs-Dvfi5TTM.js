import{_ as P,f as d,u as T,L as y,s as U,q as V,c as o,a as s,t as c,G as $,i as x,v as B,F as h,x as b,k as D,o as l,y as I,b as w,M as N}from"./app-cwS-Epvq.js";import{u as q}from"./MasterDataStore-TojzcxIn.js";import"./LoadingStore-BqVnF2i6.js";const z={class:"content"},G={class:"container-fluid"},H={class:"mb-3"},Q={class:"d-block mb-1 text-muted font-weight-bold"},R={class:"progress",style:{height:"20px"}},j=["aria-valuenow"],J={class:"card shadow-sm rounded-lg"},K={class:"card-body p-3"},O={class:"input-group mb-3"},W={key:0,class:"text-center p-5"},X={key:1,class:"tree"},Y={class:"list-unstyled mb-0"},Z=["onClick"],ee={class:"ml-2 font-weight-bold"},se={class:"badge badge-pill badge-primary ml-2"},te={class:"pl-4 mt-1"},ae=["onClick"],oe={key:0,class:"text-muted small ml-4 mt-1"},le={key:2,class:"text-center p-5"},ne={key:3,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},re={class:"modal-dialog modal-xl"},ie={class:"modal-content"},de={class:"modal-header p-2"},ce={class:"modal-body p-2"},ue=["src"],me={key:1,class:"text-muted text-center py-5"},pe={key:0},ve={key:1},fe={__name:"MyDocs",setup(_e){const C=d(null),n=d(!1),v=d([]),i=d(null),u=d(""),f=d(!1),L=()=>{n.value=!1},M=()=>{n.value=!0},g=q(),m=T(),p=y(()=>{var a,e;return((e=(a=m.user)==null?void 0:a.employee)==null?void 0:e.progress_dokumen)??0}),S=async()=>{console.log("eh kepanggil fetchdata didalam Doclist"),await g.getDoctypeList(),await m.getMyDocuments();const a=g.doctypeList,e=m.myDocuments;v.value=a.map(t=>{const _=e.filter(r=>(r.id_doc_type===t.id||r.doc_type_id===t.id||r.doc_type===t.id)&&r.status==="Approved");return{id:t.id,text:t.text,expanded:!0,files:_}})},E=a=>{a.expanded=!a.expanded},F=async a=>{var e;n.value=!1,i.value=a;try{const t=await fetch(a,{method:"HEAD"});(!t.ok||!((e=t.headers.get("content-type"))!=null&&e.includes("pdf")))&&(n.value=!0)}catch{n.value=!0}},A=()=>{u.value=""},k=y(()=>{if(!u.value)return v.value;const a=u.value.toLowerCase();return v.value.filter(e=>e.text.toLowerCase().includes(a)||e.files.some(t=>t.file_name.toLowerCase().includes(a)))});return U(async()=>{var a,e;f.value=!0,await m.getDocsUpdateState(),console.log("Progress Dokumen:",(e=(a=m.user)==null?void 0:a.employee)==null?void 0:e.progress_dokumen),console.log("eh kepanggil fetchdata didalam onMounted Doclist"),await S(),f.value=!1}),V(()=>i,async a=>{var e;if(n.value=!1,!!a)try{const t=await fetch(a,{method:"HEAD"});(!t.ok||!((e=t.headers.get("content-type"))!=null&&e.includes("pdf")))&&(n.value=!0)}catch{n.value=!0}}),(a,e)=>(l(),o(h,null,[e[7]||(e[7]=s("section",{class:"content-header"},[s("div",{class:"container-fluid"},[s("h3",{class:"text-primary"},"ðŸ“‚ Daftar Dokumen")])],-1)),s("section",z,[s("div",G,[s("div",H,[s("label",Q," Progress Dokumen: "+c(p.value||0)+"% ",1),s("div",R,[s("div",{class:"progress-bar bg-success",style:$({width:p.value+"%"}),role:"progressbar","aria-valuenow":p.value,"aria-valuemin":"0","aria-valuemax":"100"},c(p.value||0)+"% ",13,j)])]),s("div",J,[s("div",K,[s("div",O,[x(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[B,u.value]]),s("div",{class:"input-group-append"},[s("button",{class:"btn btn-outline-secondary",type:"button",onClick:A},"Reset")])]),f.value?(l(),o("div",W,e[2]||(e[2]=[s("div",{class:"spinner-border text-primary mb-2",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),s("div",{class:"text-muted"},"Memuat daftar dokumen...",-1)]))):k.value.length?(l(),o("div",X,[s("ul",Y,[(l(!0),o(h,null,b(k.value,(t,_)=>(l(),o("li",{key:t.id,class:"mb-2"},[s("div",{onClick:r=>E(t),class:"d-flex align-items-center cursor-pointer py-1 px-2 bg-light rounded small"},[s("i",{class:I([t.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),s("span",ee,[w(c(_+1)+". "+c(t.text)+" ",1),s("span",se,c(t.files.length),1)])],8,Z),x(s("ul",te,[(l(!0),o(h,null,b(t.files,r=>(l(),o("li",{key:r.id,onClick:he=>F(r.file_url),class:"cursor-pointer p-1 rounded hover-bg-light small"},[e[3]||(e[3]=s("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),w(" "+c(r.file_name),1)],8,ae))),128)),t.files.length?D("",!0):(l(),o("li",oe," Tidak ada file diupload. "))],512),[[N,t.expanded]])]))),128))])])):(l(),o("div",le,e[4]||(e[4]=[s("span",{class:"text-muted"},"Data tidak ditemukan.",-1)]))),i.value?(l(),o("div",ne,[s("div",re,[s("div",ie,[s("div",de,[e[6]||(e[6]=s("h5",{class:"modal-title"},"Preview Dokumen",-1)),s("button",{type:"button",class:"close",onClick:e[1]||(e[1]=t=>i.value=null)},e[5]||(e[5]=[s("span",null,"Ã—",-1)]))]),s("div",ce,[i.value&&!n.value?(l(),o("iframe",{key:0,ref_key:"pdfFrame",ref:C,src:`${i.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",frameborder:"0",style:{height:"90vh",border:"1px solid #ccc"},onLoad:L,onError:M},null,40,ue)):(l(),o("div",me,[n.value?(l(),o("p",pe,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses. ")):(l(),o("p",ve,"File tidak tersedia."))]))])])])])):D("",!0)])])])])],64))}},xe=P(fe,[["__scopeId","data-v-50ccf5be"]]);export{xe as default};
