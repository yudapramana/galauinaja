import{_ as x,e as o,f as b,q as p,c as $,o as j,b as S,a as s,F as M,I as N,$ as U}from"./app-3SLzo23l.js";import"./style-DzxbSUS0.js";const B={__name:"WorkUnitMonitor",setup(I){const c=o([]),d=o(new Map),v=o(!1),y=o(null),u=o(new Map),h=t=>{const e=new Map,a=n=>{var r;for(const i of n)e.set(String(i.id),i),(r=i.children)!=null&&r.length&&a(i.children)};return a(t),e},g=()=>c.value.map(e=>({id:String(e.id),text:e.unit_name,type:"workunit",children:!0})),k=t=>{const e=d.value.get(String(t));return e?(e.children||[]).map(n=>({id:String(n.id),text:n.unit_name,type:"workunit",children:!0})):[]},w=async t=>{const e=String(t),a=await p.get(`/api/work-units/${e}/employees`),n=Array.isArray(a.data)?a.data:a.data.data??[];return u.value.set(e,n),n},m=async()=>{await N();const t=U("#tree-container");t.jstree(!0)&&t.jstree(!0).destroy(),t.off(".jstree").jstree({core:{check_callback:!0,themes:{stripes:!0},data:async(e,a)=>{try{if(e.id==="#"){a(g());return}if(e.type==="employee"){a([]);return}const n=e.id,r=k(n),f=(await w(n)).map(l=>({id:`emp-${n}-${l.id}`,text:`${l.full_name} â€” ${Number(l.progress_dokumen??0).toFixed(2)}%`,type:"employee",children:!1}));if(r.length===0&&f.length===0){a([{id:`info-empty-${n}`,text:"Belum ada data.",type:"info",children:!1,li_attr:{class:"text-muted"}}]);return}a([...r,...f])}catch{a([{id:`info-error-${e.id}-${Date.now()}`,text:"Gagal memuat data.",type:"info",children:!1,li_attr:{class:"text-danger"}}])}}},plugins:["types"],types:{workunit:{icon:"far fa-folder"},employee:{icon:"far fa-user"},info:{icon:"far fa-circle"}}}),y.value=t.jstree(!0),v.value=!0,t.on("select_node.jstree",(e,a)=>{})},_=async()=>{u.value.clear(),await m()};return b(async()=>{const t=await p.get("/api/work-units/monitor");c.value=t.data||[],d.value=h(c.value),await m()}),(t,e)=>(j(),$(M,null,[e[2]||(e[2]=S('<div class="content-header" data-v-85180c0c><div class="container-fluid" data-v-85180c0c><div class="row mb-2" data-v-85180c0c><div class="col-sm-6" data-v-85180c0c><h1 class="m-0" data-v-85180c0c>Monitor Satuan Kerja</h1></div><div class="col-sm-6" data-v-85180c0c><ol class="breadcrumb float-sm-right" data-v-85180c0c><li class="breadcrumb-item" data-v-85180c0c><a href="#" data-v-85180c0c>Home</a></li><li class="breadcrumb-item active" data-v-85180c0c>Daftar Satker</li></ol></div></div></div></div>',1)),s("div",{class:"content"},[s("div",{class:"container-fluid"},[s("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e[0]||(e[0]=s("h5",{class:"mb-0"},"Work Unit Tree",-1)),s("button",{class:"btn btn-sm btn-primary",onClick:_},"Refresh")]),e[1]||(e[1]=s("div",{id:"tree-container"},null,-1))])])],64))}},F=x(B,[["__scopeId","data-v-85180c0c"]]);export{F as default};
