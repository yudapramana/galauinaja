import{_ as ce,g as c,N as Q,u as _e,y as me,c as n,a as e,j as C,v as V,F as U,z as B,t as u,A as S,l as b,b as v,i as pe,I as ve,o as i,O as fe,p as he,e as be,m as $}from"./app--yyIGIhA.js";import{S as F}from"./sweetalert2.all-CdqmCXXw.js";import{u as ge}from"./MasterDataStore-CSBsGfpo.js";import"./LoadingStore-BAHgNWPs.js";const d=P=>(he("data-v-0bbb3d81"),P=P(),be(),P),ye=d(()=>e("section",{class:"content-header"},[e("div",{class:"container-fluid"},[e("h3",{class:"text-primary"},"ðŸ“‚ Upload Dokumen")])],-1)),ke={class:"content"},xe={class:"container-fluid"},we={class:"card shadow-sm rounded-lg"},De={class:"card-body p-3"},Ce={class:"input-group mb-3"},Ue={key:0,class:"text-center p-5"},Se=d(()=>e("div",{class:"spinner-border text-primary mb-2",role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),Fe=d(()=>e("div",{class:"text-muted"},"Memuat daftar dokumen...",-1)),Pe=[Se,Fe],Te={key:1,class:"tree"},Me={class:"list-unstyled mb-0"},Le={class:"d-flex align-items-center justify-between cursor-pointer py-1 px-2 bg-light rounded small"},je=["onClick"],Ve={class:"ml-2 font-weight-bold"},Be={class:"badge badge-pill badge-primary ml-2"},Ie=["onClick"],Ne={class:"pl-4 mt-1"},$e={class:"d-flex align-items-center justify-content-between w-100"},Re=["onClick"],Ae=d(()=>e("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),ze=["onClick"],qe={key:0,class:"text-danger mt-1 ml-4 small"},Ge=d(()=>e("i",{class:"fas fa-info-circle"},null,-1)),Ke={key:0,class:"text-muted small ml-4 mt-1"},Oe={key:2,class:"text-center p-5"},Ee=d(()=>e("span",{class:"text-muted"},"Data tidak ditemukan.",-1)),He=[Ee],Je={key:0,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},Qe={class:"modal-dialog modal-xl"},We={class:"modal-content"},Xe={class:"modal-header p-2"},Ye=d(()=>e("h5",{class:"modal-title"},"ðŸ“„ Preview Dokumen",-1)),Ze=d(()=>e("span",null,"Ã—",-1)),et=[Ze],tt={class:"modal-body p-3"},at={class:"row"},st={class:"col-md-6 mb-3"},lt={class:"table table-sm table-bordered"},ot=d(()=>e("th",{style:{width:"40%"}},"Tipe Dokumen",-1)),nt=d(()=>e("th",null,"Nomor Dokumen",-1)),it=d(()=>e("th",null,"Tanggal Dokumen",-1)),dt=d(()=>e("th",null,"Parameter",-1)),rt=d(()=>e("th",null,"Status",-1)),ut={key:0},ct=d(()=>e("th",null,"Catatan Verifikator",-1)),_t={class:"text-danger"},mt=d(()=>e("h6",{class:"text-secondary mb-2"},[e("i",{class:"fas fa-clipboard-check mr-1"}),v(" Riwayat Verifikasi ")],-1)),pt={key:0,class:"text-muted small d-flex align-items-center"},vt=d(()=>e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1)),ft={key:1,class:"list-group list-group-unbordered small mb-2"},ht={class:"font-weight-bold text-sm"},bt=d(()=>e("span",{class:"text-muted mx-1"},"oleh",-1)),gt={class:"font-italic text-sm"},yt={class:"text-muted"},kt={key:0,class:"text-danger mt-1 small"},xt=d(()=>e("i",{class:"fas fa-comment-dots mr-1"},null,-1)),wt={key:2,class:"text-muted small"},Dt={class:"col-md-6"},Ct=["src"],Ut={key:1,class:"text-muted text-center py-5"},St={key:0},Ft={key:1},Pt={key:1,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},Tt={class:"modal-dialog modal-lg modal-dialog-scrollable"},Mt={class:"modal-content",style:{"max-height":"90vh",display:"flex","flex-direction":"column"}},Lt={class:"modal-header"},jt={class:"modal-title"},Vt=d(()=>e("span",null,"Ã—",-1)),Bt=[Vt],It={class:"modal-body overflow-auto",style:{flex:"1 1 auto"}},Nt=["value"],$t={class:"form-group"},Rt=d(()=>e("label",null,"Tipe Dokumen",-1)),At=["value"],zt={class:"form-group"},qt=d(()=>e("label",null,"Nomor Dokumen",-1)),Gt={class:"form-group"},Kt=d(()=>e("label",null,"Tanggal Dokumen",-1)),Ot={class:"form-group"},Et=d(()=>e("label",null,"Pilih Parameter (Opsional)",-1)),Ht=d(()=>e("br",null,null,-1)),Jt={class:"btn-group mb-2 flex-wrap"},Qt=["onClick"],Wt={class:"input-group mb-3"},Xt={class:"input-group-append"},Yt=d(()=>e("small",{class:"form-text text-muted mb-2"},[e("strong",null,"Info:"),v(" Gunakan parameter diatas jika dokumen pada tipe ini bersifat multiple atau lebih dari satu, seperti "),e("em",null,"Akte Kelahiran Anak"),v(", "),e("em",null,"SKP 2 Tahun Terakhir"),v(", "),e("em",null,"SK Jabatan"),v(", dan sejenisnya. ")],-1)),Zt={class:"form-group"},ea=d(()=>e("label",null,"Pilih File (PDF)",-1)),ta={class:"custom-file"},aa={class:"custom-file-label",for:"exampleInputFile"},sa={key:0,class:"mb-3"},la={class:"progress",style:{height:"20px"}},oa=["aria-valuenow"],na={class:"modal-footer"},ia=["disabled"],da={key:0},ra=d(()=>e("i",{class:"fas fa-spinner fa-spin"},null,-1)),ua={key:1},ca={__name:"UserUploadDoc",setup(P){const T=c([]),x=c(null),w=c(""),I=c(!1),m=c(null),M=c([]),N=c(!1),L=c(!1),g=c(null),D=c(!1),h=c(0),W=Q(()=>h.value<30?"bg-danger":h.value<70?"bg-warning":"bg-success"),X=c(null),f=c(!1),Y=()=>{f.value=!1},Z=()=>{f.value=!0},R=t=>{switch(t){case"Approved":return"badge-success";case"Rejected":return"badge-danger";default:return"badge-secondary"}},A=ge(),y=_e(),o=c({doc_number:"",doc_date:"",parameter:"",file:null,fileName:"",file_id:null}),ee=async t=>{N.value=!0;try{const a=await $.get(`/api/document-log/${t}`);M.value=a.data.data||[]}catch(a){console.error("Gagal mengambil log verval:",a),M.value=[]}finally{N.value=!1}},te=async()=>{console.log("eh kepanggil fetchdata didalam"),await A.getDoctypeList(),await y.getMyDocuments();const t=A.doctypeList,a=y.myDocuments;T.value=t.map(l=>{const p=a.filter(r=>r.id_doc_type===l.id||r.doc_type_id===l.id||r.doc_type===l.id).sort((r,k)=>r.file_name.localeCompare(k.file_name));return{id:l.id,text:l.text,expanded:!0,files:p.map(r=>({...r,doc_type_text:l.text}))}})},ae=t=>{t.expanded=!t.expanded},se=async t=>{console.log("file"),console.log(t),f.value=!1,m.value=t,x.value=t.file_url;try{const a=await fetch(t.file_url,{method:"HEAD"});if(!a.ok){a.status===404?f.value="not_found":f.value=!0;return}const l=a.headers.get("content-type");(!l||!l.includes("pdf"))&&(f.value=!0)}catch{f.value=!0}await ee(t.id)},le=()=>{w.value=""},z=Q(()=>{if(!w.value)return T.value;const t=w.value.toLowerCase();return T.value.filter(a=>a.text.toLowerCase().includes(t)||a.files.some(l=>l.file_name.toLowerCase().includes(t)))}),oe=t=>{g.value=t,L.value=!0,o.value={doc_number:"",doc_date:"",parameter:"",file:null}},q=()=>{L.value=!1,o.value={doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}},ne=t=>{const a=t.target.files[0];if(!a){o.value.file=null,o.value.fileName="";return}if(a.type!=="application/pdf"){F.fire({icon:"error",title:"Format Salah",text:"File harus berformat PDF!"}),t.target.value="",o.value.file=null;return}const l=1*1024*1024;if(a.size>l){F.fire({icon:"error",title:"Ukuran File Terlalu Besar",text:"Ukuran maksimal file adalah 1MB!"}),t.target.value="",o.value.file=null;return}o.value.file=a,o.value.fileName=a.name},ie=(t,a)=>{g.value=a,L.value=!0,o.value={doc_number:t.doc_number||"",doc_date:t.doc_date||"",parameter:t.parameter||"",file:null,file_id:t.id}},de=async()=>{var a;if(!o.value.file&&!o.value.file_id){F.fire({icon:"warning",title:"File Belum Dipilih",text:"Silakan pilih file terlebih dahulu."});return}D.value=!0;const t=new FormData;t.append("doc_number",o.value.doc_number),t.append("doc_date",o.value.doc_date),t.append("parameter",o.value.parameter),o.value.file&&t.append("file",o.value.file),t.append("id_doc_type",g.value.id);try{o.value.file_id?await $.post(`/api/reupload-document/${o.value.file_id}`,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:l=>{l.total&&(h.value=Math.round(l.loaded*100/l.total))}}):await $.post("/api/upload-document",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:l=>{l.total&&(h.value=Math.round(l.loaded*100/l.total))}}),F.fire({icon:"success",title:o.value.file_id?"Reupload Berhasil!":"Upload Berhasil!",showConfirmButton:!1,timer:1500}),await re(g.value.id),q()}catch(l){let p="Terjadi kesalahan saat mengupload file.";if(((a=l.response)==null?void 0:a.status)===422&&l.response.data.errors){const r=l.response.data.errors;p=Object.values(r).flat().join(`
`)}F.fire({icon:"error",title:"Upload Gagal",text:p})}finally{D.value=!1,h.value=0}},re=async t=>{y.docsUpdateState=!0,await y.getMyDocuments();const l=y.myDocuments.filter(r=>r.id_doc_type===t||r.doc_type_id===t||r.doc_type===t).sort((r,k)=>r.file_name.localeCompare(k.file_name)),p=T.value.find(r=>r.id===t);p&&(p.files=l)};return me(async()=>{I.value=!0,await y.getDocsUpdateState(),console.log("eh kepanggil fetchdata didalam onMounted Doclist"),await te(),I.value=!1}),(t,a)=>{var l,p,r,k,G,K,O,E,H,J;return i(),n(U,null,[ye,e("section",ke,[e("div",xe,[e("div",we,[e("div",De,[e("div",Ce,[C(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=s=>w.value=s),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[V,w.value]]),e("div",{class:"input-group-append"},[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:le},"Reset")])]),I.value?(i(),n("div",Ue,Pe)):z.value.length?(i(),n("div",Te,[e("ul",Me,[(i(!0),n(U,null,B(z.value,(s,j)=>(i(),n("li",{key:s.id,class:"mb-2"},[e("div",Le,[e("div",{onClick:_=>ae(s),class:"flex-grow-1 d-flex align-items-center"},[e("i",{class:S([s.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),e("span",Ve,[v(u(j+1)+". "+u(s.text)+" ",1),e("span",Be,u(s.files.length),1)])],8,je),e("button",{class:"btn btn-sm btn-success ml-2",onClick:_=>oe(s)},"+ Upload",8,Ie)]),C(e("ul",Ne,[(i(!0),n(U,null,B(s.files,_=>(i(),n("li",{key:_.id,class:"cursor-pointer p-1 rounded hover-bg-light small"},[e("div",$e,[e("div",{onClick:ue=>se(_),class:"d-flex align-items-center"},[Ae,e("span",null,u(_.file_name),1),e("span",{class:S(["badge badge-sm ml-2",R(_.status)])},u(_.status||"Pending"),3)],8,Re),_.status==="Rejected"?(i(),n("button",{key:0,class:"btn btn-sm btn-outline-danger ml-2",onClick:ue=>ie(_,s)}," Reupload ",8,ze)):b("",!0)]),_.status==="Rejected"&&_.verif_notes?(i(),n("div",qe,[Ge,v(" Catatan: "+u(_.verif_notes),1)])):b("",!0)]))),128)),s.files.length?b("",!0):(i(),n("li",Ke," Tidak ada file diupload. "))],512),[[fe,s.expanded]])]))),128))])])):(i(),n("div",Oe,He))])])])]),x.value?(i(),n("div",Je,[e("div",Qe,[e("div",We,[e("div",Xe,[Ye,e("button",{type:"button",class:"close",onClick:a[1]||(a[1]=s=>{x.value=null,m.value=null})},et)]),e("div",tt,[e("div",at,[e("div",st,[e("table",lt,[e("tbody",null,[e("tr",null,[ot,e("td",null,u(((l=m.value)==null?void 0:l.doc_type_text)||"â€”"),1)]),e("tr",null,[nt,e("td",null,u(((p=m.value)==null?void 0:p.doc_number)||"â€”"),1)]),e("tr",null,[it,e("td",null,u(((r=m.value)==null?void 0:r.doc_date)||"â€”"),1)]),e("tr",null,[dt,e("td",null,u(((k=m.value)==null?void 0:k.parameter)||"â€”"),1)]),e("tr",null,[rt,e("td",null,[e("span",{class:S(["badge",R((G=m.value)==null?void 0:G.status)])},u(((K=m.value)==null?void 0:K.status)||"Pending"),3)])]),(O=m.value)!=null&&O.verif_notes?(i(),n("tr",ut,[ct,e("td",_t,u(m.value.verif_notes),1)])):b("",!0)])]),mt,N.value?(i(),n("div",pt,[vt,v(" Mengambil data... ")])):M.value.length?(i(),n("ul",ft,[(i(!0),n(U,null,B(M.value,(s,j)=>(i(),n("li",{key:j,class:"list-group-item py-2 px-2",style:{"line-height":"1.4"}},[e("div",null,[e("span",ht,u(s.status),1),bt,e("span",gt,u(s.verifier_name),1),e("small",yt," pada "+u(s.verified_at),1)]),s.notes?(i(),n("div",kt,[xt,v(u(s.notes),1)])):b("",!0)]))),128))])):(i(),n("div",wt,"Tidak ada log verifikasi."))]),e("div",Dt,[x.value&&!f.value?(i(),n("iframe",{key:0,ref_key:"pdfFrame",ref:X,src:`${x.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",frameborder:"0",style:{height:"70vh",border:"1px solid #ccc"},onLoad:Y,onError:Z},null,40,Ct)):(i(),n("div",Ut,[f.value?(i(),n("p",St,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses. ")):(i(),n("p",Ft,"File tidak tersedia."))]))])])])])])])):b("",!0),L.value?(i(),n("div",Pt,[e("div",Tt,[e("div",Mt,[e("div",Lt,[e("h5",jt,"Upload Dokumen Pegawai: "+u((E=g.value)==null?void 0:E.text),1),e("button",{type:"button",class:"close",onClick:q},Bt)]),e("div",It,[e("form",{onSubmit:pe(de,["prevent"]),id:"uploadForm"},[e("input",{type:"hidden",value:(H=g.value)==null?void 0:H.id},null,8,Nt),e("div",$t,[Rt,e("input",{type:"text",class:"form-control",value:(J=g.value)==null?void 0:J.text,readonly:""},null,8,At)]),e("div",zt,[qt,C(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>o.value.doc_number=s),type:"text",class:"form-control",required:"",autofocus:""},null,512),[[V,o.value.doc_number]])]),e("div",Gt,[Kt,C(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>o.value.doc_date=s),type:"date",class:"form-control",required:""},null,512),[[V,o.value.doc_date]])]),e("div",Ot,[Et,Ht,e("div",Jt,[(i(),n(U,null,B([1,2,3,4,2023,2024,2025,"D2","D3","S1","S2","S3"],s=>e("button",{key:s,type:"button",class:S(["btn btn-xs btn-outline-secondary mb-1",{active:o.value.parameter===s}]),onClick:j=>o.value.parameter=s},u(s),11,Qt)),64))]),e("div",Wt,[C(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>o.value.parameter=s),type:"text",class:"form-control",readonly:""},null,512),[[V,o.value.parameter]]),e("div",Xt,[e("button",{type:"button",class:"btn btn-info",onClick:a[5]||(a[5]=s=>o.value.parameter="")},"Reset")])]),Yt]),e("div",Zt,[ea,e("div",ta,[e("input",{type:"file",class:"custom-file-input",id:"exampleInputFile",accept:"application/pdf",onChange:ne,required:""},null,32),e("label",aa,u(o.value.fileName||"Pilih file"),1)])]),D.value?(i(),n("div",sa,[e("div",la,[e("div",{class:S(["progress-bar progress-bar-striped progress-bar-animated",W.value]),role:"progressbar",style:ve({width:h.value+"%"}),"aria-valuenow":h.value,"aria-valuemin":"0","aria-valuemax":"100"},u(h.value)+"% ",15,oa)])])):b("",!0)],32)]),e("div",na,[e("button",{type:"submit",class:"btn btn-primary",disabled:D.value,form:"uploadForm"},[D.value?(i(),n("span",da,[ra,v(" Uploading... ")])):(i(),n("span",ua," Upload "))],8,ia)])])])])):b("",!0)],64)}}},fa=ce(ca,[["__scopeId","data-v-0bbb3d81"]]);export{fa as default};
