import{_ as ie,g as _,N as K,u as de,y as re,c as i,a as e,j as w,v as T,F as L,z as $,t as c,A as P,l as h,b as y,i as ce,I as ue,o as d,O as _e,p as me,e as pe,m as R}from"./app-DKYEko9h.js";import{S as D}from"./sweetalert2.all-B-44TrQ9.js";import{u as ve}from"./MasterDataStore-B9FbAySm.js";import"./LoadingStore-BQPl8X7A.js";const o=U=>(me("data-v-bf519ecc"),U=U(),pe(),U),he=o(()=>e("section",{class:"content-header"},[e("div",{class:"container-fluid"},[e("h3",{class:"text-primary"},"ðŸ“‚ Upload Dokumen")])],-1)),fe={class:"content"},ge={class:"container-fluid"},be={class:"card shadow-sm rounded-lg"},ye={class:"card-body p-3"},xe={class:"input-group mb-3"},ke={key:0,class:"text-center p-5"},we=o(()=>e("div",{class:"spinner-border text-primary mb-2",role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)),De=o(()=>e("div",{class:"text-muted"},"Memuat daftar dokumen...",-1)),Ue=[we,De],Ce={key:1,class:"tree"},Se={class:"list-unstyled mb-0"},Fe={class:"d-flex align-items-center justify-between cursor-pointer py-1 px-2 bg-light rounded small"},Me=["onClick"],Te={class:"ml-2 font-weight-bold"},Le={class:"badge badge-pill badge-primary ml-2"},Pe=["onClick"],Ve={class:"pl-4 mt-1"},Be={class:"d-flex align-items-center justify-content-between w-100"},je=["onClick"],$e=o(()=>e("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),Re=["onClick"],Ne={key:0,class:"text-danger mt-1 ml-4 small"},ze=o(()=>e("i",{class:"fas fa-info-circle"},null,-1)),Ie={key:0,class:"text-muted small ml-4 mt-1"},qe={key:2,class:"text-center p-5"},Ae=o(()=>e("span",{class:"text-muted"},"Data tidak ditemukan.",-1)),Oe=[Ae],Ge={key:0,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},Qe={class:"modal-dialog modal-xl"},He={class:"modal-content"},Je={class:"modal-header p-2"},Ke=o(()=>e("h5",{class:"modal-title"},"ðŸ“„ Preview Dokumen",-1)),We=o(()=>e("span",null,"Ã—",-1)),Xe=[We],Ye={class:"modal-body p-3"},Ze={class:"row"},Ee={class:"col-md-6 mb-3"},et={class:"table table-sm table-bordered"},tt=o(()=>e("th",{style:{width:"40%"}},"Tipe Dokumen",-1)),st=o(()=>e("th",null,"Nomor Dokumen",-1)),at=o(()=>e("th",null,"Tanggal Dokumen",-1)),lt=o(()=>e("th",null,"Parameter",-1)),ot=o(()=>e("th",null,"Status",-1)),nt={key:0},it=o(()=>e("th",null,"Catatan Verifikator",-1)),dt={class:"text-danger"},rt=o(()=>e("h6",{class:"text-secondary mb-2"},[e("i",{class:"fas fa-clipboard-check mr-1"}),y(" Riwayat Verifikasi ")],-1)),ct={key:0,class:"text-muted small d-flex align-items-center"},ut=o(()=>e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1)),_t={key:1,class:"list-group list-group-unbordered small mb-2"},mt={class:"font-weight-bold text-sm"},pt=o(()=>e("span",{class:"text-muted mx-1"},"oleh",-1)),vt={class:"font-italic text-sm"},ht={class:"text-muted"},ft={key:0,class:"text-danger mt-1 small"},gt=o(()=>e("i",{class:"fas fa-comment-dots mr-1"},null,-1)),bt={key:2,class:"text-muted small"},yt={class:"col-md-6"},xt=["src"],kt={key:1,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},wt={class:"modal-dialog modal-lg"},Dt={class:"modal-content"},Ut={class:"modal-header"},Ct={class:"modal-title"},St=o(()=>e("span",null,"Ã—",-1)),Ft=[St],Mt={class:"modal-body"},Tt=["value"],Lt={class:"form-group"},Pt=o(()=>e("label",null,"Tipe Dokumen",-1)),Vt=["value"],Bt={class:"form-group"},jt=o(()=>e("label",null,"Nomor Dokumen",-1)),$t={class:"form-group"},Rt=o(()=>e("label",null,"Tanggal Dokumen",-1)),Nt={class:"form-group"},zt=o(()=>e("label",null,"Parameter (Opsional)",-1)),It={class:"form-group"},qt=o(()=>e("label",null,"Pilih File (PDF)",-1)),At={key:0,class:"mb-3"},Ot={class:"progress",style:{height:"20px"}},Gt=["aria-valuenow"],Qt={class:"text-right"},Ht=["disabled"],Jt={key:0},Kt=o(()=>e("i",{class:"fas fa-spinner fa-spin"},null,-1)),Wt={key:1},Xt={__name:"UserUploadDoc",setup(U){const C=_([]),S=_(null),x=_(""),V=_(!1),m=_(null),F=_([]),B=_(!1),M=_(!1),f=_(null),k=_(!1),v=_(0),W=K(()=>v.value<30?"bg-danger":v.value<70?"bg-warning":"bg-success"),N=t=>{switch(t){case"Approved":return"badge-success";case"Rejected":return"badge-danger";default:return"badge-secondary"}},z=ve(),g=de(),n=_({doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}),X=async t=>{B.value=!0;try{const s=await R.get(`/api/document-log/${t}`);F.value=s.data.data||[]}catch(s){console.error("Gagal mengambil log verval:",s),F.value=[]}finally{B.value=!1}},Y=async()=>{console.log("eh kepanggil fetchdata didalam"),await z.getDoctypeList(),await g.getMyDocuments();const t=z.doctypeList,s=g.myDocuments;C.value=t.map(a=>{const p=s.filter(r=>r.id_doc_type===a.id||r.doc_type_id===a.id||r.doc_type===a.id).sort((r,b)=>r.file_name.localeCompare(b.file_name));return{id:a.id,text:a.text,expanded:!0,files:p.map(r=>({...r,doc_type_text:a.text}))}})},Z=t=>{t.expanded=!t.expanded},E=async t=>{m.value=t,S.value=t.file_url,await X(t.id)},ee=()=>{x.value=""},I=K(()=>{if(!x.value)return C.value;const t=x.value.toLowerCase();return C.value.filter(s=>s.text.toLowerCase().includes(t)||s.files.some(a=>a.file_name.toLowerCase().includes(t)))}),te=t=>{f.value=t,M.value=!0,n.value={doc_number:"",doc_date:"",parameter:"",file:null}},q=()=>{M.value=!1,n.value={doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}},se=t=>{const s=t.target.files[0];if(!s){n.value.file=null;return}if(s.type!=="application/pdf"){D.fire({icon:"error",title:"Format Salah",text:"File harus berformat PDF!"}),t.target.value="",n.value.file=null;return}const a=1*1024*1024;if(s.size>a){D.fire({icon:"error",title:"Ukuran File Terlalu Besar",text:"Ukuran maksimal file adalah 1MB!"}),t.target.value="",n.value.file=null;return}n.value.file=s},ae=(t,s)=>{f.value=s,M.value=!0,n.value={doc_number:t.doc_number||"",doc_date:t.doc_date||"",parameter:t.parameter||"",file:null,file_id:t.id}},le=async()=>{var s;if(!n.value.file&&!n.value.file_id){D.fire({icon:"warning",title:"File Belum Dipilih",text:"Silakan pilih file terlebih dahulu."});return}k.value=!0;const t=new FormData;t.append("doc_number",n.value.doc_number),t.append("doc_date",n.value.doc_date),t.append("parameter",n.value.parameter),n.value.file&&t.append("file",n.value.file),t.append("id_doc_type",f.value.id);try{n.value.file_id?await R.post(`/api/reupload-document/${n.value.file_id}`,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{a.total&&(v.value=Math.round(a.loaded*100/a.total))}}):await R.post("/api/upload-document",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{a.total&&(v.value=Math.round(a.loaded*100/a.total))}}),D.fire({icon:"success",title:n.value.file_id?"Reupload Berhasil!":"Upload Berhasil!",showConfirmButton:!1,timer:1500}),await oe(f.value.id),q()}catch(a){let p="Terjadi kesalahan saat mengupload file.";if(((s=a.response)==null?void 0:s.status)===422&&a.response.data.errors){const r=a.response.data.errors;p=Object.values(r).flat().join(`
`)}D.fire({icon:"error",title:"Upload Gagal",text:p})}finally{k.value=!1,v.value=0}},oe=async t=>{g.docsUpdateState=!0,await g.getMyDocuments();const a=g.myDocuments.filter(r=>r.id_doc_type===t||r.doc_type_id===t||r.doc_type===t).sort((r,b)=>r.file_name.localeCompare(b.file_name)),p=C.value.find(r=>r.id===t);p&&(p.files=a)};return re(async()=>{V.value=!0,await g.getDocsUpdateState(),console.log("eh kepanggil fetchdata didalam onMounted Doclist"),await Y(),V.value=!1}),(t,s)=>{var a,p,r,b,A,O,G,Q,H,J;return d(),i(L,null,[he,e("section",fe,[e("div",ge,[e("div",be,[e("div",ye,[e("div",xe,[w(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>x.value=l),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[T,x.value]]),e("div",{class:"input-group-append"},[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:ee},"Reset")])]),V.value?(d(),i("div",ke,Ue)):I.value.length?(d(),i("div",Ce,[e("ul",Se,[(d(!0),i(L,null,$(I.value,(l,j)=>(d(),i("li",{key:l.id,class:"mb-2"},[e("div",Fe,[e("div",{onClick:u=>Z(l),class:"flex-grow-1 d-flex align-items-center"},[e("i",{class:P([l.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),e("span",Te,[y(c(j+1)+". "+c(l.text)+" ",1),e("span",Le,c(l.files.length),1)])],8,Me),e("button",{class:"btn btn-sm btn-success ml-2",onClick:u=>te(l)},"+ Upload",8,Pe)]),w(e("ul",Ve,[(d(!0),i(L,null,$(l.files,u=>(d(),i("li",{key:u.id,class:"cursor-pointer p-1 rounded hover-bg-light small"},[e("div",Be,[e("div",{onClick:ne=>E(u),class:"d-flex align-items-center"},[$e,e("span",null,c(u.file_name),1),e("span",{class:P(["badge badge-sm ml-2",N(u.status)])},c(u.status||"Pending"),3)],8,je),u.status==="Rejected"?(d(),i("button",{key:0,class:"btn btn-sm btn-outline-danger ml-2",onClick:ne=>ae(u,l)}," Reupload ",8,Re)):h("",!0)]),u.status==="Rejected"&&u.verif_notes?(d(),i("div",Ne,[ze,y(" Catatan: "+c(u.verif_notes),1)])):h("",!0)]))),128)),l.files.length?h("",!0):(d(),i("li",Ie," Tidak ada file diupload. "))],512),[[_e,l.expanded]])]))),128))])])):(d(),i("div",qe,Oe))])])])]),S.value?(d(),i("div",Ge,[e("div",Qe,[e("div",He,[e("div",Je,[Ke,e("button",{type:"button",class:"close",onClick:s[1]||(s[1]=l=>{S.value=null,m.value=null})},Xe)]),e("div",Ye,[e("div",Ze,[e("div",Ee,[e("table",et,[e("tbody",null,[e("tr",null,[tt,e("td",null,c(((a=m.value)==null?void 0:a.doc_type_text)||"â€”"),1)]),e("tr",null,[st,e("td",null,c(((p=m.value)==null?void 0:p.doc_number)||"â€”"),1)]),e("tr",null,[at,e("td",null,c(((r=m.value)==null?void 0:r.doc_date)||"â€”"),1)]),e("tr",null,[lt,e("td",null,c(((b=m.value)==null?void 0:b.parameter)||"â€”"),1)]),e("tr",null,[ot,e("td",null,[e("span",{class:P(["badge",N((A=m.value)==null?void 0:A.status)])},c(((O=m.value)==null?void 0:O.status)||"Pending"),3)])]),(G=m.value)!=null&&G.verif_notes?(d(),i("tr",nt,[it,e("td",dt,c(m.value.verif_notes),1)])):h("",!0)])]),rt,B.value?(d(),i("div",ct,[ut,y(" Mengambil data... ")])):F.value.length?(d(),i("ul",_t,[(d(!0),i(L,null,$(F.value,(l,j)=>(d(),i("li",{key:j,class:"list-group-item py-2 px-2",style:{"line-height":"1.4"}},[e("div",null,[e("span",mt,c(l.status),1),pt,e("span",vt,c(l.verifier_name),1),e("small",ht," pada "+c(l.verified_at),1)]),l.notes?(d(),i("div",ft,[gt,y(c(l.notes),1)])):h("",!0)]))),128))])):(d(),i("div",bt,"Tidak ada log verifikasi."))]),e("div",yt,[e("iframe",{src:`${S.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",style:{height:"70vh",border:"1px solid #ccc"}},null,8,xt)])])])])])])):h("",!0),M.value?(d(),i("div",kt,[e("div",wt,[e("div",Dt,[e("div",Ut,[e("h5",Ct,"Upload Dokumen: "+c((Q=f.value)==null?void 0:Q.text),1),e("button",{type:"button",class:"close",onClick:q},Ft)]),e("div",Mt,[e("form",{onSubmit:ce(le,["prevent"])},[e("input",{type:"hidden",value:(H=f.value)==null?void 0:H.id},null,8,Tt),e("div",Lt,[Pt,e("input",{type:"text",class:"form-control",value:(J=f.value)==null?void 0:J.text,readonly:""},null,8,Vt)]),e("div",Bt,[jt,w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>n.value.doc_number=l),type:"text",class:"form-control",required:""},null,512),[[T,n.value.doc_number]])]),e("div",$t,[Rt,w(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>n.value.doc_date=l),type:"date",class:"form-control",required:""},null,512),[[T,n.value.doc_date]])]),e("div",Nt,[zt,w(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>n.value.parameter=l),type:"text",class:"form-control"},null,512),[[T,n.value.parameter]])]),e("div",It,[qt,e("input",{onChange:se,type:"file",class:"form-control",accept:"application/pdf",required:""},null,32)]),k.value?(d(),i("div",At,[e("div",Ot,[e("div",{class:P(["progress-bar progress-bar-striped progress-bar-animated",W.value]),role:"progressbar",style:ue({width:v.value+"%"}),"aria-valuenow":v.value,"aria-valuemin":"0","aria-valuemax":"100"},c(v.value)+"% ",15,Gt)])])):h("",!0),e("div",Qt,[e("button",{type:"submit",class:"btn btn-primary",disabled:k.value},[k.value?(d(),i("span",Jt,[Kt,y(" Uploading... ")])):(d(),i("span",Wt," Upload "))],8,Ht)])],32)])])])])):h("",!0)],64)}}},ts=ie(Xt,[["__scopeId","data-v-bf519ecc"]]);export{ts as default};
