import{e as V,r as m,c as d,f as S,g as M,o as u,_ as T,u as R,h as C,i as b,a as e,w as _,T as x,j as D,k as w,v as P,l as U,n as z,m as q,p as B,d as k,q as L,s as A,t as I,x as N}from"./app-BGdnytQN.js";import{u as W}from"./MasterDataStore-CU3MiRKr.js";import"./LoadingStore-tRTMWa3h.js";const j={key:1,style:{"min-height":"48px"},"aria-hidden":"true"},K=V({__name:"TurnstileWidget",props:{sitekey:{type:String,required:!0},modelValue:String,disableAutoReload:{type:Boolean,default:!1},theme:{type:String,default:"light"},size:{type:String,default:"normal"}},emits:["update:modelValue","error","expired"],setup(h,{expose:c,emit:g}){const n=h,a=g,l=m(null);let o=null;const r=typeof window<"u",p=m(!1),v=()=>new Promise((s,y)=>{if(!r)return y();if(window.turnstile||document.querySelector("#cf-turnstile"))return s();const i=document.createElement("script");i.id="cf-turnstile",i.src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit",i.async=!0,i.defer=!0,i.onload=()=>s(),i.onerror=()=>y(),document.head.appendChild(i)}),f=()=>{!r||!window.turnstile||!l.value||(o=window.turnstile.render(l.value,{sitekey:n.sitekey,theme:n.theme,size:n.size,callback:s=>a("update:modelValue",s),"expired-callback":()=>{a("update:modelValue",""),a("expired"),n.disableAutoReload||t()},"error-callback":()=>{a("error"),n.disableAutoReload||t()}}))},t=()=>{if(r&&window.turnstile&&o)try{window.turnstile.reset(o)}catch(s){console.warn("[TurnstileWidget] Reset failed:",s)}};return c({reset:t,execute:()=>{if(r&&window.turnstile&&o)try{window.turnstile.execute(o)}catch(s){console.warn("[TurnstileWidget] Execute failed:",s)}}}),S(()=>{p.value=!0,v().then(()=>f()).catch(()=>{a("error"),n.disableAutoReload||t()})}),M(()=>{if(r&&window.turnstile&&o)try{window.turnstile.remove(o)}catch(s){console.warn("[TurnstileWidget] Cleanup failed:",s)}}),(s,y)=>p.value?(u(),d("div",{key:0,ref_key:"containerRef",ref:l},null,512)):(u(),d("div",j))}}),E={class:"login-page"},G={key:0,class:"loading-overlay"},H={class:"login-box"},$={class:"card card-outline card-success"},F={class:"card-body login-card-body"},J={key:0,class:"alert alert-danger",role:"alert"},O={class:"input-group mb-3"},Q={class:"input-group mb-3"},X=["type"],Y={class:"input-group-append"},Z={class:"text-center row justify-content-center"},ee={class:"form-group recaptcha-container mx-auto"},te={class:"row mb-3"},se={class:"col-8"},ae={class:"icheck-primary"},oe={class:"col-4"},re=["disabled"],ne={key:0},le={key:1},ie="0x4AAAAAABg5q-5b8cUPKPGt",de={__name:"Login",setup(h){const c=R(),g=W(),n=L(),a=C({username:"",password:"",remember:!0}),l=m(!1),o=m(!1),r=m(""),p=m("");S(()=>{});const v=async()=>{var f,t;o.value=!0,r.value="";try{await N.post("/login",{...a,"cf-turnstile-response":p.value}),await c.getAuthUser(),await g.getDoctypeList(),await c.getMyDocuments(),c.isAuthenticated=!0,c.activeLayout="user",n.push("/user/dashboard")}catch(s){console.error("Login error:",s),r.value=((t=(f=s.response)==null?void 0:f.data)==null?void 0:t.message)||"Terjadi kesalahan saat login."}finally{setTimeout(()=>{o.value=!1},400)}};return(f,t)=>(u(),d("div",E,[b(x,{name:"fade"},{default:_(()=>[o.value?(u(),d("div",G,t[5]||(t[5]=[e("div",{class:"spinner"},null,-1),e("p",null,"Memproses login...",-1)]))):A("",!0)]),_:1}),e("div",H,[t[10]||(t[10]=e("div",{class:"login-logo text-center mb-4"},[e("h1",{class:"mb-1",style:{"font-size":"1.75rem","font-weight":"700",color:"#28a745"}},"SIGARDA"),e("p",{class:"mb-0",style:{"font-size":"0.95rem","font-weight":"500"}},"Sistem Informasi Gerbang Arsip Digital Pegawai"),e("p",{style:{"font-size":"0.85rem",color:"#6c757d"}},"Kementerian Agama Kab. Pesisir Selatan")],-1)),e("div",$,[e("div",F,[t[8]||(t[8]=e("p",{class:"login-box-msg"},"Silakan masuk untuk memulai sesi",-1)),b(x,{name:"fade"},{default:_(()=>[r.value?(u(),d("div",J,I(r.value),1)):A("",!0)]),_:1}),e("form",{onSubmit:D(v,["prevent"]),autocomplete:"off"},[e("div",O,[w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.username=s),type:"text",class:"form-control",placeholder:"NIP Anda",required:""},null,512),[[P,a.username]]),t[6]||(t[6]=e("div",{class:"input-group-append"},[e("div",{class:"input-group-text"},[e("span",{class:"fas fa-envelope"})])],-1))]),e("div",Q,[w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.password=s),type:l.value?"text":"password",class:"form-control",placeholder:"Password",required:""},null,8,X),[[U,a.password]]),e("div",Y,[e("button",{class:"input-group-text",type:"button",onClick:t[2]||(t[2]=s=>l.value=!l.value),tabindex:"-1"},[e("i",{class:z(l.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),e("div",Z,[e("div",ee,[b(q(K),{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=s=>p.value=s),sitekey:ie,theme:"light"},null,8,["modelValue"])])]),e("div",te,[e("div",se,[e("div",ae,[w(e("input",{type:"checkbox",id:"remember","onUpdate:modelValue":t[4]||(t[4]=s=>a.remember=s)},null,512),[[B,a.remember]]),t[7]||(t[7]=e("label",{for:"remember"},"Â  Remember Me",-1))])]),e("div",oe,[e("button",{type:"submit",class:"btn btn-primary btn-block",disabled:o.value},[o.value?(u(),d("span",ne,"Memuat...")):(u(),d("span",le,"Sign In"))],8,re)])])],32),t[9]||(t[9]=e("p",{class:"mb-1"},[e("a",{href:"https://wa.me/6282298476941?text=Halo%2C%20saya%20ingin%20bertanya",target:"_blank"},[k("Lupa Password? "),e("br"),k(" Hubungi Admin Satker")])],-1))])])])]))}},me=T(de,[["__scopeId","data-v-88c9ca37"]]);export{me as default};
