import{_ as N,e as c,f as B,c as I,o as T,b as D,a as n,F as E,I as v,$ as h,m as R,q as V}from"./app-r8EeV8UG.js";import"./style-DqCRSz3P.js";import{u as A}from"./MasterDataStore-zoDL_lFL.js";import"./LoadingStore-D0rrXBQR.js";const F={__name:"WorkUnitMonitor",setup(W){const b=R(),u=c([]),m=c(new Map),w=c(!1),k=c(null);c(new Map);const p=t=>String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),_=t=>{const e=new Map,a=s=>{var l;for(const i of s)e.set(String(i.id),i),(l=i.children)!=null&&l.length&&a(i.children)};return a(t),e},x=()=>u.value.map(e=>({id:String(e.id),text:p(e.unit_name),type:"workunit",children:!0})),$=t=>{const e=m.value.get(String(t));return e?(e.children||[]).map(s=>({id:String(s.id),text:p(s.unit_name),type:"workunit",children:!0})):[]},M=async t=>{const e=String(t);if(o.employeesCacheByUnit[e])return o.employeesCacheByUnit[e];const a=await V.get(`/api/work-units/${e}/employees`),s=Array.isArray(a.data)?a.data:a.data.data??[];return o.setEmployees(e,s),s},f=async()=>{await v();const t=h("#tree-container");t.jstree(!0)&&t.jstree(!0).destroy(),t.off("click",".js-doc-link"),t.off(".jstree").jstree({core:{check_callback:!0,themes:{stripes:!0},html_titles:!0,data:async(e,a)=>{try{if(e.id==="#"){a(x());return}if(e.type==="employee"){a([]);return}const s=e.id,l=$(s),i=r=>r>=80?"progress-bar-success":r>=60?"progress-bar-info":r>=40?"progress-bar-warning":"progress-bar-danger",g=(await M(s)).map(r=>{const d=Number(r.progress_dokumen??0),y=d.toFixed(2),C=p(r.full_name),U=i(d);return{id:`emp-${s}-${r.id}`,type:"employee",children:!1,text:`
                  <span class="w-100">
                    <span class="emp-label">${C} â€” ${d}%</span>
                    <a href="#"
                      class="badge badge-sm badge-info ml-2 js-doc-link"
                      data-user-id="${r.id}">
                      <i class="far fa-folder"></i> dokumen
                    </a>
                    <div class="progress progress-xxs">
                      <div class="progress-bar ${U} progress-bar-striped" role="progressbar"
                          aria-valuenow="${y}" aria-valuemin="0" aria-valuemax="100" style="width: ${Math.max(0,Math.min(100,d))}%">
                        <span class="sr-only">${y}% Complete</span>
                      </div>
                    </div>
                  </span>
                `}});if(l.length===0&&g.length===0){a([{id:`info-empty-${s}`,text:"Belum ada data.",type:"info",children:!1,li_attr:{class:"text-muted"}}]);return}a([...l,...g])}catch{a([{id:`info-error-${e.id}-${Date.now()}`,text:"Gagal memuat data.",type:"info",children:!1,li_attr:{class:"text-danger"}}])}}},plugins:["types","state"],state:{key:"monitor-tree-v1"},types:{workunit:{icon:"far fa-folder"},employee:{icon:"far fa-user"},info:{icon:"far fa-circle"}}}),k.value=t.jstree(!0),w.value=!0,t.on("click",".js-doc-link",e=>{e.preventDefault(),e.stopPropagation();const a=e.currentTarget.getAttribute("data-user-id");a&&b.push(`/admin/users/${a}/documents`)}),t.on("select_node.jstree",(e,a)=>{})},j=async()=>{o.clearEmployeesCache(),await f()},S=async()=>{await v();const e=h("#tree-container").jstree(!0);if(e){try{e.clear_state()}catch{}try{e.deselect_all(!0),e.close_all("#",0)}catch{}try{e.redraw(!0)}catch{}}},o=A();return B(async()=>{o.hydrateEmployeesCache(),await o.getWorkUnitMonitorList();const t=o.workUnitMonitorList;console.log("resMaster"),console.log(t),u.value=t.data||[],m.value=_(u.value),await f()}),(t,e)=>(T(),I(E,null,[e[2]||(e[2]=D('<div class="content-header" data-v-3275e652><div class="container-fluid" data-v-3275e652><div class="row mb-2" data-v-3275e652><div class="col-sm-6" data-v-3275e652><h1 class="m-0" data-v-3275e652>Monitor Satuan Kerja</h1></div><div class="col-sm-6" data-v-3275e652><ol class="breadcrumb float-sm-right" data-v-3275e652><li class="breadcrumb-item" data-v-3275e652><a href="#" data-v-3275e652>Home</a></li><li class="breadcrumb-item active" data-v-3275e652>Daftar Satker</li></ol></div></div></div></div>',1)),n("div",{class:"content"},[n("div",{class:"container-fluid"},[n("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e[0]||(e[0]=n("h5",{class:"mb-0"},"Monitoring Pegawai",-1)),n("div",{class:"btn-group"},[n("button",{class:"btn btn-sm btn-primary",onClick:j}," Refresh "),n("button",{class:"btn btn-sm btn-outline-secondary",onClick:S}," Reset View ")])]),e[1]||(e[1]=n("div",{id:"tree-container"},null,-1))])])],64))}},J=N(F,[["__scopeId","data-v-3275e652"]]);export{J as default};
