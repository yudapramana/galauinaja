const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-Dt9Ax8XL.js","assets/app-Bc5SgoDF.css"])))=>i.map(i=>d[i]);
import{_ as ve,B as ke,r as u,C as q,D as G,f as ge,E as Y,c as l,o as i,a as e,F as A,G as N,t as o,x as _,d as j,k as R,v as X,n as U,j as E,H as be,m as Z,y as v,I as _e,J as ye}from"./app-Dt9Ax8XL.js";import{S as k}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const he={class:"content-header py-1"},we={class:"container-fluid"},xe={class:"d-flex align-items-center flex-nowrap mb-1"},De={class:"ml-auto"},Ce=["value"],Se={class:"d-flex align-items-center justify-content-end"},Ae={class:"badge badge-info badge-pill mr-2"},je=["disabled"],Me={key:0,class:"fas fa-spinner fa-spin mr-1"},Pe={class:"content"},Ve={class:"container-fluid"},Ie={class:"card"},Ge={class:"card-header d-flex"},Ne={class:"card-body table-responsive p-0"},Re={class:"table table-bordered table-hover text-sm"},Ue={key:0},Ee={key:1},Fe={class:"text-truncate",style:{"max-width":"240px"}},Le={key:0,type:"button",class:"btn btn-warning btn-sm mr-1 mb-1",disabled:""},$e=["onClick"],Be=["onClick","disabled"],Te={key:0,class:"fas fa-spinner fa-spin mr-1"},He={class:"card-footer clearfix"},We={class:"d-flex justify-content-between align-items-center"},Ke={class:"text-muted"},Qe={class:"pagination pagination-sm m-0"},Je={class:"page-item disabled"},ze={class:"page-link"},Oe={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},qe={class:"modal-dialog modal-fullscreen",role:"document"},Ye={class:"modal-content"},Xe={class:"modal-body row"},Ze={class:"col-md-7"},et={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},tt=["src"],at={key:1,class:"text-muted text-center py-5"},nt={key:0},st={key:1},lt={class:"col-md-5"},it={class:"mb-3"},ot={class:"table table-bordered table-sm"},rt=["innerHTML"],ut={style:{"font-size":"smaller"}},dt={class:"form-group"},ct={key:0,class:"form-group"},mt=["value"],pt={class:"form-group"},ft={class:"text-end mt-3"},vt={key:0,type:"button",class:"btn btn-warning btn-sm mr-1 mb-1",disabled:""},kt=["disabled"],gt={key:0,class:"fas fa-spinner fa-spin me-1"},bt={__name:"VervalList",setup(_t){const y=ke();y.setting.maintenance=["1",1,!0,"true","on"].includes(y.setting.maintenance);const F=u(null),h=u([]),g=u(null),ee=async()=>{if(!window.jQuery)throw new Error("jQuery belum ter-load");(!window.jQuery.fn||!window.jQuery.fn.select2)&&await _e(()=>import("./app-Dt9Ax8XL.js").then(a=>a.s),__vite__mapDeps([0,1]))},L=()=>{const a=window.$(F.value);a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.select2({theme:"bootstrap4",width:"style",dropdownAutoWidth:!0,placeholder:"Semua Unit Kerja",allowClear:!0,minimumResultsForSearch:8}),a.on("change",function(){g.value=V(a.val()),B()});const t=g.value==null?null:String(g.value);a.val(t).trigger("change.select2")},w=u(""),b=u([]),M=u(!1),x=u(!1),D=u(!1),C=u(null),S=u(null),te=q(()=>S.value===null?"—":S.value),ae=u(null),m=u(!1),d=u(null),c=u({status:"",verif_notes:""}),ne=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),se=q(()=>{var t;const a=(t=d.value)==null?void 0:t.file_url;return a?ne?`https://docs.google.com/gview?url=${encodeURIComponent(a)}`:a:""}),r=u({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),le=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],ie=async()=>{try{const{data:a}=await v.get("/api/work-units/fetch");h.value=Array.isArray(a)?a:(a==null?void 0:a.data)||[]}catch{h.value=[]}},P=async(a=1)=>{M.value=!0;try{const t=await v.get("/api/emp-documents",{params:{search:w.value,page:a,per_page:r.value.per_page}});b.value=t.data.data||[],r.value={...r.value,...t.data.meta,...t.data}}catch(t){console.error("Gagal memuat dokumen",t)}finally{M.value=!1}},V=a=>{if(a==null||a===""||a==="null")return null;const t=parseInt(a,10);return Number.isNaN(t)?null:t},B=async()=>{try{const a={},t=V(g.value);t!==null&&(a.id_work_unit=t);const{data:s}=await v.get("/api/emp-documents/remaining",{params:a});S.value=typeof(s==null?void 0:s.remaining)=="number"?s.remaining:null}catch{S.value=null}},p=async()=>{await Promise.all([P(r.value.current_page),B()])},oe=async()=>{var a,t;D.value=!0;try{const{data:s}=await v.post("/api/emp-documents/claim",{count:5,id_work_unit:V(g.value)});await p();const f=(s==null?void 0:s.claimed)??(Array.isArray(s==null?void 0:s.data)?s.data.length:s!=null&&s.data?1:0);k.fire({icon:"success",title:"Berhasil",text:`${f} dokumen berhasil diambil dari antrian.`,timer:1800,showConfirmButton:!1}),Array.isArray(s==null?void 0:s.data)&&s.data.length?I(s.data[0]):b.value.length&&I(b.value[0])}catch(s){const f=((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Tidak ada dokumen tersedia untuk di-claim";k.fire({icon:"info",title:"Info",text:f})}finally{D.value=!1}},re=async a=>{if(!(!(a!=null&&a.id)||!confirm("Lepaskan assignment dokumen ini? Dokumen akan kembali ke antrian umum."))){C.value=a.id;try{await v.post(`/api/emp-documents/${a.id}/release`),await p(),k.fire({icon:"success",title:"Dilepas",text:"Dokumen berhasil dilepas dari tugas Anda.",timer:1500,showConfirmButton:!1})}catch{k.fire({icon:"error",title:"Gagal",text:"Gagal melepas dokumen."})}finally{C.value=null}}},T=a=>{a>=1&&a<=r.value.last_page&&P(a)},I=a=>{d.value=a,c.value={status:a.status==="Pending"?"Approved":a.status,verif_notes:a.verif_notes||""},$("#verifModal").modal("show")},ue=async()=>{x.value=!0;try{const a=await v.put(`/api/emp-documents/${d.value.id}/verify`,c.value);$("#verifModal").modal("hide"),await p(),k.fire({icon:"success",title:"Berhasil",text:a.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(a){let t="Gagal memverifikasi dokumen.";a.response&&(a.response.status===409&&a.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||a.response.data.message)&&(t=a.response.data.message),k.fire({icon:"error",title:"Verifikasi Gagal",text:t}),$("#verifModal").modal("hide"),await p()}finally{x.value=!1}},de=a=>{const t=a.target.value;t&&(c.value.verif_notes=t)},ce=()=>{m.value=!1},me=()=>{m.value=!0};return G(()=>{var a;return(a=d.value)==null?void 0:a.file_url},async a=>{var t;if(m.value=!1,!!a)try{const s=await fetch(a,{method:"HEAD"});(!s.ok||!((t=s.headers.get("content-type"))!=null&&t.includes("pdf")))&&(m.value=!0)}catch{m.value=!0}}),G(w,ye(()=>P(1),300)),ge(async()=>{await ie(),await Y(),await ee(),L(),await p()}),G(()=>h.value.length,async()=>{await Y(),L()}),(a,t)=>{var s,f,H,W,K,Q,J,z,O;return i(),l(A,null,[e("section",he,[e("div",we,[e("div",xe,[t[7]||(t[7]=e("h1",{class:"m-0 font-weight-bold text-dark text-truncate pr-2"}," Verifikasi Dokumen Pegawai ",-1)),e("div",De,[e("select",{ref_key:"workUnitSelect",ref:F,class:"select2bs4 wu-compact","data-placeholder":"Semua Unit Kerja",style:{width:"300px"}},[t[6]||(t[6]=e("option",{value:null},"Semua Unit Kerja",-1)),(i(!0),l(A,null,N(h.value,n=>(i(),l("option",{key:n.id,value:n.id},o(n.unit_code)+" — "+o(n.unit_name),9,Ce))),128))],512)])]),e("div",Se,[e("span",Ae," Sisa: "+o(te.value),1),e("button",{class:"btn btn-outline-primary btn-sm mr-1",onClick:oe,disabled:D.value},[D.value?(i(),l("i",Me)):_("",!0),t[8]||(t[8]=j(" Ambil 5 Dokumen "))],8,je),e("button",{class:"btn btn-secondary btn-sm",onClick:p},"Refresh")])])]),e("section",Pe,[e("div",Ve,[e("div",Ie,[e("div",Ge,[R(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>w.value=n),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai (tugas saya)..."},null,512),[[X,w.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:p}," Refresh ")]),e("div",Ne,[e("table",Re,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nama File"),e("th",null,"Status"),e("th",{style:{width:"160px"}},"Aksi")])],-1)),e("tbody",null,[M.value?(i(),l("tr",Ue,t[9]||(t[9]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):b.value.length===0?(i(),l("tr",Ee,t[10]||(t[10]=[e("td",{colspan:"7",class:"text-center"},[j(" Belum ada dokumen yang ditugaskan ke Anda. "),e("br"),e("small",{class:"text-muted"},"Klik “Ambil 5 Dokumen” untuk mengambil dari antrian umum.")],-1)]))):_("",!0),(i(!0),l(A,null,N(b.value,(n,pe)=>(i(),l("tr",{key:n.id},[e("td",null,o(pe+1+(r.value.current_page-1)*r.value.per_page),1),e("td",null,o(n.employee.full_name),1),e("td",null,o(n.employee.nip),1),e("td",null,o(n.doc_type.type_name),1),e("td",Fe,o(n.file_name),1),e("td",null,[e("span",{class:U({"badge badge-warning":n.status==="Pending","badge badge-success":n.status==="Approved","badge badge-danger":n.status==="Rejected"})},o(n.status),3)]),e("td",null,[Z(y).showMaintenanceBadge?(i(),l("button",Le," Maintenance ")):(i(),l("button",{key:1,class:"btn btn-sm btn-primary mr-1 mb-1",onClick:fe=>I(n)}," Verifikasi ",8,$e)),e("button",{class:"btn btn-sm btn-outline-danger",onClick:fe=>re(n),disabled:C.value===n.id,title:"Lepaskan assignment dokumen ini"},[C.value===n.id?(i(),l("i",Te)):_("",!0),t[11]||(t[11]=j(" Lepas "))],8,Be)])]))),128))])])]),e("div",He,[e("div",We,[e("div",Ke," Menampilkan "+o(r.value.from)+" - "+o(r.value.to)+" dari "+o(r.value.total)+" dokumen (tugas saya) ",1),e("ul",Qe,[e("li",{class:U(["page-item",{disabled:r.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=E(n=>T(r.value.current_page-1),["prevent"]))},"«")],2),e("li",Je,[e("span",ze,"Halaman "+o(r.value.current_page)+" / "+o(r.value.last_page),1)]),e("li",{class:U(["page-item",{disabled:r.value.current_page===r.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=E(n=>T(r.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Oe,[e("div",qe,[e("div",Ye,[t[24]||(t[24]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"×")])],-1)),e("div",Xe,[e("div",Ze,[e("div",et,[(s=d.value)!=null&&s.file_url&&!m.value?(i(),l("iframe",{key:0,ref_key:"pdfFrame",ref:ae,src:se.value,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"},onLoad:ce,onError:me},null,40,tt)):(i(),l("div",at,[m.value?(i(),l("p",nt,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses.")):(i(),l("p",st,"File tidak tersedia."))]))])]),e("div",lt,[e("div",it,[e("table",ot,[e("tbody",null,[e("tr",null,[t[13]||(t[13]=e("th",null,"Nama",-1)),e("td",null,o(((H=(f=d.value)==null?void 0:f.employee)==null?void 0:H.full_name)||"-"),1)]),e("tr",null,[t[14]||(t[14]=e("th",null,"NIP",-1)),e("td",null,o(((K=(W=d.value)==null?void 0:W.employee)==null?void 0:K.nip)||"-"),1)]),e("tr",null,[t[15]||(t[15]=e("th",null,"Jenis Dokumen",-1)),e("td",null,o(((J=(Q=d.value)==null?void 0:Q.doc_type)==null?void 0:J.type_name)||"-"),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Parameter",-1)),e("td",{innerHTML:((z=d.value)==null?void 0:z.parameter)||"<i>no_param</i>"},null,8,rt)]),e("tr",null,[t[17]||(t[17]=e("th",null,"Filename",-1)),e("td",ut,o(((O=d.value)==null?void 0:O.file_name)||"-"),1)])])])]),e("form",{onSubmit:E(ue,["prevent"])},[e("div",dt,[t[19]||(t[19]=e("label",null,"Status Verifikasi",-1)),R(e("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>c.value.status=n),class:"form-control",required:""},t[18]||(t[18]=[e("option",{value:"Approved"},"Disetujui",-1),e("option",{value:"Rejected"},"Ditolak",-1)]),512),[[be,c.value.status]])]),c.value.status==="Rejected"?(i(),l("div",ct,[t[21]||(t[21]=e("label",null,"Pilih Alasan Penolakan (opsional)",-1)),e("select",{class:"form-control mb-2",onChange:t[4]||(t[4]=n=>de(n))},[t[20]||(t[20]=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1)),(i(),l(A,null,N(le,n=>e("option",{key:n.code,value:n.note},o(n.code)+" - "+o(n.note),9,mt)),64))],32)])):_("",!0),e("div",pt,[t[22]||(t[22]=e("label",null,"Catatan Verifikasi",-1)),R(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=n=>c.value.verif_notes=n),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[X,c.value.verif_notes]])]),e("div",ft,[Z(y).showMaintenanceBadge?(i(),l("button",vt," Maintenance ")):(i(),l("button",{key:1,type:"submit",class:"btn btn-sm btn-primary",disabled:x.value},[x.value?(i(),l("i",gt)):_("",!0),t[23]||(t[23]=j(" Simpan Verifikasi "))],8,kt))])],32)])])])])])])],64)}}},wt=ve(bt,[["__scopeId","data-v-bb6f0100"]]);export{wt as default};
