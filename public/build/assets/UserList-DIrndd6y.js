import{f as m,u as z,q as C,s as A,c as r,a as t,i,v as d,k as B,F as y,x as j,t as o,y as N,h as k,b as T,z as w,p as G,l as f,o as u,A as I}from"./app-BpeXRWRP.js";import{u as H}from"./MasterDataStore-tlWQTJoC.js";import"./LoadingStore-pSFzAoZq.js";const W={class:"content"},Y={class:"container-fluid"},O={class:"card"},Q={class:"card-header"},R={class:"card-body table-responsive p-0"},X={class:"table table-bordered table-hover text-sm"},Z={key:0},tt={key:1},et=["onClick"],st=["onClick"],at={class:"card-footer clearfix"},lt={class:"d-flex justify-content-between align-items-center"},ot={class:"text-muted"},nt={class:"pagination pagination-sm m-0"},it={class:"page-item disabled"},rt={class:"page-link"},dt={class:"modal fade",id:"userModal",tabindex:"-1",role:"dialog"},ut={class:"modal-dialog modal-lg",role:"document"},mt={class:"modal-content"},pt={class:"modal-header py-2"},vt={class:"modal-title",id:"userModalLabel"},ct={class:"modal-body pt-2"},bt={class:"row"},ft={class:"col-md-6"},gt={class:"form-group mb-2"},_t={class:"form-group mb-2"},yt={class:"form-group mb-2"},kt={class:"form-group mb-2"},wt={class:"form-group mb-2"},Ut={class:"form-group mb-2"},ht=["required"],xt={class:"col-md-6"},Pt={class:"form-group mb-2"},Mt={class:"form-group mb-2"},Vt={class:"form-group mb-2"},St=["value"],Ct={class:"form-group mb-2"},jt={class:"form-group mb-2"},Nt={class:"text-end mt-3"},Tt=["disabled"],Lt={key:0,class:"fas fa-spinner fa-spin me-1"},$t={key:1,class:"fas fa-save me-1"},Kt={__name:"UserList",setup(qt){const c=m(!1),U=H(),L=z(),g=m([]),l=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),b=m(""),_=m(!1),v=m(!1),a=m({}),p=async(n=1)=>{_.value=!0;try{const e=await f.get("/api/users",{params:{page:n,search:b.value}});g.value=e.data.data,l.value={...l.value,...e.data.meta,...e.data}}catch(e){e.response&&e.response.status===401?(console.warn("Unauthorized. Logging out..."),L.logout()):console.error("Gagal memuat data pengguna:",e)}finally{_.value=!1}},q=()=>{v.value=!1,a.value={},$("#userModal").modal("show")},D=n=>{var e;v.value=!0,a.value={...n,...n.employee,id_work_unit:(e=n.employee)==null?void 0:e.id_work_unit},$("#userModal").modal("show")},E=async()=>{c.value=!0;try{v.value?await f.put(`/api/users/${a.value.id}`,a.value):await f.post("/api/users",a.value),p(),$("#userModal").modal("hide")}catch(n){alert("Gagal menyimpan data: "+n)}finally{c.value=!1}},F=async n=>{if(confirm("Yakin ingin menghapus pengguna ini?"))try{await f.delete(`/api/users/${n}`),p()}catch{alert("Gagal menghapus pengguna")}};return C(b,I(()=>p(1),400)),C(()=>a.nip,n=>{a.username=n}),A(()=>{p(),U.getWorkunitList()}),(n,e)=>(u(),r(y,null,[t("section",{class:"content-header"},[t("div",{class:"container-fluid"},[t("div",{class:"d-flex justify-content-between align-items-center"},[e[14]||(e[14]=t("h1",{class:"mb-2"},"Daftar Pengguna",-1)),t("button",{class:"btn btn-primary btn-sm",onClick:q},"+ Tambah Pengguna")])])]),t("section",W,[t("div",Y,[t("div",O,[t("div",Q,[i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),type:"text",class:"form-control",placeholder:"Cari nama, email, NIP, atau unit kerja..."},null,512),[[d,b.value]])]),t("div",R,[t("table",X,[e[17]||(e[17]=t("thead",{class:"thead-light"},[t("tr",null,[t("th",{style:{width:"40px"}},"#"),t("th",null,"Nama"),t("th",null,"Jabatan"),t("th",null,"NIP"),t("th",null,"Unit Kerja"),t("th",null,"Status"),t("th",null,"Aksi")])],-1)),t("tbody",null,[_.value?(u(),r("tr",Z,e[15]||(e[15]=[t("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):g.value.length===0?(u(),r("tr",tt,e[16]||(e[16]=[t("td",{colspan:"7",class:"text-center"},"Tidak ada data pengguna ditemukan.",-1)]))):B("",!0),(u(!0),r(y,null,j(g.value,(s,K)=>{var h,x,P,M,V,S;return u(),r("tr",{key:s.id},[t("td",null,o(K+1+(l.value.current_page-1)*l.value.per_page),1),t("td",null,[t("strong",null,o(((h=s.employee)==null?void 0:h.full_name)||s.name),1)]),t("td",null,o(((x=s.employee)==null?void 0:x.job_title)||"-"),1),t("td",null,o(((P=s.employee)==null?void 0:P.nip)||"-"),1),t("td",null,o(((V=(M=s.employee)==null?void 0:M.work_unit)==null?void 0:V.unit_name)||"-"),1),t("td",null,o(((S=s.employee)==null?void 0:S.employment_status)||"-"),1),t("td",null,[t("button",{class:"btn btn-sm btn-warning mr-1",onClick:J=>D(s)},"Edit",8,et),t("button",{class:"btn btn-sm btn-danger",onClick:J=>F(s.id)},"Hapus",8,st)])])}),128))])])]),t("div",at,[t("div",lt,[t("div",ot," Menampilkan "+o(l.value.from)+" - "+o(l.value.to)+" dari "+o(l.value.total)+" pengguna ",1),t("ul",nt,[t("li",{class:N(["page-item",{disabled:l.value.current_page===1}])},[t("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=k(s=>p(l.value.current_page-1),["prevent"]))},"«")],2),t("li",it,[t("span",rt," Halaman "+o(l.value.current_page)+" / "+o(l.value.last_page),1)]),t("li",{class:N(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=k(s=>p(l.value.current_page+1),["prevent"]))},"»")],2)])])])])]),t("div",dt,[t("div",ut,[t("div",mt,[t("div",pt,[t("h5",vt,[e[18]||(e[18]=t("i",{class:"fas fa-user-edit me-2"},null,-1)),T(o(v.value?"Edit Pengguna":"Tambah Pengguna"),1)]),e[19]||(e[19]=t("button",{type:"button",class:"close","data-dismiss":"modal"},[t("span",null,"×")],-1))]),t("div",ct,[t("form",{onSubmit:k(E,["prevent"])},[t("div",bt,[t("div",ft,[t("div",gt,[e[20]||(e[20]=t("label",{class:"mb-1"},"Nama",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.full_name=s),class:"form-control form-control-sm",required:""},null,512),[[d,a.value.full_name]])]),t("div",_t,[e[21]||(e[21]=t("label",{class:"mb-1"},"Email",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.email=s),class:"form-control form-control-sm",required:""},null,512),[[d,a.value.email]])]),t("div",yt,[e[22]||(e[22]=t("label",{class:"mb-1"},"NIP",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.nip=s),class:"form-control form-control-sm",required:""},null,512),[[d,a.value.nip]])]),t("div",kt,[e[23]||(e[23]=t("label",{class:"mb-1"},"Tanggal Lahir",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.date_of_birth=s),type:"date",class:"form-control form-control-sm"},null,512),[[d,a.value.date_of_birth]])]),t("div",wt,[e[25]||(e[25]=t("label",{class:"mb-1"},"Jenis Kelamin",-1)),i(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.gender=s),class:"form-control form-control-sm"},e[24]||(e[24]=[t("option",{value:"M"},"Laki-laki",-1),t("option",{value:"F"},"Perempuan",-1)]),512),[[w,a.value.gender]])]),t("div",Ut,[e[26]||(e[26]=t("label",{class:"mb-1"},"Password",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.password=s),type:"password",class:"form-control form-control-sm",required:!v.value},null,8,ht),[[d,a.value.password]])])]),t("div",xt,[t("div",Pt,[e[27]||(e[27]=t("label",{class:"mb-1"},"Jabatan",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.job_title=s),class:"form-control form-control-sm"},null,512),[[d,a.value.job_title]])]),t("div",Mt,[e[28]||(e[28]=t("label",{class:"mb-1"},"TMT Jabatan",-1)),i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.tmt_jabatan=s),type:"date",class:"form-control form-control-sm"},null,512),[[d,a.value.tmt_jabatan]])]),t("div",Vt,[e[29]||(e[29]=t("label",{class:"mb-1"},"Unit Kerja",-1)),i(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.id_work_unit=s),class:"form-control form-control-sm"},[(u(!0),r(y,null,j(G(U).workunitList,s=>(u(),r("option",{key:s.id,value:s.id},o(s.text),9,St))),128))],512),[[w,a.value.id_work_unit]])]),t("div",Ct,[e[31]||(e[31]=t("label",{class:"mb-1"},"Status",-1)),i(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>a.value.employment_status=s),class:"form-control form-control-sm"},e[30]||(e[30]=[t("option",{value:"PNS"},"PNS",-1),t("option",{value:"PPPK"},"PPPK",-1)]),512),[[w,a.value.employment_status]])]),t("div",jt,[e[32]||(e[32]=t("label",{class:"mb-1"},"TMT Pangkat",-1)),i(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.tmt_pangkat=s),type:"date",class:"form-control form-control-sm"},null,512),[[d,a.value.tmt_pangkat]])])])]),t("div",Nt,[t("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:c.value},[c.value?(u(),r("i",Lt)):(u(),r("i",$t)),e[33]||(e[33]=T(" Simpan "))],8,Tt)])],32)])])])])])],64))}};export{Kt as default};
