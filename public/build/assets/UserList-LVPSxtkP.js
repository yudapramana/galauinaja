import{r as m,u as F,D as j,f as h,c as d,o as u,a as l,k as s,v as r,x as J,F as _,G as C,t as n,n as E,j as k,d as L,H as g,m as A,y as w,J as B}from"./app-Dt9Ax8XL.js";import{u as G}from"./MasterDataStore-DMV2z-D1.js";import"./LoadingStore-Bmy_De0i.js";const H={class:"content"},R={class:"container-fluid"},z={class:"card"},W={class:"card-header"},O={class:"card-body table-responsive p-0"},Q={class:"table table-bordered table-hover text-sm"},X={key:0},Y={key:1},Z=["onClick"],ll={class:"card-footer clearfix"},tl={class:"d-flex justify-content-between align-items-center"},el={class:"text-muted"},ol={class:"pagination pagination-sm m-0"},sl={class:"page-item disabled"},al={class:"page-link"},nl={class:"modal fade",id:"userModal",tabindex:"-1",role:"dialog"},rl={class:"modal-dialog modal-lg",role:"document"},il={class:"modal-content"},dl={class:"modal-header py-2"},ul={class:"modal-title",id:"userModalLabel"},ml={class:"modal-body pt-2"},pl={class:"row"},vl={class:"col-md-6"},bl={class:"form-group mb-2"},fl={class:"form-group mb-2"},gl={class:"form-group mb-2"},cl={class:"form-group mb-2"},yl={class:"form-group mb-2"},_l={class:"form-group mb-2"},kl={class:"form-group mb-2"},wl=["required"],Ul={class:"col-md-6"},Pl={class:"form-group mb-2"},Vl={class:"form-group mb-2"},Ml={class:"form-group mb-2"},xl=["value"],Tl={class:"form-group mb-2"},Sl={class:"form-group mb-2"},jl={class:"form-group mb-2"},Cl={class:"form-group mb-2"},El={class:"form-group mb-2"},Ll={class:"text-end mt-3"},Nl=["disabled"],Dl={key:0,class:"fas fa-spinner fa-spin me-1"},Il={key:1,class:"fas fa-save me-1"},Jl={__name:"UserList",setup(ql){const b=m(!1),U=G(),N=F(),c=m([]),a=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),f=m(""),y=m(!1),p=m(!1),o=m({}),v=async(i=1)=>{y.value=!0;try{const t=await w.get("/api/users",{params:{page:i,search:f.value}});c.value=t.data.data,a.value={...a.value,...t.data.meta,...t.data}}catch(t){t.response&&t.response.status===401?(console.warn("Unauthorized. Logging out..."),N.logout()):console.error("Gagal memuat data pengguna:",t)}finally{y.value=!1}},D=()=>{p.value=!1,o.value={},$("#userModal").modal("show")},I=i=>{var t;p.value=!0,o.value={...i,...i.employee,id_work_unit:(t=i.employee)==null?void 0:t.id_work_unit},$("#userModal").modal("show")},q=async()=>{b.value=!0;try{p.value?await w.put(`/api/users/${o.value.id}`,o.value):await w.post("/api/users",o.value),v(),$("#userModal").modal("hide")}catch(i){alert("Gagal menyimpan data: "+i)}finally{b.value=!1}};return j(f,B(()=>v(1),400)),j(()=>o.nip,i=>{o.username=i}),h(()=>{v(),U.getWorkunitList()}),(i,t)=>(u(),d(_,null,[l("section",{class:"content-header"},[l("div",{class:"container-fluid"},[l("div",{class:"d-flex justify-content-between align-items-center"},[t[18]||(t[18]=l("h1",{class:"mb-2"},"Daftar Pengguna",-1)),l("button",{class:"btn btn-primary btn-sm",onClick:D},"+ Tambah Pengguna")])])]),l("section",H,[l("div",R,[l("div",z,[l("div",W,[s(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),type:"text",class:"form-control",placeholder:"Cari nama, email, NIP, atau unit kerja..."},null,512),[[r,f.value]])]),l("div",O,[l("table",Q,[t[21]||(t[21]=l("thead",{class:"thead-light"},[l("tr",null,[l("th",{style:{width:"40px"}},"#"),l("th",null,"Nama"),l("th",null,"Jabatan"),l("th",null,"NIP"),l("th",null,"Unit Kerja"),l("th",null,"Status"),l("th",null,"Aksi")])],-1)),l("tbody",null,[y.value?(u(),d("tr",X,t[19]||(t[19]=[l("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):c.value.length===0?(u(),d("tr",Y,t[20]||(t[20]=[l("td",{colspan:"7",class:"text-center"},"Tidak ada data pengguna ditemukan.",-1)]))):J("",!0),(u(!0),d(_,null,C(c.value,(e,K)=>{var P,V,M,x,T,S;return u(),d("tr",{key:e.id},[l("td",null,n(K+1+(a.value.current_page-1)*a.value.per_page),1),l("td",null,[l("strong",null,n(((P=e.employee)==null?void 0:P.full_name)||e.name),1)]),l("td",null,n(((V=e.employee)==null?void 0:V.job_title)||"-"),1),l("td",null,n(((M=e.employee)==null?void 0:M.nip)||"-"),1),l("td",null,n(((T=(x=e.employee)==null?void 0:x.work_unit)==null?void 0:T.unit_name)||"-"),1),l("td",null,n(((S=e.employee)==null?void 0:S.employment_status)||"-"),1),l("td",null,[l("button",{class:"btn btn-sm btn-warning mr-1",onClick:Kl=>I(e)},"Edit",8,Z)])])}),128))])])]),l("div",ll,[l("div",tl,[l("div",el," Menampilkan "+n(a.value.from)+" - "+n(a.value.to)+" dari "+n(a.value.total)+" pengguna ",1),l("ul",ol,[l("li",{class:E(["page-item",{disabled:a.value.current_page===1}])},[l("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=k(e=>v(a.value.current_page-1),["prevent"]))},"«")],2),l("li",sl,[l("span",al," Halaman "+n(a.value.current_page)+" / "+n(a.value.last_page),1)]),l("li",{class:E(["page-item",{disabled:a.value.current_page===a.value.last_page}])},[l("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=k(e=>v(a.value.current_page+1),["prevent"]))},"»")],2)])])])])]),l("div",nl,[l("div",rl,[l("div",il,[l("div",dl,[l("h5",ul,[t[22]||(t[22]=l("i",{class:"fas fa-user-edit me-2"},null,-1)),L(n(p.value?"Edit Pengguna":"Tambah Pengguna"),1)]),t[23]||(t[23]=l("button",{type:"button",class:"close","data-dismiss":"modal"},[l("span",null,"×")],-1))]),l("div",ml,[l("form",{onSubmit:k(q,["prevent"])},[l("div",pl,[l("div",vl,[l("div",bl,[t[24]||(t[24]=l("label",{class:"mb-1"},"Nama Lengkap",-1)),s(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.full_name=e),class:"form-control form-control-sm",required:"",readonly:""},null,512),[[r,o.value.full_name]])]),l("div",fl,[t[25]||(t[25]=l("label",{class:"mb-1"},"Email",-1)),s(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.email=e),type:"email",class:"form-control form-control-sm",readonly:""},null,512),[[r,o.value.email]])]),l("div",gl,[t[26]||(t[26]=l("label",{class:"mb-1"},"NIP",-1)),s(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>o.value.nip=e),class:"form-control form-control-sm",required:"",readonly:""},null,512),[[r,o.value.nip]])]),l("div",cl,[t[27]||(t[27]=l("label",{class:"mb-1"},"Tanggal Lahir",-1)),s(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>o.value.date_of_birth=e),type:"date",class:"form-control form-control-sm",readonly:""},null,512),[[r,o.value.date_of_birth]])]),l("div",yl,[t[29]||(t[29]=l("label",{class:"mb-1"},"Jenis Kelamin",-1)),s(l("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>o.value.gender=e),class:"form-control form-control-sm",readonly:""},t[28]||(t[28]=[l("option",{value:"M"},"Laki-laki",-1),l("option",{value:"F"},"Perempuan",-1)]),512),[[g,o.value.gender]])]),l("div",_l,[t[30]||(t[30]=l("label",{class:"mb-1"},"No. HP",-1)),s(l("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>o.value.phone_number=e),class:"form-control form-control-sm"},null,512),[[r,o.value.phone_number]])]),l("div",kl,[t[31]||(t[31]=l("label",{class:"mb-1"},"Password",-1)),s(l("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>o.value.password=e),type:"password",class:"form-control form-control-sm",required:!p.value},null,8,wl),[[r,o.value.password]])])]),l("div",Ul,[l("div",Pl,[t[32]||(t[32]=l("label",{class:"mb-1"},"Jabatan",-1)),s(l("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>o.value.job_title=e),class:"form-control form-control-sm",required:"",readonly:""},null,512),[[r,o.value.job_title]])]),l("div",Vl,[t[33]||(t[33]=l("label",{class:"mb-1"},"Gol. Ruang",-1)),s(l("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>o.value.gol_ruang=e),class:"form-control form-control-sm",placeholder:"Contoh: III/b",required:"",readonly:""},null,512),[[r,o.value.gol_ruang]])]),l("div",Ml,[t[34]||(t[34]=l("label",{class:"mb-1"},"Unit Kerja",-1)),s(l("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>o.value.id_work_unit=e),class:"form-control form-control-sm",readonly:"",required:""},[(u(!0),d(_,null,C(A(U).workunitList,e=>(u(),d("option",{key:e.id,value:e.id},n(e.text),9,xl))),128))],512),[[g,o.value.id_work_unit]])]),l("div",Tl,[t[36]||(t[36]=l("label",{class:"mb-1"},"Status Kepegawaian",-1)),s(l("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>o.value.employment_status=e),class:"form-control form-control-sm",readonly:"",required:""},t[35]||(t[35]=[l("option",{value:"PNS"},"PNS",-1),l("option",{value:"PPPK"},"PPPK",-1)]),512),[[g,o.value.employment_status]])]),l("div",Sl,[t[37]||(t[37]=l("label",{class:"mb-1"},"TMT Pangkat",-1)),s(l("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>o.value.tmt_pangkat=e),type:"date",class:"form-control form-control-sm",readonly:""},null,512),[[r,o.value.tmt_pangkat]])]),l("div",jl,[t[38]||(t[38]=l("label",{class:"mb-1"},"TMT Jabatan",-1)),s(l("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>o.value.tmt_jabatan=e),type:"date",class:"form-control form-control-sm",readonly:""},null,512),[[r,o.value.tmt_jabatan]])]),l("div",Cl,[t[39]||(t[39]=l("label",{class:"mb-1"},"TMT Pensiun",-1)),s(l("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>o.value.tmt_pensiun=e),type:"date",class:"form-control form-control-sm",readonly:""},null,512),[[r,o.value.tmt_pensiun]])]),l("div",El,[t[41]||(t[41]=l("label",{class:"mb-1"},"Kategori Kepegawaian",-1)),s(l("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>o.value.employment_category=e),class:"form-control form-control-sm"},t[40]||(t[40]=[l("option",{value:"ACTIVE"},"Aktif",-1),l("option",{value:"RETIRED"},"Pensiun",-1),l("option",{value:"LEFT"},"Berhenti",-1),l("option",{value:"DIED"},"Meninggal",-1)]),512),[[g,o.value.employment_category]])])])]),l("div",Ll,[l("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:b.value},[b.value?(u(),d("i",Dl)):(u(),d("i",Il)),t[42]||(t[42]=L(" Simpan "))],8,Nl)])],32)])])])])])],64))}};export{Jl as default};
