import{r,A as Y,B as I,f as K,c as o,o as i,a as e,k as _,v as F,s as b,F as h,C as S,t as n,n as y,j as x,D as Q,d as W,x as A,E as X}from"./app-CYpbZg6t.js";import{S as E}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const Z={class:"content"},ee={class:"container-fluid"},ae={class:"card"},te={class:"card-header d-flex"},se={class:"card-body table-responsive p-0"},le={class:"table table-bordered table-hover text-sm"},ne={key:0},oe={key:1},ie=["onClick"],de={class:"card-footer clearfix"},re={class:"d-flex justify-content-between align-items-center"},ue={class:"text-muted"},me={class:"pagination pagination-sm m-0"},ce={class:"page-item disabled"},pe={class:"page-link"},ve={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},fe={class:"modal-dialog modal-xl",role:"document"},ke={class:"modal-content"},ge={class:"modal-body row"},_e={class:"col-md-7"},be={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},he=["src"],ye={key:1,class:"text-muted text-center py-5"},xe={key:0},De={key:1},we={class:"col-md-5"},Ve={class:"mb-3"},Pe={class:"table table-bordered table-sm"},Ce={style:{"font-size":"smaller"}},Ge={class:"form-group"},Me={key:0,class:"form-group"},Ne=["value"],je={class:"form-group"},Ie={class:"text-end mt-3"},Fe=["disabled"],Se={key:0,class:"fas fa-spinner fa-spin me-1"},Be={__name:"VervalList",setup(Ae){const v=r(""),k=r([]),g=r(!1),f=r(!1),R=r(null),m=r(!1),d=r(null),u=r({status:"",verif_notes:""}),B=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),L=Y(()=>{var a;const t=(a=d.value)==null?void 0:a.file_url;return t?B?`https://docs.google.com/gview?url=${encodeURIComponent(t)}`:t:""}),l=r({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),T=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],c=async(t=1)=>{g.value=!0;try{const a=await A.get("/api/emp-documents",{params:{search:v.value,page:t,per_page:l.value.per_page}});k.value=a.data.data,l.value={...l.value,...a.data.meta,...a.data}}catch(a){console.error("Gagal memuat dokumen",a)}finally{g.value=!1}},D=t=>{t>=1&&t<=l.value.last_page&&c(t)},U=t=>{d.value=t,u.value={status:t.status,verif_notes:t.verif_notes||""},$("#verifModal").modal("show")},z=async()=>{f.value=!0;try{const t=await A.put(`/api/emp-documents/${d.value.id}/verify`,u.value);$("#verifModal").modal("hide"),c(l.value.current_page),E.fire({icon:"success",title:"Berhasil",text:t.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(t){let a="Gagal memverifikasi dokumen.";t.response&&(t.response.status===409&&t.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||t.response.data.message)&&(a=t.response.data.message),E.fire({icon:"error",title:"Verifikasi Gagal",text:a}),$("#verifModal").modal("hide"),c(l.value.current_page)}finally{f.value=!1}},H=t=>{const a=t.target.value;a&&(u.value.verif_notes=a)},J=()=>{m.value=!1},q=()=>{m.value=!0};return I(v,X(()=>c(1),300)),I(()=>{var t;return(t=d.value)==null?void 0:t.file_url},async t=>{var a;if(m.value=!1,!!t)try{const p=await fetch(t,{method:"HEAD"});(!p.ok||!((a=p.headers.get("content-type"))!=null&&a.includes("pdf")))&&(m.value=!0)}catch{m.value=!0}}),K(()=>c()),(t,a)=>{var p,w,V,P,C,G,M,N,j;return i(),o(h,null,[a[21]||(a[21]=e("section",{class:"content-header"},[e("div",{class:"container-fluid"},[e("h1",{class:"mb-2"},"Verifikasi Dokumen Pegawai")])],-1)),e("section",Z,[e("div",ee,[e("div",ae,[e("div",te,[_(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>v.value=s),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai..."},null,512),[[F,v.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:c}," Refresh ")]),e("div",se,[e("table",le,[a[8]||(a[8]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nama File"),e("th",null,"Status"),e("th",null,"Aksi")])],-1)),e("tbody",null,[g.value?(i(),o("tr",ne,a[6]||(a[6]=[e("td",{colspan:"8",class:"text-center"},"Memuat data...",-1)]))):k.value.length===0?(i(),o("tr",oe,a[7]||(a[7]=[e("td",{colspan:"8",class:"text-center"},"Tidak ada dokumen ditemukan.",-1)]))):b("",!0),(i(!0),o(h,null,S(k.value,(s,O)=>(i(),o("tr",{key:s.id},[e("td",null,n(O+1+(l.value.current_page-1)*l.value.per_page),1),e("td",null,n(s.employee.full_name),1),e("td",null,n(s.employee.nip),1),e("td",null,n(s.doc_type.type_name),1),e("td",null,n(s.file_name),1),e("td",null,[e("span",{class:y({"badge badge-warning":s.status==="Pending","badge badge-success":s.status==="Approved","badge badge-danger":s.status==="Rejected"})},n(s.status),3)]),e("td",null,[e("button",{class:"btn btn-sm btn-primary mr-1",onClick:Ee=>U(s)}," Verifikasi ",8,ie)])]))),128))])])]),e("div",de,[e("div",re,[e("div",ue," Menampilkan "+n(l.value.from)+" - "+n(l.value.to)+" dari "+n(l.value.total)+" dokumen ",1),e("ul",me,[e("li",{class:y(["page-item",{disabled:l.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=x(s=>D(l.value.current_page-1),["prevent"]))},"«")],2),e("li",ce,[e("span",pe,"Halaman "+n(l.value.current_page)+" / "+n(l.value.last_page),1)]),e("li",{class:y(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=x(s=>D(l.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",ve,[e("div",fe,[e("div",ke,[a[20]||(a[20]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",ge,[e("div",_e,[e("div",be,[(p=d.value)!=null&&p.file_url&&!m.value?(i(),o("iframe",{key:0,ref_key:"pdfFrame",ref:R,src:L.value,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"},onLoad:J,onError:q},null,40,he)):(i(),o("div",ye,[m.value?(i(),o("p",xe,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses. ")):(i(),o("p",De,"File tidak tersedia."))]))])]),e("div",we,[e("div",Ve,[e("table",Pe,[e("tbody",null,[e("tr",null,[a[9]||(a[9]=e("th",null,"Nama",-1)),e("td",null,n(((V=(w=d.value)==null?void 0:w.employee)==null?void 0:V.full_name)||"-"),1)]),e("tr",null,[a[10]||(a[10]=e("th",null,"NIP",-1)),e("td",null,n(((C=(P=d.value)==null?void 0:P.employee)==null?void 0:C.nip)||"-"),1)]),e("tr",null,[a[11]||(a[11]=e("th",null,"Jenis Dokumen",-1)),e("td",null,n(((M=(G=d.value)==null?void 0:G.doc_type)==null?void 0:M.type_name)||"-"),1)]),e("tr",null,[a[12]||(a[12]=e("th",null,"Parameter",-1)),e("td",null,n(((N=d.value)==null?void 0:N.parameter)||"-"),1)]),e("tr",null,[a[13]||(a[13]=e("th",null,"Filename",-1)),e("td",Ce,n(((j=d.value)==null?void 0:j.file_name)||"-"),1)])])])]),e("form",{onSubmit:x(z,["prevent"])},[e("div",Ge,[a[15]||(a[15]=e("label",null,"Status Verifikasi",-1)),_(e("select",{"onUpdate:modelValue":a[3]||(a[3]=s=>u.value.status=s),class:"form-control",required:""},a[14]||(a[14]=[e("option",{value:"Approved"},"Disetujui",-1),e("option",{value:"Rejected"},"Ditolak",-1)]),512),[[Q,u.value.status]])]),u.value.status==="Rejected"?(i(),o("div",Me,[a[17]||(a[17]=e("label",null,"Pilih Alasan Penolakan (opsional)",-1)),e("select",{class:"form-control mb-2",onChange:a[4]||(a[4]=s=>H(s))},[a[16]||(a[16]=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1)),(i(),o(h,null,S(T,s=>e("option",{key:s.code,value:s.note},n(s.code)+" - "+n(s.note),9,Ne)),64))],32)])):b("",!0),e("div",je,[a[18]||(a[18]=e("label",null,"Catatan Verifikasi",-1)),_(e("textarea",{"onUpdate:modelValue":a[5]||(a[5]=s=>u.value.verif_notes=s),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[F,u.value.verif_notes]])]),e("div",Ie,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:f.value},[f.value?(i(),o("i",Se)):b("",!0),a[19]||(a[19]=W(" Simpan Verifikasi "))],8,Fe)])],32)])])])])])])],64)}}};export{Be as default};
