import{_ as pe,C as fe,e as d,x as O,D as F,f as ve,c as s,o as l,a as e,i as P,E as Y,F as G,G as R,t as i,p as h,d as g,v as Q,n as B,h as E,k as X,q as k,H as ge}from"./app-BWoptFV_.js";import{S as b}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ke={class:"content-header py-1"},be={class:"container-fluid"},_e={class:"row align-items-center mb-2"},ye={class:"col-12 col-md-5 col-lg-4 mt-2 mt-md-0"},he={class:"input-group input-group-sm"},we=["value"],xe={class:"row"},De={class:"col-12"},Ce={class:"d-flex flex-wrap align-items-center justify-content-between justify-content-md-end"},Ae={type:"button",class:"btn btn-info btn-sm font-weight-bold mb-2 mb-md-0 mr-md-2 d-inline-flex align-items-center",disabled:""},Me={key:0,class:"fas fa-spinner fa-spin mr-1"},Ve={key:1,class:"fas fa-inbox mr-1"},Pe={class:"btn-group btn-group-sm"},Ge=["disabled"],Ie={key:0,class:"fas fa-spinner fa-spin mr-1"},Ne={class:"content"},Se={class:"container-fluid"},je={class:"card"},Le={class:"card-header d-flex"},Fe={class:"card-body table-responsive p-0"},Re={class:"table table-bordered table-hover text-sm"},Be={key:0},$e={key:1},Ee={class:"text-truncate",style:{"max-width":"240px"}},Ue={key:0,type:"button",class:"btn btn-warning btn-sm mr-1 mb-1",disabled:""},Te=["onClick"],He=["onClick","disabled"],We={key:0,class:"fas fa-spinner fa-spin mr-1"},qe={class:"card-footer clearfix"},ze={class:"d-flex justify-content-between align-items-center"},Je={class:"text-muted"},Ke={class:"pagination pagination-sm m-0"},Oe={class:"page-item disabled"},Ye={class:"page-link"},Qe={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},Xe={class:"modal-dialog modal-fullscreen",role:"document"},Ze={class:"modal-content"},et={class:"modal-body row"},tt={class:"col-md-7"},at={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},nt=["src"],st={key:1,class:"text-muted text-center py-5"},lt={key:0},it={key:1},ot={class:"col-md-5"},rt={class:"mb-3"},ut={class:"table table-bordered table-sm"},dt=["innerHTML"],mt={style:{"font-size":"smaller"}},ct={class:"form-group"},pt={key:0,class:"form-group"},ft=["value"],vt={class:"form-group"},gt={class:"text-end mt-3"},kt={key:0,type:"button",class:"btn btn-warning btn-sm mr-1 mb-1",disabled:""},bt=["disabled"],_t={key:0,class:"fas fa-spinner fa-spin me-1"},yt={__name:"VervalList",setup(ht){const w=fe();w.setting.maintenance=["1",1,!0,"true","on"].includes(w.setting.maintenance);const I=d([]),_=d(""),x=d(""),y=d([]),N=d(!1),D=d(!1),C=d(!1),A=d(null),M=d(null),Z=O(()=>M.value===null?"—":M.value),S=d(!1),ee=d(null),p=d(!1),m=d(null),c=d({status:"",verif_notes:""}),te=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),ae=O(()=>{var t;const a=(t=m.value)==null?void 0:t.file_url;return a?te?`https://docs.google.com/gview?url=${encodeURIComponent(a)}`:a:""}),u=d({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),ne=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],U=a=>{if(a==null||a===""||a==="null")return null;const t=parseInt(a,10);return Number.isNaN(t)?null:t},se=async()=>{try{const{data:a}=await k.get("/api/work-units/fetch");I.value=Array.isArray(a)?a:(a==null?void 0:a.data)||[]}catch{I.value=[]}},j=async(a=1)=>{N.value=!0;try{const t=await k.get("/api/emp-documents",{params:{search:x.value,page:a,per_page:u.value.per_page}});y.value=t.data.data||[],u.value={...u.value,...t.data.meta,...t.data}}catch(t){console.error("Gagal memuat dokumen",t)}finally{N.value=!1}},T=async()=>{S.value=!0;try{const a={},t=U(_.value);t!==null&&(a.id_work_unit=t);const{data:o}=await k.get("/api/emp-documents/remaining",{params:a});M.value=typeof(o==null?void 0:o.remaining)=="number"?o.remaining:null}catch{M.value=null}finally{S.value=!1}},f=async()=>{await Promise.all([j(u.value.current_page),T()])},le=async()=>{var a,t;C.value=!0;try{const o={count:5},v=U(_.value);v!==null&&(o.id_work_unit=v);const{data:r}=await k.post("/api/emp-documents/claim",o);await f();const V=(r==null?void 0:r.claimed)??(Array.isArray(r==null?void 0:r.data)?r.data.length:r!=null&&r.data?1:0);b.fire({icon:"success",title:"Berhasil",text:`${V} dokumen berhasil diambil dari antrian.`,timer:1800,showConfirmButton:!1}),Array.isArray(r==null?void 0:r.data)&&r.data.length?L(r.data[0]):y.value.length&&L(y.value[0])}catch(o){const v=((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)||"Tidak ada dokumen tersedia untuk di-claim";b.fire({icon:"info",title:"Info",text:v})}finally{C.value=!1}},ie=async a=>{if(!(!(a!=null&&a.id)||!confirm("Lepaskan assignment dokumen ini? Dokumen akan kembali ke antrian umum."))){A.value=a.id;try{await k.post(`/api/emp-documents/${a.id}/release`),await f(),b.fire({icon:"success",title:"Dilepas",text:"Dokumen berhasil dilepas dari tugas Anda.",timer:1500,showConfirmButton:!1})}catch{b.fire({icon:"error",title:"Gagal",text:"Gagal melepas dokumen."})}finally{A.value=null}}},H=a=>{a>=1&&a<=u.value.last_page&&j(a)},L=a=>{m.value=a,c.value={status:a.status==="Pending"?"Approved":a.status,verif_notes:a.verif_notes||""},$("#verifModal").modal("show")},oe=async()=>{D.value=!0;try{const a=await k.put(`/api/emp-documents/${m.value.id}/verify`,c.value);$("#verifModal").modal("hide"),await f(),b.fire({icon:"success",title:"Berhasil",text:a.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(a){let t="Gagal memverifikasi dokumen.";a.response&&(a.response.status===409&&a.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||a.response.data.message)&&(t=a.response.data.message),b.fire({icon:"error",title:"Verifikasi Gagal",text:t}),$("#verifModal").modal("hide"),await f()}finally{D.value=!1}},re=a=>{const t=a.target.value;t&&(c.value.verif_notes=t)},ue=()=>{p.value=!1},de=()=>{p.value=!0};return F(()=>{var a;return(a=m.value)==null?void 0:a.file_url},async a=>{var t;if(p.value=!1,!!a)try{const o=await fetch(a,{method:"HEAD"});(!o.ok||!((t=o.headers.get("content-type"))!=null&&t.includes("pdf")))&&(p.value=!0)}catch{p.value=!0}}),F(x,ge(()=>j(1),300)),F(_,()=>T()),ve(async()=>{await se(),await f()}),(a,t)=>{var o,v,r,V,W,q,z,J,K;return l(),s(G,null,[e("section",ke,[e("div",be,[e("div",_e,[t[8]||(t[8]=e("div",{class:"col-12 col-md-7 col-lg-8"},[e("h1",{class:"m-0 font-weight-bold text-dark text-truncate"}," Verifikasi Dokumen Pegawai ")],-1)),e("div",ye,[e("div",he,[P(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>_.value=n),class:"form-control form-control-sm"},[t[7]||(t[7]=e("option",{value:""},"Semua Unit Kerja",-1)),(l(!0),s(G,null,R(I.value,n=>(l(),s("option",{key:n.id,value:String(n.id)},i(n.unit_code)+" — "+i(n.unit_name),9,we))),128))],512),[[Y,_.value]])])])]),e("div",xe,[e("div",De,[e("div",Ce,[e("button",Ae,[S.value?(l(),s("i",Me)):(l(),s("span",Ve)),e("span",null,"Sisa: "+i(Z.value),1)]),e("div",Pe,[e("button",{class:"btn btn-outline-primary",onClick:le,disabled:C.value},[C.value?(l(),s("i",Ie)):h("",!0),t[9]||(t[9]=g(" Ambil 5 Dokumen "))],8,Ge),e("button",{class:"btn btn-secondary",onClick:f},"Refresh")])])])])])]),e("section",Ne,[e("div",Se,[e("div",je,[e("div",Le,[P(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>x.value=n),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai (tugas saya)..."},null,512),[[Q,x.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:f}," Refresh ")]),e("div",Fe,[e("table",Re,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nama File"),e("th",null,"Status"),e("th",{style:{width:"160px"}},"Aksi")])],-1)),e("tbody",null,[N.value?(l(),s("tr",Be,t[10]||(t[10]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):y.value.length===0?(l(),s("tr",$e,t[11]||(t[11]=[e("td",{colspan:"7",class:"text-center"},[g(" Belum ada dokumen yang ditugaskan ke Anda. "),e("br"),e("small",{class:"text-muted"},"Klik “Ambil 5 Dokumen” untuk mengambil dari antrian umum.")],-1)]))):h("",!0),(l(!0),s(G,null,R(y.value,(n,me)=>(l(),s("tr",{key:n.id},[e("td",null,i(me+1+(u.value.current_page-1)*u.value.per_page),1),e("td",null,[g(i(n.employee.full_name)+" ",1),t[12]||(t[12]=e("br",null,null,-1)),e("strong",null,i(n.employee.workunit.unit_name),1)]),e("td",null,i(n.employee.nip),1),e("td",null,i(n.doc_type.type_name),1),e("td",Ee,i(n.file_name),1),e("td",null,[e("span",{class:B({"badge badge-warning":n.status==="Pending","badge badge-success":n.status==="Approved","badge badge-danger":n.status==="Rejected"})},i(n.status),3)]),e("td",null,[X(w).showMaintenanceBadge?(l(),s("button",Ue," Maintenance ")):(l(),s("button",{key:1,class:"btn btn-sm btn-primary mr-1 mb-1",onClick:ce=>L(n)}," Verifikasi ",8,Te)),e("button",{class:"btn btn-sm btn-outline-danger",onClick:ce=>ie(n),disabled:A.value===n.id,title:"Lepaskan assignment dokumen ini"},[A.value===n.id?(l(),s("i",We)):h("",!0),t[13]||(t[13]=g(" Lepas "))],8,He)])]))),128))])])]),e("div",qe,[e("div",ze,[e("div",Je," Menampilkan "+i(u.value.from)+" - "+i(u.value.to)+" dari "+i(u.value.total)+" dokumen (tugas saya) ",1),e("ul",Ke,[e("li",{class:B(["page-item",{disabled:u.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=E(n=>H(u.value.current_page-1),["prevent"]))},"«")],2),e("li",Oe,[e("span",Ye,"Halaman "+i(u.value.current_page)+" / "+i(u.value.last_page),1)]),e("li",{class:B(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=E(n=>H(u.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Qe,[e("div",Xe,[e("div",Ze,[t[27]||(t[27]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"×")])],-1)),e("div",et,[e("div",tt,[e("div",at,[(o=m.value)!=null&&o.file_url&&!p.value?(l(),s("iframe",{key:0,ref_key:"pdfFrame",ref:ee,src:ae.value,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"},onLoad:ue,onError:de},null,40,nt)):(l(),s("div",st,[p.value?(l(),s("p",lt,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses.")):(l(),s("p",it,"File tidak tersedia."))]))])]),e("div",ot,[e("div",rt,[e("table",ut,[e("tbody",null,[e("tr",null,[t[16]||(t[16]=e("th",null,"Nama",-1)),e("td",null,[g(i(((r=(v=m.value)==null?void 0:v.employee)==null?void 0:r.full_name)||"-"),1),t[15]||(t[15]=e("br",null,null,-1))])]),e("tr",null,[t[17]||(t[17]=e("th",null,"NIP",-1)),e("td",null,i(((W=(V=m.value)==null?void 0:V.employee)==null?void 0:W.nip)||"-"),1)]),e("tr",null,[t[18]||(t[18]=e("th",null,"Jenis Dokumen",-1)),e("td",null,i(((z=(q=m.value)==null?void 0:q.doc_type)==null?void 0:z.type_name)||"-"),1)]),e("tr",null,[t[19]||(t[19]=e("th",null,"Parameter",-1)),e("td",{innerHTML:((J=m.value)==null?void 0:J.parameter)||"<i>no_param</i>"},null,8,dt)]),e("tr",null,[t[20]||(t[20]=e("th",null,"Filename",-1)),e("td",mt,i(((K=m.value)==null?void 0:K.file_name)||"-"),1)])])])]),e("form",{onSubmit:E(oe,["prevent"])},[e("div",ct,[t[22]||(t[22]=e("label",null,"Status Verifikasi",-1)),P(e("select",{"onUpdate:modelValue":t[4]||(t[4]=n=>c.value.status=n),class:"form-control",required:""},t[21]||(t[21]=[e("option",{value:"Approved"},"Disetujui",-1),e("option",{value:"Rejected"},"Ditolak",-1)]),512),[[Y,c.value.status]])]),c.value.status==="Rejected"?(l(),s("div",pt,[t[24]||(t[24]=e("label",null,"Pilih Alasan Penolakan (opsional)",-1)),e("select",{class:"form-control mb-2",onChange:t[5]||(t[5]=n=>re(n))},[t[23]||(t[23]=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1)),(l(),s(G,null,R(ne,n=>e("option",{key:n.code,value:n.note},i(n.code)+" - "+i(n.note),9,ft)),64))],32)])):h("",!0),e("div",vt,[t[25]||(t[25]=e("label",null,"Catatan Verifikasi",-1)),P(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=n=>c.value.verif_notes=n),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[Q,c.value.verif_notes]])]),e("div",gt,[X(w).showMaintenanceBadge?(l(),s("button",kt," Maintenance ")):(l(),s("button",{key:1,type:"submit",class:"btn btn-sm btn-primary",disabled:D.value},[D.value?(l(),s("i",_t)):h("",!0),t[26]||(t[26]=g(" Simpan Verifikasi "))],8,bt))])],32)])])])])])])],64)}}},Dt=pe(yt,[["__scopeId","data-v-1056b3a8"]]);export{Dt as default};
