import{_ as P,e as d,u as $,x as y,f as I,D as T,c as o,o as l,a as t,t as c,M as V,p as x,i as b,v as B,F as h,G as w,n as N,d as D,U as z}from"./app-BWoptFV_.js";import{u as G}from"./MasterDataStore-hCAQVJqd.js";import"./LoadingStore-BQsd_xXe.js";const H={class:"content"},R={class:"container-fluid"},q={class:"mb-3"},Q={class:"d-block mb-1 text-muted font-weight-bold"},j={class:"progress",style:{height:"20px"}},J=["aria-valuenow"],K={class:"card shadow-sm rounded-lg"},O={class:"card-body p-3"},W={class:"input-group mb-3"},X={key:0,class:"text-center p-5"},Y={key:1,class:"tree"},Z={class:"list-unstyled mb-0"},ee=["onClick"],te={class:"ml-2 font-weight-bold"},se={class:"badge badge-pill badge-primary ml-2"},ae={class:"pl-4 mt-1"},oe=["onClick"],le={key:0,class:"text-muted small ml-4 mt-1"},ne={key:2,class:"text-center p-5"},re={key:3,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},ie={class:"modal-dialog modal-xl"},de={class:"modal-content"},ce={class:"modal-header p-2"},ue={class:"modal-body p-2"},pe=["src"],me={key:1,class:"text-muted text-center py-5"},ve={key:0},fe={key:1},_e={__name:"MyDocs",setup(he){const C=d(null),n=d(!1),f=d([]),i=d(null),u=d(""),_=d(!1),L=()=>{n.value=!1},M=()=>{n.value=!0},g=G(),p=$(),m=y(()=>{var a,e;return((e=(a=p.user)==null?void 0:a.employee)==null?void 0:e.progress_dokumen)??0}),S=async()=>{console.log("eh kepanggil fetchdata didalam Doclist"),await g.getDoctypeList(),await p.getMyDocuments();const a=g.doctypeList,e=p.myDocuments;f.value=a.map(s=>{const v=e.filter(r=>(r.id_doc_type===s.id||r.doc_type_id===s.id||r.doc_type===s.id)&&r.status==="Approved");return{id:s.id,text:s.text,expanded:!0,files:v}})},U=a=>{a.expanded=!a.expanded},E=a=>`/api/preview/pdf?path=${encodeURI(a)}`,F=async a=>{if(n.value=!1,!a){n.value="missing_path";return}const e=E(a);i.value=e;try{const s=await fetch(e,{method:"HEAD",credentials:"include",headers:{Accept:"application/pdf"}});if(!s.ok){n.value=s.status===404?"not_found":s.status>=500?"internal_server_error":"fetch_failed";return}(s.headers.get("content-type")||"").toLowerCase().includes("pdf")||(n.value="not_pdf")}catch{n.value="network_error"}},A=()=>{u.value=""},k=y(()=>{if(!u.value)return f.value;const a=u.value.toLowerCase();return f.value.filter(e=>e.text.toLowerCase().includes(a)||e.files.some(s=>s.file_name.toLowerCase().includes(a)))});return I(async()=>{var a,e;_.value=!0,await p.getDocsUpdateState(),console.log("Progress Dokumen:",(e=(a=p.user)==null?void 0:a.employee)==null?void 0:e.progress_dokumen),console.log("eh kepanggil fetchdata didalam onMounted Doclist"),await S(),_.value=!1}),T(()=>i,async a=>{var e;if(n.value=!1,!!a)try{const s=await fetch(a,{method:"HEAD"});(!s.ok||!((e=s.headers.get("content-type"))!=null&&e.includes("pdf")))&&(n.value=!0)}catch{n.value=!0}}),(a,e)=>(l(),o(h,null,[e[7]||(e[7]=t("section",{class:"content-header"},[t("div",{class:"container-fluid"},[t("h3",{class:"text-primary"},"ðŸ“‚ Daftar Dokumen")])],-1)),t("section",H,[t("div",R,[t("div",q,[t("label",Q," Progress Dokumen: "+c(m.value||0)+"% ",1),t("div",j,[t("div",{class:"progress-bar bg-success",style:V({width:m.value+"%"}),role:"progressbar","aria-valuenow":m.value,"aria-valuemin":"0","aria-valuemax":"100"},c(m.value||0)+"% ",13,J)])]),t("div",K,[t("div",O,[t("div",W,[b(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[B,u.value]]),t("div",{class:"input-group-append"},[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:A},"Reset")])]),_.value?(l(),o("div",X,e[2]||(e[2]=[t("div",{class:"spinner-border text-primary mb-2",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("div",{class:"text-muted"},"Memuat daftar dokumen...",-1)]))):k.value.length?(l(),o("div",Y,[t("ul",Z,[(l(!0),o(h,null,w(k.value,(s,v)=>(l(),o("li",{key:s.id,class:"mb-2"},[t("div",{onClick:r=>U(s),class:"d-flex align-items-center cursor-pointer py-1 px-2 bg-light rounded small"},[t("i",{class:N([s.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),t("span",te,[D(c(v+1)+". "+c(s.text)+" ",1),t("span",se,c(s.files.length),1)])],8,ee),b(t("ul",ae,[(l(!0),o(h,null,w(s.files,r=>(l(),o("li",{key:r.id,onClick:ge=>F(r.file_path),class:"cursor-pointer p-1 rounded hover-bg-light small"},[e[3]||(e[3]=t("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),D(" "+c(r.file_name),1)],8,oe))),128)),s.files.length?x("",!0):(l(),o("li",le," Tidak ada file diupload. "))],512),[[z,s.expanded]])]))),128))])])):(l(),o("div",ne,e[4]||(e[4]=[t("span",{class:"text-muted"},"Data tidak ditemukan.",-1)]))),i.value?(l(),o("div",re,[t("div",ie,[t("div",de,[t("div",ce,[e[6]||(e[6]=t("h5",{class:"modal-title"},"Preview Dokumen",-1)),t("button",{type:"button",class:"close",onClick:e[1]||(e[1]=s=>i.value=null)},e[5]||(e[5]=[t("span",null,"Ã—",-1)]))]),t("div",ue,[i.value&&!n.value?(l(),o("iframe",{key:0,ref_key:"pdfFrame",ref:C,src:`${i.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",frameborder:"0",style:{height:"90vh",border:"1px solid #ccc"},onLoad:L,onError:M},null,40,pe)):(l(),o("div",me,[n.value?(l(),o("p",ve,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses. ")):(l(),o("p",fe,"File tidak tersedia."))]))])])])])):x("",!0)])])])])],64))}},be=P(_e,[["__scopeId","data-v-8d2fd07e"]]);export{be as default};
