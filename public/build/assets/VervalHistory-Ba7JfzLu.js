import{u as J,r as o,A as K,B as L,f as O,c as d,o as i,b as Q,a as e,k as p,v as g,D as W,F as b,C as R,t as n,n as h,j as y,x as X,d as Y,s as Z,E as D}from"./app-CS__mXI0.js";import{u as w}from"./toastr-CjOZhsla.js";import{f as ee}from"./helper-D4kaxrhs.js";const te={class:"content"},ae={class:"container-fluid"},se={class:"card"},le={class:"card-header"},ne={class:"row"},oe={class:"col-md-4 mb-2"},de={class:"col-md-3 mb-2"},ie=["value"],ue={class:"col-md-2 mb-2"},re={class:"col-md-2 mb-2"},ce={class:"card-body table-responsive p-0"},me={class:"table table-bordered table-hover text-sm"},ve={key:0},pe={key:1},_e=["innerHTML"],fe={class:"text-muted"},ge={class:"text-muted"},be=["onClick"],he={class:"text-center"},ye=["href"],ke={class:"card-footer clearfix"},xe={class:"d-flex justify-content-between align-items-center"},Ce={class:"text-muted"},Ve={class:"pagination pagination-sm m-0"},Me={class:"page-item disabled"},Ue={class:"page-link"},Ae={class:"modal fade",id:"notesModal",tabindex:"-1",role:"dialog"},Ne={class:"modal-dialog",role:"document"},Se={class:"modal-content"},Te={class:"modal-body"},Le={style:{"white-space":"pre-wrap"}},He={__name:"VervalHistory",setup(Re){const F=w();J();const _=o([]),l=o({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),f=o(!1),r=o(""),c=o(""),j=["Uploaded","Reuploaded","Approved","Rejected","Uploaded by Admin","Reuploaded by Admin"],m=o(""),v=o(""),k=o(""),B=s=>ee(s),H=K(()=>(l.value.current_page-1)*(l.value.per_page||10)),E=s=>s?`/storage/${s}`.replace(/\/+/,"/"):"#",I=s=>{switch(s){case"Approved":return"badge-success";case"Rejected":return"badge-danger";case"Reuploaded":case"Reuploaded by Admin":return"badge-warning";case"Uploaded":case"Uploaded by Admin":return"badge-info";default:return"badge-secondary"}},P=s=>s?s.length>40?s.slice(0,40)+"…":s:"-",z=s=>{k.value=(s==null?void 0:s.verif_notes)||"",$("#notesModal").modal("show")},u=async(s=1)=>{f.value=!0;try{const{data:t}=await X.get("/api/verval-logs",{params:{page:s,per_page:l.value.per_page,search:r.value||void 0,status:c.value||void 0,date_from:m.value||void 0,date_to:v.value||void 0}});_.value=(t==null?void 0:t.data)||[],l.value={...l.value,...t==null?void 0:t.meta,...t}}catch{F.error("Gagal memuat verval history")}finally{f.value=!1}},G=()=>{r.value="",c.value="",m.value="",v.value="",u(1)};return L(r,D(()=>u(1),350)),L([c,m,v],D(()=>u(1),350)),O(()=>{u()}),(s,t)=>(i(),d(b,null,[t[14]||(t[14]=Q('<section class="content-header"><div class="container-fluid"><div class="d-flex justify-content-between align-items-center"><h1 class="mb-2">Verval History Saya</h1><small class="text-muted">Log verifikasi yang saya lakukan</small></div></div></section>',1)),e("section",te,[e("div",ae,[e("div",se,[e("div",le,[e("div",ne,[e("div",oe,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),type:"text",class:"form-control",placeholder:"Cari nomor, nama pegawai, NIP, file, catatan…"},null,512),[[g,r.value]])]),e("div",de,[p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),class:"form-control"},[t[6]||(t[6]=e("option",{value:""},"— Semua Status —",-1)),(i(),d(b,null,R(j,a=>e("option",{key:a,value:a},n(a),9,ie)),64))],512),[[W,c.value]])]),e("div",ue,[p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>m.value=a),type:"date",class:"form-control"},null,512),[[g,m.value]])]),e("div",re,[p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>v.value=a),type:"date",class:"form-control"},null,512),[[g,v.value]])]),e("div",{class:"col-md-1 mb-2"},[e("button",{class:"btn btn-secondary btn-block",onClick:G},"Reset")])])]),e("div",ce,[e("table",me,[t[11]||(t[11]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"50px"}},"#"),e("th",null,"Tanggal"),e("th",null,"Dokumen"),e("th",null,"Pemilik"),e("th",null,"Status"),e("th",null,"Catatan"),e("th",{style:{width:"70px"}},"File")])],-1)),e("tbody",null,[f.value?(i(),d("tr",ve,t[7]||(t[7]=[e("td",{colspan:"7",class:"text-center"},"Memuat data…",-1)]))):_.value.length===0?(i(),d("tr",pe,t[8]||(t[8]=[e("td",{colspan:"7",class:"text-center"},"Belum ada log verifikasi.",-1)]))):(i(!0),d(b,{key:2},R(_.value,(a,q)=>{var x,C,V,M,U,A,N,S,T;return i(),d("tr",{key:a.id},[e("td",null,n(q+1+H.value),1),e("td",null,[e("div",null,n(B(a.created_at)),1)]),e("td",null,[e("div",null,[e("strong",null,n(((C=(x=a.document)==null?void 0:x.doctype)==null?void 0:C.type_name)||"-"),1),t[9]||(t[9]=Y(" · ")),e("span",{innerHTML:((V=a.document)==null?void 0:V.parameter)||"<i>n/a</i>"},null,8,_e)]),e("small",fe,n(((M=a.document)==null?void 0:M.file_name)||"-"),1)]),e("td",null,[e("div",null,[e("strong",null,n(((A=(U=a.document)==null?void 0:U.employee)==null?void 0:A.full_name)||"-"),1)]),e("small",ge,n(((S=(N=a.document)==null?void 0:N.employee)==null?void 0:S.nip)||"-"),1)]),e("td",null,[e("span",{class:h(["badge",I(a.verval_status)])},n(a.verval_status),3)]),e("td",null,[e("a",{href:"#",onClick:y(De=>z(a),["prevent"])},n(P(a.verif_notes)),9,be)]),e("td",he,[(T=a.document)!=null&&T.file_path?(i(),d("a",{key:0,href:E(a.document.file_path),target:"_blank",title:"Lihat file"},t[10]||(t[10]=[e("i",{class:"fas fa-file"},null,-1)]),8,ye)):Z("",!0)])])}),128))])])]),e("div",ke,[e("div",xe,[e("div",Ce," Menampilkan "+n(l.value.from)+" - "+n(l.value.to)+" dari "+n(l.value.total)+" log ",1),e("ul",Ve,[e("li",{class:h(["page-item",{disabled:l.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=y(a=>u(l.value.current_page-1),["prevent"]))},"«")],2),e("li",Me,[e("span",Ue," Halaman "+n(l.value.current_page)+" / "+n(l.value.last_page),1)]),e("li",{class:h(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[5]||(t[5]=y(a=>u(l.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Ae,[e("div",Ne,[e("div",Se,[t[12]||(t[12]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Catatan Verifikasi"),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",Te,[e("p",Le,n(k.value||"-"),1)]),t[13]||(t[13]=e("div",{class:"modal-footer py-2"},[e("button",{type:"button",class:"btn btn-default btn-sm","data-dismiss":"modal"},"Tutup")],-1))])])])])],64))}};export{He as default};
