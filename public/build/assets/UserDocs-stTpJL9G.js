import{_ as Z,e as ce,f as c,L as Y,s as ee,q as me,o as a,c as o,a as e,b as p,t as i,i as k,v as S,F as w,x as V,y as C,M as pe,k as _,h as ve,p as fe,G as _e,l as M,N as be,H as ge}from"./app-j8hqMp9K.js";import{S as L}from"./sweetalert2.all-BghGFt6h.js";import{u as ye}from"./MasterDataStore-Xes_Aze3.js";import"./LoadingStore-gTbx84sl.js";const he={class:"content-header"},xe={class:"container-fluid"},ke={class:"text-primary"},we={class:"text-muted text-sm"},Ce={class:"content"},De={class:"container-fluid"},Ue={class:"card shadow-sm rounded-lg"},Fe={class:"card-body p-3"},Pe={class:"input-group mb-3"},Ie={class:"input-group-append"},Te={key:0,class:"text-center p-5"},Se={key:1,class:"tree"},Ve={class:"list-unstyled mb-0"},Me={class:"d-flex align-items-center justify-between cursor-pointer py-1 px-2 bg-light rounded small"},Le=["onClick"],Ne={class:"ml-2 font-weight-bold"},$e={class:"badge badge-pill badge-primary ml-2"},Be=["onClick"],Re={class:"pl-4 mt-1"},je={class:"d-flex align-items-center justify-content-between w-100"},qe=["onClick"],Ae=["onClick"],Ge={key:0,class:"text-danger mt-1 ml-4 small"},Ke={key:0,class:"text-muted small ml-4 mt-1"},ze={key:2,class:"text-center p-5"},Ee={key:0,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},He={class:"modal-dialog modal-xl"},Je={class:"modal-content"},Oe={class:"modal-header p-2"},Qe={class:"modal-body p-3"},We={class:"row"},Xe={class:"col-md-6 mb-3"},Ye={class:"table table-sm table-bordered"},Ze={key:0},et={class:"text-danger"},tt={key:0,class:"text-muted small d-flex align-items-center"},st={key:1,class:"list-group list-group-unbordered small mb-2"},lt={class:"font-weight-bold text-sm"},at={class:"font-italic text-sm"},ot={class:"text-muted"},nt={key:0,class:"text-danger mt-1 small"},it={key:2,class:"text-muted small"},dt={class:"col-md-6"},rt=["src"],ut={key:1,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},ct={class:"modal-dialog modal-lg modal-dialog-scrollable"},mt={class:"modal-content",style:{"max-height":"90vh",display:"flex","flex-direction":"column"}},pt={class:"modal-header"},vt={class:"modal-title"},ft={class:"modal-body overflow-auto",style:{flex:"1 1 auto"}},_t=["value"],bt={class:"form-group"},gt=["value"],yt={class:"form-group"},ht={class:"form-group"},xt={class:"form-group"},kt={class:"btn-group mb-2 flex-wrap"},wt=["onClick"],Ct={class:"input-group mb-3"},Dt={class:"input-group-append"},Ut={class:"form-group"},Ft={class:"custom-file"},Pt={class:"custom-file-label",for:"exampleInputFile"},It={key:0,class:"mb-3"},Tt={class:"progress",style:{height:"20px"}},St=["aria-valuenow"],Vt={class:"modal-footer"},Mt=["disabled"],Lt={key:0},Nt={key:1},$t={__name:"AdminDocumentViewer",props:{userId:Number},setup(j){const N=ce(),D=()=>{N.back()},g=j,h=c([]),U=c(null),F=c(""),$=c(!1),v=c(null),P=c(!1),b=c(null),x=c(!1),f=c(0),q=c(""),I=c([]),B=c(!1),n=c({doc_number:"",doc_date:"",parameter:"",file:null,fileName:"",file_id:null}),R=ye(),A=async s=>{const t=await M.get(`/api/user-documents/${s}`);return q.value=t.data.user.name,t.data.data},G=async()=>{$.value=!0,await R.getDoctypeList(g.userId);const s=await A(g.userId),t=R.doctypeList;h.value=t.map(u=>{const r=s.filter(d=>d.id_doc_type===u.id||d.doc_type_id===u.id).sort((d,y)=>d.file_name.localeCompare(y.file_name));return{id:u.id,text:u.text,expanded:!0,files:r.map(d=>({...d,doc_type_text:u.text}))}}),$.value=!1},te=async s=>{const u=(await A(g.userId)).filter(d=>d.id_doc_type===s||d.doc_type_id===s).sort((d,y)=>d.file_name.localeCompare(y.file_name)),r=h.value.find(d=>d.id===s);r&&(r.files=u)},se=Y(()=>f.value<30?"bg-danger":f.value<70?"bg-warning":"bg-success"),K=Y(()=>{if(!F.value)return h.value;const s=F.value.toLowerCase();return h.value.filter(t=>t.text.toLowerCase().includes(s)||t.files.some(u=>u.file_name.toLowerCase().includes(s)))}),z=s=>{switch(s){case"Approved":return"badge-success";case"Rejected":return"badge-danger";default:return"badge-secondary"}},le=s=>{s.expanded=!s.expanded},ae=async s=>{B.value=!0;try{const t=await M.get(`/api/document-log/${s}`);I.value=t.data.data||[]}catch(t){console.error("Gagal mengambil log verval:",t),I.value=[]}finally{B.value=!1}},oe=async s=>{v.value=s,U.value=s.file_url,await ae(s.id)},ne=s=>{b.value=s,P.value=!0,n.value={doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}},ie=(s,t)=>{b.value=t,P.value=!0,n.value={doc_number:s.doc_number||"",doc_date:s.doc_date||"",parameter:s.parameter||"",file:null,file_id:s.id}},E=()=>{P.value=!1},de=s=>{const t=s.target.files[0];if(!t||t.type!=="application/pdf"||t.size>1024*1024){L.fire({icon:"error",title:"File Tidak Valid",text:"File harus PDF dan ukuran maksimal 1MB."}),s.target.value="",n.value.fileName="";return}n.value.file=t,n.value.fileName=t.name},re=async()=>{var t,u;if(!n.value.file&&!n.value.file_id)return L.fire({icon:"warning",title:"File Belum Dipilih"});x.value=!0;const s=new FormData;s.append("doc_number",n.value.doc_number),s.append("doc_date",n.value.doc_date),s.append("parameter",n.value.parameter),n.value.file&&s.append("file",n.value.file),s.append("id_doc_type",b.value.id),s.append("user_id",g.userId);try{n.value.file_id?await M.post(`/api/reupload-document/${n.value.file_id}`,s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{r.total&&(f.value=Math.round(r.loaded*100/r.total))}}):await M.post("/api/upload-document",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{r.total&&(f.value=Math.round(r.loaded*100/r.total))}}),L.fire({icon:"success",title:"Upload Berhasil",timer:1500}),await te(b.value.id),E()}catch(r){const d=((u=(t=r.response)==null?void 0:t.data)==null?void 0:u.message)||"Terjadi kesalahan.";L.fire({icon:"error",title:"Upload Gagal",text:d})}finally{x.value=!1,f.value=0}};return ee(G),me(()=>g.userId,G),(s,t)=>{var u,r,d,y,H,J,O,Q,W,X;return a(),o(w,null,[e("section",he,[e("div",xe,[e("h3",ke,[t[7]||(t[7]=p("ðŸ“‚ Dokumen ")),e("small",we,i(q.value),1)]),e("button",{class:"btn btn-sm btn-secondary mt-2",onClick:D},t[8]||(t[8]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1),p(" Kembali ")]))])]),e("section",Ce,[e("div",De,[e("div",Ue,[e("div",Fe,[e("div",Pe,[k(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>F.value=l),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[S,F.value]]),e("div",Ie,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[1]||(t[1]=(...l)=>s.clearSearch&&s.clearSearch(...l))},"Reset")])]),$.value?(a(),o("div",Te,t[9]||(t[9]=[e("div",{class:"spinner-border text-primary mb-2",role:"status"},null,-1),e("div",{class:"text-muted"},"Memuat dokumen...",-1)]))):K.value.length?(a(),o("div",Se,[e("ul",Ve,[(a(!0),o(w,null,V(K.value,(l,T)=>(a(),o("li",{key:l.id,class:"mb-2"},[e("div",Me,[e("div",{onClick:m=>le(l),class:"flex-grow-1 d-flex align-items-center"},[e("i",{class:C([l.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),e("span",Ne,[p(i(T+1)+". "+i(l.text)+" ",1),e("span",$e,i(l.files.length),1)])],8,Le),e("button",{class:"btn btn-sm btn-success ml-2",onClick:m=>ne(l)},"+ Upload",8,Be)]),k(e("ul",Re,[(a(!0),o(w,null,V(l.files,m=>(a(),o("li",{key:m.id,class:"cursor-pointer p-1 rounded hover-bg-light small"},[e("div",je,[e("div",{onClick:ue=>oe(m),class:"d-flex align-items-center"},[t[10]||(t[10]=e("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),e("span",null,i(m.file_name),1),e("span",{class:C(["badge badge-sm ml-2",z(m.status)])},i(m.status||"Pending"),3)],8,qe),m.status==="Rejected"?(a(),o("button",{key:0,class:"btn btn-sm btn-outline-danger ml-2",onClick:ue=>ie(m,l)},"Reupload",8,Ae)):_("",!0)]),m.status==="Rejected"&&m.verif_notes?(a(),o("div",Ge,[t[11]||(t[11]=e("i",{class:"fas fa-info-circle"},null,-1)),p(" Catatan: "+i(m.verif_notes),1)])):_("",!0)]))),128)),l.files.length?_("",!0):(a(),o("li",Ke," Tidak ada file diupload. "))],512),[[pe,l.expanded]])]))),128))])])):(a(),o("div",ze,t[12]||(t[12]=[e("span",{class:"text-muted"},"Data tidak ditemukan.",-1)])))])])])]),U.value?(a(),o("div",Ee,[e("div",He,[e("div",Je,[e("div",Oe,[t[14]||(t[14]=e("h5",{class:"modal-title"},"ðŸ“„ Preview Dokumen",-1)),e("button",{type:"button",class:"close",onClick:t[2]||(t[2]=l=>{U.value=null,v.value=null})},t[13]||(t[13]=[e("span",null,"Ã—",-1)]))]),e("div",Qe,[e("div",We,[e("div",Xe,[e("table",Ye,[e("tbody",null,[e("tr",null,[t[15]||(t[15]=e("th",{style:{width:"40%"}},"Tipe Dokumen",-1)),e("td",null,i(((u=v.value)==null?void 0:u.doc_type_text)||"â€”"),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Nomor Dokumen",-1)),e("td",null,i(((r=v.value)==null?void 0:r.doc_number)||"â€”"),1)]),e("tr",null,[t[17]||(t[17]=e("th",null,"Tanggal Dokumen",-1)),e("td",null,i(((d=v.value)==null?void 0:d.doc_date)||"â€”"),1)]),e("tr",null,[t[18]||(t[18]=e("th",null,"Parameter",-1)),e("td",null,i(((y=v.value)==null?void 0:y.parameter)||"â€”"),1)]),e("tr",null,[t[19]||(t[19]=e("th",null,"Status",-1)),e("td",null,[e("span",{class:C(["badge",z((H=v.value)==null?void 0:H.status)])},i(((J=v.value)==null?void 0:J.status)||"Pending"),3)])]),(O=v.value)!=null&&O.verif_notes?(a(),o("tr",Ze,[t[20]||(t[20]=e("th",null,"Catatan Verifikator",-1)),e("td",et,i(v.value.verif_notes),1)])):_("",!0)])]),t[24]||(t[24]=e("h6",{class:"text-secondary mb-2"},[e("i",{class:"fas fa-clipboard-check mr-1"}),p(" Riwayat Verifikasi ")],-1)),B.value?(a(),o("div",tt,t[21]||(t[21]=[e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),p(" Mengambil data... ")]))):I.value.length?(a(),o("ul",st,[(a(!0),o(w,null,V(I.value,(l,T)=>(a(),o("li",{key:T,class:"list-group-item py-2 px-2",style:{"line-height":"1.4"}},[e("div",null,[e("span",lt,i(l.status),1),t[22]||(t[22]=e("span",{class:"text-muted mx-1"},"oleh",-1)),e("span",at,i(l.verifier_name),1),e("small",ot," pada "+i(l.verified_at),1)]),l.notes?(a(),o("div",nt,[t[23]||(t[23]=e("i",{class:"fas fa-comment-dots mr-1"},null,-1)),p(i(l.notes),1)])):_("",!0)]))),128))])):(a(),o("div",it,"Tidak ada log verifikasi."))]),e("div",dt,[e("iframe",{src:`${U.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",style:{height:"70vh",border:"1px solid #ccc"}},null,8,rt)])])])])])])):_("",!0),P.value?(a(),o("div",ut,[e("div",ct,[e("div",mt,[e("div",pt,[e("h5",vt,"Upload Dokumen Pegawai: "+i((Q=b.value)==null?void 0:Q.text),1),e("button",{type:"button",class:"close",onClick:E},t[25]||(t[25]=[e("span",null,"Ã—",-1)]))]),e("div",ft,[e("form",{onSubmit:ve(re,["prevent"]),id:"uploadForm"},[e("input",{type:"hidden",value:(W=b.value)==null?void 0:W.id},null,8,_t),e("div",bt,[t[26]||(t[26]=e("label",null,"Tipe Dokumen",-1)),e("input",{type:"text",class:"form-control",value:(X=b.value)==null?void 0:X.text,readonly:""},null,8,gt)]),e("div",yt,[t[27]||(t[27]=e("label",null,"Nomor Dokumen",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.doc_number=l),type:"text",class:"form-control",required:"",autofocus:""},null,512),[[S,n.value.doc_number]])]),e("div",ht,[t[28]||(t[28]=e("label",null,"Tanggal Dokumen",-1)),k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.doc_date=l),type:"date",class:"form-control",required:""},null,512),[[S,n.value.doc_date]])]),e("div",xt,[t[29]||(t[29]=e("label",null,"Pilih Parameter (Opsional)",-1)),t[30]||(t[30]=e("br",null,null,-1)),e("div",kt,[(a(!0),o(w,null,V(fe(R).docParameters,l=>(a(),o("button",{key:l,type:"button",class:C(["btn btn-xs btn-outline-secondary mb-1",{active:n.value.parameter===l}]),onClick:T=>n.value.parameter=l},i(l),11,wt))),128))]),e("div",Ct,[k(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.parameter=l),type:"text",class:"form-control",readonly:""},null,512),[[S,n.value.parameter]]),e("div",Dt,[e("button",{type:"button",class:"btn btn-info",onClick:t[6]||(t[6]=l=>n.value.parameter="")},"Reset")])]),t[31]||(t[31]=e("small",{class:"form-text text-muted mb-2"},[e("strong",null,"Info:"),p(" Gunakan parameter diatas jika dokumen pada tipe ini bersifat multiple atau lebih dari satu, seperti "),e("em",null,"Akte Kelahiran Anak"),p(", "),e("em",null,"SKP 2 Tahun Terakhir"),p(", "),e("em",null,"SK Jabatan"),p(", dan sejenisnya. ")],-1))]),e("div",Ut,[t[32]||(t[32]=e("label",null,"Pilih File (PDF)",-1)),e("div",Ft,[e("input",{type:"file",class:"custom-file-input",id:"exampleInputFile",accept:"application/pdf",onChange:de,required:""},null,32),e("label",Pt,i(n.value.fileName||"Pilih file"),1)])]),x.value?(a(),o("div",It,[e("div",Tt,[e("div",{class:C(["progress-bar progress-bar-striped progress-bar-animated",se.value]),role:"progressbar",style:_e({width:f.value+"%"}),"aria-valuenow":f.value,"aria-valuemin":"0","aria-valuemax":"100"},i(f.value)+"% ",15,St)])])):_("",!0)],32)]),e("div",Vt,[e("button",{type:"submit",class:"btn btn-primary",disabled:x.value,form:"uploadForm"},[x.value?(a(),o("span",Lt,t[33]||(t[33]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Uploading... ")]))):(a(),o("span",Nt," Upload "))],8,Mt)])])])])):_("",!0)],64)}}},Bt=Z($t,[["__scopeId","data-v-921dc16d"]]),Rt={__name:"UserDocs",setup(j){const N=be(),D=c(null);return ee(()=>{D.value=parseInt(N.params.id,10)}),(g,h)=>(a(),ge(Bt,{userId:D.value},null,8,["userId"]))}},Kt=Z(Rt,[["__scopeId","data-v-f467faa0"]]);export{Kt as default};
