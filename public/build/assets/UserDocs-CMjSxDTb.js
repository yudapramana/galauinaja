import{_ as ee,f as _e,g as _,N as Z,y as te,x as me,o,c as n,a as e,b as h,t as d,j as D,v as V,F as P,z as j,A as T,O as pe,l as v,i as ve,I as he,m as M,p as fe,e as be,P as ge,J as ye}from"./app-ClEBpTSD.js";import{S as L}from"./sweetalert2.all-DWkFJy1E.js";import{u as xe}from"./MasterDataStore-CDtaQKOa.js";import"./LoadingStore-DaenCWHc.js";const l=g=>(fe("data-v-cf0307e0"),g=g(),be(),g),ke={class:"content-header"},we={class:"container-fluid"},De={class:"text-primary"},Ce={class:"text-muted text-sm"},Ue=l(()=>e("i",{class:"fas fa-arrow-left mr-1"},null,-1)),Fe={class:"content"},Ie={class:"container-fluid"},Se={class:"card shadow-sm rounded-lg"},Ve={class:"card-body p-3"},Pe={class:"input-group mb-3"},Te={class:"input-group-append"},Me={key:0,class:"text-center p-5"},Le=l(()=>e("div",{class:"spinner-border text-primary mb-2",role:"status"},null,-1)),Be=l(()=>e("div",{class:"text-muted"},"Memuat dokumen...",-1)),$e=[Le,Be],Ne={key:1,class:"tree"},Re={class:"list-unstyled mb-0"},je={class:"d-flex align-items-center justify-between cursor-pointer py-1 px-2 bg-light rounded small"},qe=["onClick"],ze={class:"ml-2 font-weight-bold"},Ae={class:"badge badge-pill badge-primary ml-2"},Ee=["onClick"],Ge={class:"pl-4 mt-1"},Oe={class:"d-flex align-items-center justify-content-between w-100"},Je=["onClick"],Ke=l(()=>e("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),Qe=["onClick"],He={key:0,class:"text-danger mt-1 ml-4 small"},We=l(()=>e("i",{class:"fas fa-info-circle"},null,-1)),Xe={key:0,class:"text-muted small ml-4 mt-1"},Ye={key:2,class:"text-center p-5"},Ze=l(()=>e("span",{class:"text-muted"},"Data tidak ditemukan.",-1)),et=[Ze],tt={key:0,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},st={class:"modal-dialog modal-xl"},at={class:"modal-content"},lt={class:"modal-header p-2"},ot=l(()=>e("h5",{class:"modal-title"},"ðŸ“„ Preview Dokumen",-1)),nt=l(()=>e("span",null,"Ã—",-1)),dt=[nt],it={class:"modal-body p-3"},rt={class:"row"},ct={class:"col-md-6 mb-3"},ut={class:"table table-sm table-bordered"},_t=l(()=>e("th",{style:{width:"40%"}},"Tipe Dokumen",-1)),mt=l(()=>e("th",null,"Nomor Dokumen",-1)),pt=l(()=>e("th",null,"Tanggal Dokumen",-1)),vt=l(()=>e("th",null,"Parameter",-1)),ht=l(()=>e("th",null,"Status",-1)),ft={key:0},bt=l(()=>e("th",null,"Catatan Verifikator",-1)),gt={class:"text-danger"},yt=l(()=>e("h6",{class:"text-secondary mb-2"},[e("i",{class:"fas fa-clipboard-check mr-1"}),h(" Riwayat Verifikasi ")],-1)),xt={key:0,class:"text-muted small d-flex align-items-center"},kt=l(()=>e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1)),wt={key:1,class:"list-group list-group-unbordered small mb-2"},Dt={class:"font-weight-bold text-sm"},Ct=l(()=>e("span",{class:"text-muted mx-1"},"oleh",-1)),Ut={class:"font-italic text-sm"},Ft={class:"text-muted"},It={key:0,class:"text-danger mt-1 small"},St=l(()=>e("i",{class:"fas fa-comment-dots mr-1"},null,-1)),Vt={key:2,class:"text-muted small"},Pt={class:"col-md-6"},Tt=["src"],Mt={key:1,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},Lt={class:"modal-dialog modal-lg"},Bt={class:"modal-content"},$t={class:"modal-header"},Nt={class:"modal-title"},Rt=l(()=>e("span",null,"Ã—",-1)),jt=[Rt],qt={class:"modal-body"},zt=["value"],At={class:"form-group"},Et=l(()=>e("label",null,"Tipe Dokumen",-1)),Gt=["value"],Ot={class:"form-group"},Jt=l(()=>e("label",null,"Nomor Dokumen",-1)),Kt={class:"form-group"},Qt=l(()=>e("label",null,"Tanggal Dokumen",-1)),Ht={class:"form-group"},Wt=l(()=>e("label",null,"Parameter (Opsional)",-1)),Xt={class:"form-group"},Yt=l(()=>e("label",null,"Pilih File (PDF)",-1)),Zt={key:0,class:"mb-3"},es={class:"progress",style:{height:"20px"}},ts={class:"text-right"},ss=["disabled"],as={key:0},ls=l(()=>e("i",{class:"fas fa-spinner fa-spin"},null,-1)),os={key:1},ns={__name:"AdminDocumentViewer",props:{userId:Number},setup(g){const B=_e(),C=()=>{B.back()},y=g,k=_([]),U=_(null),F=_(""),$=_(!1),p=_(null),I=_(!1),f=_(null),w=_(!1),b=_(0),q=_(""),S=_([]),N=_(!1),i=_({doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}),z=xe(),A=async t=>{const s=await M.get(`/api/user-documents/${t}`);return q.value=s.data.user.name,s.data.data},E=async()=>{$.value=!0,await z.getDoctypeList(y.userId);const t=await A(y.userId),s=z.doctypeList;k.value=s.map(u=>{const r=t.filter(c=>c.id_doc_type===u.id||c.doc_type_id===u.id).sort((c,x)=>c.file_name.localeCompare(x.file_name));return{id:u.id,text:u.text,expanded:!0,files:r}}),$.value=!1},se=async t=>{const u=(await A(y.userId)).filter(c=>c.id_doc_type===t||c.doc_type_id===t).sort((c,x)=>c.file_name.localeCompare(x.file_name)),r=k.value.find(c=>c.id===t);r&&(r.files=u)},ae=Z(()=>b.value<30?"bg-danger":b.value<70?"bg-warning":"bg-success"),G=Z(()=>{if(!F.value)return k.value;const t=F.value.toLowerCase();return k.value.filter(s=>s.text.toLowerCase().includes(t)||s.files.some(u=>u.file_name.toLowerCase().includes(t)))}),O=t=>{switch(t){case"Approved":return"badge-success";case"Rejected":return"badge-danger";default:return"badge-secondary"}},le=t=>{t.expanded=!t.expanded},oe=async t=>{N.value=!0;try{const s=await M.get(`/api/document-log/${t}`);S.value=s.data.data||[]}catch(s){console.error("Gagal mengambil log verval:",s),S.value=[]}finally{N.value=!1}},ne=async t=>{p.value=t,U.value=t.file_url,await oe(t.id)},de=t=>{f.value=t,I.value=!0,i.value={doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}},ie=(t,s)=>{f.value=s,I.value=!0,i.value={doc_number:t.doc_number||"",doc_date:t.doc_date||"",parameter:t.parameter||"",file:null,file_id:t.id}},J=()=>{I.value=!1},re=t=>{const s=t.target.files[0];if(!s||s.type!=="application/pdf"||s.size>1024*1024){L.fire({icon:"error",title:"File Tidak Valid",text:"File harus PDF dan ukuran maksimal 1MB."}),t.target.value="";return}i.value.file=s},ce=async()=>{var s,u;if(!i.value.file&&!i.value.file_id)return L.fire({icon:"warning",title:"File Belum Dipilih"});w.value=!0;const t=new FormData;t.append("doc_number",i.value.doc_number),t.append("doc_date",i.value.doc_date),t.append("parameter",i.value.parameter),i.value.file&&t.append("file",i.value.file),t.append("id_doc_type",f.value.id),t.append("user_id",y.userId);try{i.value.file_id?await M.post(`/api/reupload-document/${i.value.file_id}`,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{r.total&&(b.value=Math.round(r.loaded*100/r.total))}}):await M.post("/api/upload-document",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{r.total&&(b.value=Math.round(r.loaded*100/r.total))}}),L.fire({icon:"success",title:"Upload Berhasil",timer:1500}),await se(f.value.id),J()}catch(r){const c=((u=(s=r.response)==null?void 0:s.data)==null?void 0:u.message)||"Terjadi kesalahan.";L.fire({icon:"error",title:"Upload Gagal",text:c})}finally{w.value=!1,b.value=0}};return te(E),me(()=>y.userId,E),(t,s)=>{var u,r,c,x,K,Q,H,W,X,Y;return o(),n(P,null,[e("section",ke,[e("div",we,[e("h3",De,[h("ðŸ“‚ Dokumen "),e("small",Ce,d(q.value),1)]),e("button",{class:"btn btn-sm btn-secondary mt-2",onClick:C},[Ue,h(" Kembali ")])])]),e("section",Fe,[e("div",Ie,[e("div",Se,[e("div",Ve,[e("div",Pe,[D(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>F.value=a),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[V,F.value]]),e("div",Te,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[1]||(s[1]=(...a)=>t.clearSearch&&t.clearSearch(...a))},"Reset")])]),$.value?(o(),n("div",Me,$e)):G.value.length?(o(),n("div",Ne,[e("ul",Re,[(o(!0),n(P,null,j(G.value,(a,R)=>(o(),n("li",{key:a.id,class:"mb-2"},[e("div",je,[e("div",{onClick:m=>le(a),class:"flex-grow-1 d-flex align-items-center"},[e("i",{class:T([a.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),e("span",ze,[h(d(R+1)+". "+d(a.text)+" ",1),e("span",Ae,d(a.files.length),1)])],8,qe),e("button",{class:"btn btn-sm btn-success ml-2",onClick:m=>de(a)},"+ Upload",8,Ee)]),D(e("ul",Ge,[(o(!0),n(P,null,j(a.files,m=>(o(),n("li",{key:m.id,class:"cursor-pointer p-1 rounded hover-bg-light small"},[e("div",Oe,[e("div",{onClick:ue=>ne(m),class:"d-flex align-items-center"},[Ke,e("span",null,d(m.file_name),1),e("span",{class:T(["badge badge-sm ml-2",O(m.status)])},d(m.status||"Pending"),3)],8,Je),m.status==="Rejected"?(o(),n("button",{key:0,class:"btn btn-sm btn-outline-danger ml-2",onClick:ue=>ie(m,a)},"Reupload",8,Qe)):v("",!0)]),m.status==="Rejected"&&m.verif_notes?(o(),n("div",He,[We,h(" Catatan: "+d(m.verif_notes),1)])):v("",!0)]))),128)),a.files.length?v("",!0):(o(),n("li",Xe," Tidak ada file diupload. "))],512),[[pe,a.expanded]])]))),128))])])):(o(),n("div",Ye,et))])])])]),U.value?(o(),n("div",tt,[e("div",st,[e("div",at,[e("div",lt,[ot,e("button",{type:"button",class:"close",onClick:s[2]||(s[2]=a=>{U.value=null,p.value=null})},dt)]),e("div",it,[e("div",rt,[e("div",ct,[e("table",ut,[e("tbody",null,[e("tr",null,[_t,e("td",null,d(((u=p.value)==null?void 0:u.doc_type_text)||"â€”"),1)]),e("tr",null,[mt,e("td",null,d(((r=p.value)==null?void 0:r.doc_number)||"â€”"),1)]),e("tr",null,[pt,e("td",null,d(((c=p.value)==null?void 0:c.doc_date)||"â€”"),1)]),e("tr",null,[vt,e("td",null,d(((x=p.value)==null?void 0:x.parameter)||"â€”"),1)]),e("tr",null,[ht,e("td",null,[e("span",{class:T(["badge",O((K=p.value)==null?void 0:K.status)])},d(((Q=p.value)==null?void 0:Q.status)||"Pending"),3)])]),(H=p.value)!=null&&H.verif_notes?(o(),n("tr",ft,[bt,e("td",gt,d(p.value.verif_notes),1)])):v("",!0)])]),yt,N.value?(o(),n("div",xt,[kt,h(" Mengambil data... ")])):S.value.length?(o(),n("ul",wt,[(o(!0),n(P,null,j(S.value,(a,R)=>(o(),n("li",{key:R,class:"list-group-item py-2 px-2",style:{"line-height":"1.4"}},[e("div",null,[e("span",Dt,d(a.status),1),Ct,e("span",Ut,d(a.verifier_name),1),e("small",Ft," pada "+d(a.verified_at),1)]),a.notes?(o(),n("div",It,[St,h(d(a.notes),1)])):v("",!0)]))),128))])):(o(),n("div",Vt,"Tidak ada log verifikasi."))]),e("div",Pt,[e("iframe",{src:`${U.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",style:{height:"70vh",border:"1px solid #ccc"}},null,8,Tt)])])])])])])):v("",!0),I.value?(o(),n("div",Mt,[e("div",Lt,[e("div",Bt,[e("div",$t,[e("h5",Nt,"Upload Dokumen: "+d((W=f.value)==null?void 0:W.text),1),e("button",{type:"button",class:"close",onClick:J},jt)]),e("div",qt,[e("form",{onSubmit:ve(ce,["prevent"])},[e("input",{type:"hidden",value:(X=f.value)==null?void 0:X.id},null,8,zt),e("div",At,[Et,e("input",{type:"text",class:"form-control",value:(Y=f.value)==null?void 0:Y.text,readonly:""},null,8,Gt)]),e("div",Ot,[Jt,D(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>i.value.doc_number=a),type:"text",class:"form-control",required:""},null,512),[[V,i.value.doc_number]])]),e("div",Kt,[Qt,D(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>i.value.doc_date=a),type:"date",class:"form-control",required:""},null,512),[[V,i.value.doc_date]])]),e("div",Ht,[Wt,D(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>i.value.parameter=a),type:"text",class:"form-control"},null,512),[[V,i.value.parameter]])]),e("div",Xt,[Yt,e("input",{onChange:re,type:"file",class:"form-control",accept:"application/pdf",required:""},null,32)]),w.value?(o(),n("div",Zt,[e("div",es,[e("div",{class:T(["progress-bar progress-bar-striped progress-bar-animated",ae.value]),role:"progressbar",style:he({width:b.value+"%"})},d(b.value)+"% ",7)])])):v("",!0),e("div",ts,[e("button",{type:"submit",class:"btn btn-primary",disabled:w.value},[w.value?(o(),n("span",as,[ls,h(" Uploading...")])):(o(),n("span",os,"Upload"))],8,ss)])],32)])])])])):v("",!0)],64)}}},ds=ee(ns,[["__scopeId","data-v-cf0307e0"]]),is={__name:"UserDocs",setup(g){const B=ge(),C=_(null);return te(()=>{C.value=parseInt(B.params.id,10)}),(y,k)=>(o(),ye(ds,{userId:C.value},null,8,["userId"]))}},ms=ee(is,[["__scopeId","data-v-c53bb1c5"]]);export{ms as default};
