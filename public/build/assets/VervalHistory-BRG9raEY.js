import{u as J,e as o,z as K,E as L,f as O,c as d,o as i,b as Q,a as e,j as p,v as g,G as W,F as b,H as R,t as n,n as h,i as y,x as X,d as Y,s as Z,I as F}from"./app-mnDyD8sC.js";import{u as ee}from"./toastr-Cs5apmrc.js";import{f as te}from"./helper-D4kaxrhs.js";const se={class:"content"},ae={class:"container-fluid"},le={class:"card"},ne={class:"card-header"},oe={class:"row"},de={class:"col-md-4 mb-2"},ie={class:"col-md-3 mb-2"},ue=["value"],re={class:"col-md-2 mb-2"},ce={class:"col-md-2 mb-2"},ve={class:"card-body table-responsive p-0"},me={class:"table table-bordered table-hover text-sm"},pe={key:0},_e={key:1},fe=["innerHTML"],ge={class:"text-muted"},be={class:"text-muted"},he=["onClick"],ye={class:"text-center"},ke=["href"],xe={class:"card-footer clearfix"},Ce={class:"d-flex justify-content-between align-items-center"},Ue={class:"text-muted"},Ve={class:"pagination pagination-sm m-0"},Me={class:"page-item disabled"},Ne={class:"page-link"},Se={class:"modal fade",id:"notesModal",tabindex:"-1",role:"dialog"},Te={class:"modal-dialog",role:"document"},Ae={class:"modal-content"},Le={class:"modal-body"},Re={style:{"white-space":"pre-wrap"}},Be={__name:"VervalHistory",setup(Fe){const H=ee();J();const _=o([]),l=o({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),f=o(!1),r=o(""),c=o(""),j=["Approved","Rejected","Uploaded by Admin","Reuploaded by Admin"],v=o(""),m=o(""),k=o(""),D=a=>te(a),B=K(()=>(l.value.current_page-1)*(l.value.per_page||10)),I=a=>`/api/preview/pdf?path=${encodeURI(a)}`,P=a=>{if(!a)return"#";var t=I(a);return t},z=a=>{switch(a){case"Approved":return"badge-success";case"Rejected":return"badge-danger";case"Reuploaded":case"Reuploaded by Admin":return"badge-warning";case"Uploaded":case"Uploaded by Admin":return"badge-info";default:return"badge-secondary"}},E=a=>a?a.length>40?a.slice(0,40)+"…":a:"-",G=a=>{k.value=(a==null?void 0:a.verif_notes)||"",$("#notesModal").modal("show")},u=async(a=1)=>{f.value=!0;try{const{data:t}=await X.get("/api/verval-logs",{params:{page:a,per_page:l.value.per_page,search:r.value||void 0,status:c.value||void 0,date_from:v.value||void 0,date_to:m.value||void 0}});_.value=(t==null?void 0:t.data)||[],l.value={...l.value,...t==null?void 0:t.meta,...t}}catch{H.error("Gagal memuat verval history")}finally{f.value=!1}},w=()=>{r.value="",c.value="",v.value="",m.value="",u(1)};return L(r,F(()=>u(1),350)),L([c,v,m],F(()=>u(1),350)),O(()=>{u()}),(a,t)=>(i(),d(b,null,[t[14]||(t[14]=Q('<section class="content-header"><div class="container-fluid"><div class="d-flex justify-content-between align-items-center"><h1 class="mb-2">Verval History Saya</h1><small class="text-muted">Log verifikasi yang saya lakukan</small></div></div></section>',1)),e("section",se,[e("div",ae,[e("div",le,[e("div",ne,[e("div",oe,[e("div",de,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),type:"text",class:"form-control",placeholder:"Cari nomor, nama pegawai, NIP, file, catatan…"},null,512),[[g,r.value]])]),e("div",ie,[p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>c.value=s),class:"form-control"},[t[6]||(t[6]=e("option",{value:""},"— Semua Status —",-1)),(i(),d(b,null,R(j,s=>e("option",{key:s,value:s},n(s),9,ue)),64))],512),[[W,c.value]])]),e("div",re,[p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),type:"date",class:"form-control"},null,512),[[g,v.value]])]),e("div",ce,[p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>m.value=s),type:"date",class:"form-control"},null,512),[[g,m.value]])]),e("div",{class:"col-md-1 mb-2"},[e("button",{class:"btn btn-secondary btn-block",onClick:w},"Reset")])])]),e("div",ve,[e("table",me,[t[11]||(t[11]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"50px"}},"#"),e("th",null,"Tanggal"),e("th",null,"Dokumen"),e("th",null,"Pemilik"),e("th",null,"Status"),e("th",null,"Catatan"),e("th",{style:{width:"70px"}},"File")])],-1)),e("tbody",null,[f.value?(i(),d("tr",pe,t[7]||(t[7]=[e("td",{colspan:"7",class:"text-center"},"Memuat data…",-1)]))):_.value.length===0?(i(),d("tr",_e,t[8]||(t[8]=[e("td",{colspan:"7",class:"text-center"},"Belum ada log verifikasi.",-1)]))):(i(!0),d(b,{key:2},R(_.value,(s,q)=>{var x,C,U,V,M,N,S,T,A;return i(),d("tr",{key:s.id},[e("td",null,n(q+1+B.value),1),e("td",null,[e("div",null,n(D(s.created_at)),1)]),e("td",null,[e("div",null,[e("strong",null,n(((C=(x=s.document)==null?void 0:x.doctype)==null?void 0:C.type_name)||"-"),1),t[9]||(t[9]=Y(" · ")),e("span",{innerHTML:((U=s.document)==null?void 0:U.parameter)||"<i>n/a</i>"},null,8,fe)]),e("small",ge,n(((V=s.document)==null?void 0:V.file_name)||"-"),1)]),e("td",null,[e("div",null,[e("strong",null,n(((N=(M=s.document)==null?void 0:M.employee)==null?void 0:N.full_name)||"-"),1)]),e("small",be,n(((T=(S=s.document)==null?void 0:S.employee)==null?void 0:T.nip)||"-"),1)]),e("td",null,[e("span",{class:h(["badge",z(s.verval_status)])},n(s.verval_status),3)]),e("td",null,[e("a",{href:"#",onClick:y(He=>G(s),["prevent"])},n(E(s.verif_notes)),9,he)]),e("td",ye,[(A=s.document)!=null&&A.file_path?(i(),d("a",{key:0,href:P(s.document.file_path),target:"_blank",title:"Lihat file"},t[10]||(t[10]=[e("i",{class:"fas fa-file"},null,-1)]),8,ke)):Z("",!0)])])}),128))])])]),e("div",xe,[e("div",Ce,[e("div",Ue," Menampilkan "+n(l.value.from)+" - "+n(l.value.to)+" dari "+n(l.value.total)+" log ",1),e("ul",Ve,[e("li",{class:h(["page-item",{disabled:l.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=y(s=>u(l.value.current_page-1),["prevent"]))},"«")],2),e("li",Me,[e("span",Ne," Halaman "+n(l.value.current_page)+" / "+n(l.value.last_page),1)]),e("li",{class:h(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[5]||(t[5]=y(s=>u(l.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Se,[e("div",Te,[e("div",Ae,[t[12]||(t[12]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Catatan Verifikasi"),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",Le,[e("p",Re,n(k.value||"-"),1)]),t[13]||(t[13]=e("div",{class:"modal-footer py-2"},[e("button",{type:"button",class:"btn btn-default btn-sm","data-dismiss":"modal"},"Tutup")],-1))])])])])],64))}};export{Be as default};
