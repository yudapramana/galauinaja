import{g as c,u as J,x as C,y as z,c as d,a as t,j as i,v as r,l as A,F as f,z as j,t as l,A as N,i as y,b as T,B as k,s as G,m as b,o as u,C as I}from"./app-DKYEko9h.js";import{u as H}from"./MasterDataStore-B9FbAySm.js";import"./LoadingStore-BQPl8X7A.js";const W=t("h1",{class:"mb-2"},"Daftar Pengguna",-1),Y={class:"content"},O={class:"container-fluid"},Q={class:"card"},R={class:"card-header"},X={class:"card-body table-responsive p-0"},Z={class:"table table-bordered table-hover text-sm"},tt=t("thead",{class:"thead-light"},[t("tr",null,[t("th",{style:{width:"40px"}},"#"),t("th",null,"Nama"),t("th",null,"Jabatan"),t("th",null,"NIP"),t("th",null,"Unit Kerja"),t("th",null,"Status"),t("th",null,"Aksi")])],-1),et={key:0},st=t("td",{colspan:"7",class:"text-center"},"Memuat data...",-1),at=[st],ot={key:1},lt=t("td",{colspan:"7",class:"text-center"},"Tidak ada data pengguna ditemukan.",-1),nt=[lt],it=["onClick"],dt=["onClick"],rt={class:"card-footer clearfix"},ut={class:"d-flex justify-content-between align-items-center"},ct={class:"text-muted"},mt={class:"pagination pagination-sm m-0"},_t={class:"page-item disabled"},pt={class:"page-link"},vt={class:"modal fade",id:"userModal",tabindex:"-1",role:"dialog"},bt={class:"modal-dialog modal-lg",role:"document"},gt={class:"modal-content"},ht={class:"modal-header py-2"},ft={class:"modal-title",id:"userModalLabel"},yt=t("i",{class:"fas fa-user-edit me-2"},null,-1),kt=t("button",{type:"button",class:"close","data-dismiss":"modal"},[t("span",null,"×")],-1),wt={class:"modal-body pt-2"},Ut={class:"row"},xt={class:"col-md-6"},Pt={class:"form-group mb-2"},Mt=t("label",{class:"mb-1"},"Nama",-1),Vt={class:"form-group mb-2"},St=t("label",{class:"mb-1"},"Email",-1),Ct={class:"form-group mb-2"},jt=t("label",{class:"mb-1"},"NIP",-1),Nt={class:"form-group mb-2"},Tt=t("label",{class:"mb-1"},"Tanggal Lahir",-1),Lt={class:"form-group mb-2"},$t=t("label",{class:"mb-1"},"Jenis Kelamin",-1),Dt=t("option",{value:"M"},"Laki-laki",-1),Et=t("option",{value:"F"},"Perempuan",-1),qt=[Dt,Et],Ft={class:"form-group mb-2"},Kt=t("label",{class:"mb-1"},"Password",-1),Bt=["required"],Jt={class:"col-md-6"},zt={class:"form-group mb-2"},At=t("label",{class:"mb-1"},"Jabatan",-1),Gt={class:"form-group mb-2"},It=t("label",{class:"mb-1"},"TMT Jabatan",-1),Ht={class:"form-group mb-2"},Wt=t("label",{class:"mb-1"},"Unit Kerja",-1),Yt=["value"],Ot={class:"form-group mb-2"},Qt=t("label",{class:"mb-1"},"Status",-1),Rt=t("option",{value:"PNS"},"PNS",-1),Xt=t("option",{value:"PPPK"},"PPPK",-1),Zt=[Rt,Xt],te={class:"form-group mb-2"},ee=t("label",{class:"mb-1"},"TMT Pangkat",-1),se={class:"text-end mt-3"},ae=["disabled"],oe={key:0,class:"fas fa-spinner fa-spin me-1"},le={key:1,class:"fas fa-save me-1"},ue={__name:"UserList",setup(ne){const p=c(!1),w=H(),L=J(),g=c([]),o=c({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),v=c(""),h=c(!1),_=c(!1),a=c({}),m=async(n=1)=>{h.value=!0;try{const e=await b.get("/api/users",{params:{page:n,search:v.value}});g.value=e.data.data,o.value={...o.value,...e.data.meta,...e.data}}catch(e){e.response&&e.response.status===401?(console.warn("Unauthorized. Logging out..."),L.logout()):console.error("Gagal memuat data pengguna:",e)}finally{h.value=!1}},D=()=>{_.value=!1,a.value={},$("#userModal").modal("show")},E=n=>{var e;_.value=!0,a.value={...n,...n.employee,id_work_unit:(e=n.employee)==null?void 0:e.id_work_unit},$("#userModal").modal("show")},q=async()=>{p.value=!0;try{_.value?await b.put(`/api/users/${a.value.id}`,a.value):await b.post("/api/users",a.value),m(),$("#userModal").modal("hide")}catch(n){alert("Gagal menyimpan data: "+n)}finally{p.value=!1}},F=async n=>{if(confirm("Yakin ingin menghapus pengguna ini?"))try{await b.delete(`/api/users/${n}`),m()}catch{alert("Gagal menghapus pengguna")}};return C(v,I(()=>m(1),400)),C(()=>a.nip,n=>{a.username=n}),z(()=>{m(),w.getWorkunitList()}),(n,e)=>(u(),d(f,null,[t("section",{class:"content-header"},[t("div",{class:"container-fluid"},[t("div",{class:"d-flex justify-content-between align-items-center"},[W,t("button",{class:"btn btn-primary btn-sm",onClick:D},"+ Tambah Pengguna")])])]),t("section",Y,[t("div",O,[t("div",Q,[t("div",R,[i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),type:"text",class:"form-control",placeholder:"Cari nama, email, NIP, atau unit kerja..."},null,512),[[r,v.value]])]),t("div",X,[t("table",Z,[tt,t("tbody",null,[h.value?(u(),d("tr",et,at)):g.value.length===0?(u(),d("tr",ot,nt)):A("",!0),(u(!0),d(f,null,j(g.value,(s,K)=>{var U,x,P,M,V,S;return u(),d("tr",{key:s.id},[t("td",null,l(K+1+(o.value.current_page-1)*o.value.per_page),1),t("td",null,[t("strong",null,l(((U=s.employee)==null?void 0:U.full_name)||s.name),1)]),t("td",null,l(((x=s.employee)==null?void 0:x.job_title)||"-"),1),t("td",null,l(((P=s.employee)==null?void 0:P.nip)||"-"),1),t("td",null,l(((V=(M=s.employee)==null?void 0:M.work_unit)==null?void 0:V.unit_name)||"-"),1),t("td",null,l(((S=s.employee)==null?void 0:S.employment_status)||"-"),1),t("td",null,[t("button",{class:"btn btn-sm btn-warning mr-1",onClick:B=>E(s)},"Edit",8,it),t("button",{class:"btn btn-sm btn-danger",onClick:B=>F(s.id)},"Hapus",8,dt)])])}),128))])])]),t("div",rt,[t("div",ut,[t("div",ct," Menampilkan "+l(o.value.from)+" - "+l(o.value.to)+" dari "+l(o.value.total)+" pengguna ",1),t("ul",mt,[t("li",{class:N(["page-item",{disabled:o.value.current_page===1}])},[t("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=y(s=>m(o.value.current_page-1),["prevent"]))},"«")],2),t("li",_t,[t("span",pt," Halaman "+l(o.value.current_page)+" / "+l(o.value.last_page),1)]),t("li",{class:N(["page-item",{disabled:o.value.current_page===o.value.last_page}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=y(s=>m(o.value.current_page+1),["prevent"]))},"»")],2)])])])])]),t("div",vt,[t("div",bt,[t("div",gt,[t("div",ht,[t("h5",ft,[yt,T(l(_.value?"Edit Pengguna":"Tambah Pengguna"),1)]),kt]),t("div",wt,[t("form",{onSubmit:y(q,["prevent"])},[t("div",Ut,[t("div",xt,[t("div",Pt,[Mt,i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.full_name=s),class:"form-control form-control-sm",required:""},null,512),[[r,a.value.full_name]])]),t("div",Vt,[St,i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.email=s),class:"form-control form-control-sm",required:""},null,512),[[r,a.value.email]])]),t("div",Ct,[jt,i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.nip=s),class:"form-control form-control-sm",required:""},null,512),[[r,a.value.nip]])]),t("div",Nt,[Tt,i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.date_of_birth=s),type:"date",class:"form-control form-control-sm"},null,512),[[r,a.value.date_of_birth]])]),t("div",Lt,[$t,i(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.gender=s),class:"form-control form-control-sm"},qt,512),[[k,a.value.gender]])]),t("div",Ft,[Kt,i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.password=s),type:"password",class:"form-control form-control-sm",required:!_.value},null,8,Bt),[[r,a.value.password]])])]),t("div",Jt,[t("div",zt,[At,i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.job_title=s),class:"form-control form-control-sm"},null,512),[[r,a.value.job_title]])]),t("div",Gt,[It,i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.tmt_jabatan=s),type:"date",class:"form-control form-control-sm"},null,512),[[r,a.value.tmt_jabatan]])]),t("div",Ht,[Wt,i(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.id_work_unit=s),class:"form-control form-control-sm"},[(u(!0),d(f,null,j(G(w).workunitList,s=>(u(),d("option",{key:s.id,value:s.id},l(s.text),9,Yt))),128))],512),[[k,a.value.id_work_unit]])]),t("div",Ot,[Qt,i(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>a.value.employment_status=s),class:"form-control form-control-sm"},Zt,512),[[k,a.value.employment_status]])]),t("div",te,[ee,i(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.tmt_pangkat=s),type:"date",class:"form-control form-control-sm"},null,512),[[r,a.value.tmt_pangkat]])])])]),t("div",se,[t("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:p.value},[p.value?(u(),d("i",oe)):(u(),d("i",le)),T(" Simpan ")],8,ae)])],32)])])])])])],64))}};export{ue as default};
