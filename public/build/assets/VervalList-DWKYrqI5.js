import{r as d,A as T,B as H,f as le,c as o,o as r,a as e,t as l,s as k,d as D,k as V,v as U,F as G,C as z,n as M,j as I,D as ie,x as b,E as oe}from"./app-2Lg8Ay2c.js";import{S as f}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const re={class:"content-header"},de={class:"container-fluid d-flex justify-content-between align-items-end"},ue={class:"d-flex align-items-center"},me={class:"badge badge-info mr-3"},ce={class:"btn-group"},pe=["disabled"],ve={key:0,class:"fas fa-spinner fa-spin mr-1"},fe={class:"content"},ge={class:"container-fluid"},ke={class:"card"},be={class:"card-header d-flex"},_e={class:"card-body table-responsive p-0"},he={class:"table table-bordered table-hover text-sm"},ye={key:0},xe={key:1},we={class:"text-truncate",style:{"max-width":"240px"}},De=["onClick"],Ce=["onClick","disabled"],Ae={key:0,class:"fas fa-spinner fa-spin mr-1"},Pe={class:"card-footer clearfix"},Ve={class:"d-flex justify-content-between align-items-center"},Ge={class:"text-muted"},Me={class:"pagination pagination-sm m-0"},Ie={class:"page-item disabled"},Ne={class:"page-link"},je={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},Fe={class:"modal-dialog modal-xl",role:"document"},Se={class:"modal-content"},Le={class:"modal-body row"},Re={class:"col-md-7"},$e={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},Be=["src"],Ee={key:1,class:"text-muted text-center py-5"},Te={key:0},He={key:1},Ue={class:"col-md-5"},ze={class:"mb-3"},Je={class:"table table-bordered table-sm"},qe=["innerHTML"],Ke={style:{"font-size":"smaller"}},Oe={class:"form-group"},Ye={key:0,class:"form-group"},Qe=["value"],We={class:"form-group"},Xe={class:"text-end mt-3"},Ze=["disabled"],ea={key:0,class:"fas fa-spinner fa-spin me-1"},na={__name:"VervalList",setup(aa){const _=d(""),g=d([]),C=d(!1),h=d(!1),y=d(!1),x=d(null),w=d(null),J=T(()=>w.value===null?"—":w.value),q=d(null),c=d(!1),u=d(null),m=d({status:"",verif_notes:""}),K=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),O=T(()=>{var a;const t=(a=u.value)==null?void 0:a.file_url;return t?K?`https://docs.google.com/gview?url=${encodeURIComponent(t)}`:t:""}),i=d({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),Y=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],A=async(t=1)=>{C.value=!0;try{const a=await b.get("/api/emp-documents",{params:{search:_.value,page:t,per_page:i.value.per_page}});g.value=a.data.data||[],i.value={...i.value,...a.data.meta,...a.data}}catch(a){console.error("Gagal memuat dokumen",a)}finally{C.value=!1}},Q=async()=>{try{const{data:t}=await b.get("/api/emp-documents/remaining");w.value=typeof(t==null?void 0:t.remaining)=="number"?t.remaining:null}catch{w.value=null}},p=async()=>{await Promise.all([A(i.value.current_page),Q()])},W=async()=>{var t,a;y.value=!0;try{const{data:n}=await b.post("/api/emp-documents/claim",{count:5});await p();const v=(n==null?void 0:n.claimed)??(Array.isArray(n==null?void 0:n.data)?n.data.length:n!=null&&n.data?1:0);f.fire({icon:"success",title:"Berhasil",text:`${v} dokumen berhasil diambil dari antrian.`,timer:1800,showConfirmButton:!1}),Array.isArray(n==null?void 0:n.data)&&n.data.length?P(n.data[0]):g.value.length&&P(g.value[0])}catch(n){const v=((a=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:a.message)||"Tidak ada dokumen tersedia untuk di-claim";f.fire({icon:"info",title:"Info",text:v})}finally{y.value=!1}},X=async t=>{if(!(!(t!=null&&t.id)||!confirm("Lepaskan assignment dokumen ini? Dokumen akan kembali ke antrian umum."))){x.value=t.id;try{await b.post(`/api/emp-documents/${t.id}/release`),await p(),f.fire({icon:"success",title:"Dilepas",text:"Dokumen berhasil dilepas dari tugas Anda.",timer:1500,showConfirmButton:!1})}catch{f.fire({icon:"error",title:"Gagal",text:"Gagal melepas dokumen."})}finally{x.value=null}}},N=t=>{t>=1&&t<=i.value.last_page&&A(t)},P=t=>{u.value=t,m.value={status:t.status==="Pending"?"Approved":t.status,verif_notes:t.verif_notes||""},$("#verifModal").modal("show")},Z=async()=>{h.value=!0;try{const t=await b.put(`/api/emp-documents/${u.value.id}/verify`,m.value);$("#verifModal").modal("hide"),await p(),f.fire({icon:"success",title:"Berhasil",text:t.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(t){let a="Gagal memverifikasi dokumen.";t.response&&(t.response.status===409&&t.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||t.response.data.message)&&(a=t.response.data.message),f.fire({icon:"error",title:"Verifikasi Gagal",text:a}),$("#verifModal").modal("hide"),await p()}finally{h.value=!1}},ee=t=>{const a=t.target.value;a&&(m.value.verif_notes=a)},ae=()=>{c.value=!1},te=()=>{c.value=!0};return H(()=>{var t;return(t=u.value)==null?void 0:t.file_url},async t=>{var a;if(c.value=!1,!!t)try{const n=await fetch(t,{method:"HEAD"});(!n.ok||!((a=n.headers.get("content-type"))!=null&&a.includes("pdf")))&&(c.value=!0)}catch{c.value=!0}}),H(_,oe(()=>A(1),300)),le(()=>p()),(t,a)=>{var n,v,j,F,S,L,R,B,E;return r(),o(G,null,[e("section",re,[e("div",de,[a[7]||(a[7]=e("h1",{class:"mb-2"},"Verifikasi Dokumen Pegawai",-1)),e("div",ue,[e("span",me," Sisa antrian: "+l(J.value),1),e("div",ce,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:W,disabled:y.value},[y.value?(r(),o("i",ve)):k("",!0),a[6]||(a[6]=D(" Ambil 5 Dokumen "))],8,pe),e("button",{class:"btn btn-secondary btn-sm ml-2",onClick:p}," Refresh ")])])])]),e("section",fe,[e("div",ge,[e("div",ke,[e("div",be,[V(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>_.value=s),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai (tugas saya)..."},null,512),[[U,_.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:p}," Refresh ")]),e("div",_e,[e("table",he,[a[11]||(a[11]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nama File"),e("th",null,"Status"),e("th",{style:{width:"160px"}},"Aksi")])],-1)),e("tbody",null,[C.value?(r(),o("tr",ye,a[8]||(a[8]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):g.value.length===0?(r(),o("tr",xe,a[9]||(a[9]=[e("td",{colspan:"7",class:"text-center"},[D(" Belum ada dokumen yang ditugaskan ke Anda. "),e("br"),e("small",{class:"text-muted"},"Klik “Ambil 5 Dokumen” untuk mengambil dari antrian umum.")],-1)]))):k("",!0),(r(!0),o(G,null,z(g.value,(s,se)=>(r(),o("tr",{key:s.id},[e("td",null,l(se+1+(i.value.current_page-1)*i.value.per_page),1),e("td",null,l(s.employee.full_name),1),e("td",null,l(s.employee.nip),1),e("td",null,l(s.doc_type.type_name),1),e("td",we,l(s.file_name),1),e("td",null,[e("span",{class:M({"badge badge-warning":s.status==="Pending","badge badge-success":s.status==="Approved","badge badge-danger":s.status==="Rejected"})},l(s.status),3)]),e("td",null,[e("button",{class:"btn btn-sm btn-primary mr-1",onClick:ne=>P(s)}," Verifikasi ",8,De),e("button",{class:"btn btn-sm btn-outline-danger",onClick:ne=>X(s),disabled:x.value===s.id,title:"Lepaskan assignment dokumen ini"},[x.value===s.id?(r(),o("i",Ae)):k("",!0),a[10]||(a[10]=D(" Lepas "))],8,Ce)])]))),128))])])]),e("div",Pe,[e("div",Ve,[e("div",Ge," Menampilkan "+l(i.value.from)+" - "+l(i.value.to)+" dari "+l(i.value.total)+" dokumen (tugas saya) ",1),e("ul",Me,[e("li",{class:M(["page-item",{disabled:i.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=I(s=>N(i.value.current_page-1),["prevent"]))},"«")],2),e("li",Ie,[e("span",Ne,"Halaman "+l(i.value.current_page)+" / "+l(i.value.last_page),1)]),e("li",{class:M(["page-item",{disabled:i.value.current_page===i.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=I(s=>N(i.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",je,[e("div",Fe,[e("div",Se,[a[23]||(a[23]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",Le,[e("div",Re,[e("div",$e,[(n=u.value)!=null&&n.file_url&&!c.value?(r(),o("iframe",{key:0,ref_key:"pdfFrame",ref:q,src:O.value,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"},onLoad:ae,onError:te},null,40,Be)):(r(),o("div",Ee,[c.value?(r(),o("p",Te,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses.")):(r(),o("p",He,"File tidak tersedia."))]))])]),e("div",Ue,[e("div",ze,[e("table",Je,[e("tbody",null,[e("tr",null,[a[12]||(a[12]=e("th",null,"Nama",-1)),e("td",null,l(((j=(v=u.value)==null?void 0:v.employee)==null?void 0:j.full_name)||"-"),1)]),e("tr",null,[a[13]||(a[13]=e("th",null,"NIP",-1)),e("td",null,l(((S=(F=u.value)==null?void 0:F.employee)==null?void 0:S.nip)||"-"),1)]),e("tr",null,[a[14]||(a[14]=e("th",null,"Jenis Dokumen",-1)),e("td",null,l(((R=(L=u.value)==null?void 0:L.doc_type)==null?void 0:R.type_name)||"-"),1)]),e("tr",null,[a[15]||(a[15]=e("th",null,"Parameter",-1)),e("td",{innerHTML:((B=u.value)==null?void 0:B.parameter)||"<i>no_param</i>"},null,8,qe)]),e("tr",null,[a[16]||(a[16]=e("th",null,"Filename",-1)),e("td",Ke,l(((E=u.value)==null?void 0:E.file_name)||"-"),1)])])])]),e("form",{onSubmit:I(Z,["prevent"])},[e("div",Oe,[a[18]||(a[18]=e("label",null,"Status Verifikasi",-1)),V(e("select",{"onUpdate:modelValue":a[3]||(a[3]=s=>m.value.status=s),class:"form-control",required:""},a[17]||(a[17]=[e("option",{value:"Approved"},"Disetujui",-1),e("option",{value:"Rejected"},"Ditolak",-1)]),512),[[ie,m.value.status]])]),m.value.status==="Rejected"?(r(),o("div",Ye,[a[20]||(a[20]=e("label",null,"Pilih Alasan Penolakan (opsional)",-1)),e("select",{class:"form-control mb-2",onChange:a[4]||(a[4]=s=>ee(s))},[a[19]||(a[19]=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1)),(r(),o(G,null,z(Y,s=>e("option",{key:s.code,value:s.note},l(s.code)+" - "+l(s.note),9,Qe)),64))],32)])):k("",!0),e("div",We,[a[21]||(a[21]=e("label",null,"Catatan Verifikasi",-1)),V(e("textarea",{"onUpdate:modelValue":a[5]||(a[5]=s=>m.value.verif_notes=s),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[U,m.value.verif_notes]])]),e("div",Xe,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:h.value},[h.value?(r(),o("i",ea)):k("",!0),a[22]||(a[22]=D(" Simpan Verifikasi "))],8,Ze)])],32)])])])])])])],64)}}};export{na as default};
