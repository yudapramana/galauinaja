import{_ as Z,u as ce,r as c,B as Y,C as me,c as o,o as a,a as e,s as _,d as p,t as i,k as x,v as T,F as k,E as V,n as w,S as pe,j as ve,m as fe,L as _e,q as be,x as M,f as ge,U as he,M as ye}from"./app-BWlvjOTp.js";import{S as L}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{u as xe}from"./MasterDataStore-vL-aplhn.js";import"./LoadingStore-Cu-IRJnw.js";const ke={class:"content-header"},we={class:"container-fluid"},Ce={class:"text-primary"},De={class:"text-muted text-sm"},Ue={class:"content"},Fe={class:"container-fluid"},Pe={class:"card shadow-sm rounded-lg"},Se={class:"card-body p-3"},Ie={class:"input-group mb-3"},Te={class:"input-group-append"},Ve={key:0,class:"text-center p-5"},Me={key:1,class:"tree"},Le={class:"list-unstyled mb-0"},$e={class:"d-flex align-items-center justify-between cursor-pointer py-1 px-2 bg-light rounded small"},Be=["onClick"],Ne={class:"ml-2 font-weight-bold"},je={class:"badge badge-pill badge-primary ml-2"},Re=["onClick"],Ae={class:"pl-4 mt-1"},qe={class:"d-flex align-items-center justify-content-between w-100"},Ee=["onClick"],Ke=["onClick"],ze={key:0,class:"text-danger mt-1 ml-4 small"},Ge={key:0,class:"text-muted small ml-4 mt-1"},Je={key:2,class:"text-center p-5"},Oe={key:0,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},Qe={class:"modal-dialog modal-xl"},He={class:"modal-content"},We={class:"modal-header p-2"},Xe={class:"modal-body p-3"},Ye={class:"row"},Ze={class:"col-md-6 mb-3"},et={class:"table table-sm table-bordered"},tt={key:0},st={class:"text-danger"},lt={key:0,class:"text-muted small d-flex align-items-center"},at={key:1,class:"list-group list-group-unbordered small mb-2"},ot={class:"font-weight-bold text-sm"},nt={class:"font-italic text-sm"},it={class:"text-muted"},dt={key:0,class:"text-danger mt-1 small"},rt={key:2,class:"text-muted small"},ut={class:"col-md-6"},ct=["src"],mt={key:1,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},pt={class:"modal-dialog modal-lg modal-dialog-scrollable"},vt={class:"modal-content",style:{"max-height":"90vh",display:"flex","flex-direction":"column"}},ft={class:"modal-header"},_t={class:"modal-title"},bt={class:"modal-body overflow-auto",style:{flex:"1 1 auto"}},gt=["value"],ht={class:"form-group"},yt=["value"],xt={class:"form-group"},kt={class:"form-group"},wt={class:"form-group"},Ct={class:"btn-group mb-2 flex-wrap"},Dt=["onClick"],Ut={class:"input-group mb-3"},Ft={class:"input-group-append"},Pt={class:"form-group"},St={class:"custom-file"},It={class:"custom-file-label",for:"exampleInputFile"},Tt={key:0,class:"mb-3"},Vt={class:"progress",style:{height:"20px"}},Mt=["aria-valuenow"],Lt={class:"modal-footer"},$t=["disabled"],Bt={key:0},Nt={key:1},jt={__name:"AdminDocumentViewer",props:{userId:Number},setup(R){const $=ce(),C=be(),A=()=>{C.back()},g=R,D=c([]),U=c(null),F=c(""),B=c(!1),v=c(null),P=c(!1),b=c(null),y=c(!1),f=c(0),q=c(""),S=c([]),N=c(!1),n=c({doc_number:"",doc_date:"",parameter:"",file:null,fileName:"",file_id:null}),j=xe(),E=async s=>{const t=await M.get(`/api/user-documents/${s}`);return q.value=t.data.user.name,t.data.data},ee=async()=>{B.value=!0,await j.getDoctypeList(g.userId);const s=await E(g.userId),t=j.doctypeList;D.value=t.map(u=>{const r=s.filter(d=>d.id_doc_type===u.id||d.doc_type_id===u.id).sort((d,h)=>d.file_name.localeCompare(h.file_name));return{id:u.id,text:u.text,expanded:!0,files:r.map(d=>({...d,doc_type_text:u.text}))}}),B.value=!1},te=async s=>{const u=(await E(g.userId)).filter(d=>d.id_doc_type===s||d.doc_type_id===s).sort((d,h)=>d.file_name.localeCompare(h.file_name)),r=D.value.find(d=>d.id===s);r&&(r.files=u)},se=Y(()=>f.value<30?"bg-danger":f.value<70?"bg-warning":"bg-success"),K=Y(()=>{if(!F.value)return D.value;const s=F.value.toLowerCase();return D.value.filter(t=>t.text.toLowerCase().includes(s)||t.files.some(u=>u.file_name.toLowerCase().includes(s)))}),z=s=>{switch(s){case"Approved":return"badge-success";case"Rejected":return"badge-danger";default:return"badge-secondary"}},le=s=>{s.expanded=!s.expanded},ae=async s=>{N.value=!0;try{const t=await M.get(`/api/document-log/${s}`);S.value=t.data.data||[]}catch(t){$.handleAuthError(t),S.value=[]}finally{N.value=!1}},oe=async s=>{v.value=s,U.value=s.file_url,await ae(s.id)},ne=s=>{b.value=s,P.value=!0,n.value={doc_number:"",doc_date:"",parameter:"",file:null,file_id:null}},ie=(s,t)=>{b.value=t,P.value=!0,n.value={doc_number:s.doc_number||"",doc_date:s.doc_date||"",parameter:s.parameter||"",file:null,file_id:s.id}},G=()=>{P.value=!1},de=s=>{const t=s.target.files[0];if(!t||t.type!=="application/pdf"||t.size>1024*1024){L.fire({icon:"error",title:"File Tidak Valid",text:"File harus PDF dan ukuran maksimal 1MB."}),s.target.value="",n.value.fileName="";return}n.value.file=t,n.value.fileName=t.name},re=async()=>{var t,u;if(!n.value.file&&!n.value.file_id)return L.fire({icon:"warning",title:"File Belum Dipilih"});y.value=!0;const s=new FormData;s.append("doc_number",n.value.doc_number),s.append("doc_date",n.value.doc_date),s.append("parameter",n.value.parameter),n.value.file&&s.append("file",n.value.file),s.append("id_doc_type",b.value.id),s.append("user_id",g.userId);try{n.value.file_id?await M.post(`/api/reupload-document/${n.value.file_id}`,s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{r.total&&(f.value=Math.round(r.loaded*100/r.total))}}):await M.post("/api/upload-document",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{r.total&&(f.value=Math.round(r.loaded*100/r.total))}}),L.fire({icon:"success",title:"Upload Berhasil",timer:1500}),await te(b.value.id),G()}catch(r){const d=((u=(t=r.response)==null?void 0:t.data)==null?void 0:u.message)||"Terjadi kesalahan.";L.fire({icon:"error",title:"Upload Gagal",text:d})}finally{y.value=!1,f.value=0}};return me(()=>g.userId,ee),(s,t)=>{var u,r,d,h,J,O,Q,H,W,X;return a(),o(k,null,[e("section",ke,[e("div",we,[e("h3",Ce,[t[7]||(t[7]=p("ðŸ“‚ Dokumen ")),e("small",De,i(q.value),1)]),e("button",{class:"btn btn-sm btn-secondary mt-2",onClick:A},t[8]||(t[8]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1),p(" Kembali ")]))])]),e("section",Ue,[e("div",Fe,[e("div",Pe,[e("div",Se,[e("div",Ie,[x(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>F.value=l),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[T,F.value]]),e("div",Te,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[1]||(t[1]=(...l)=>s.clearSearch&&s.clearSearch(...l))},"Reset")])]),B.value?(a(),o("div",Ve,t[9]||(t[9]=[e("div",{class:"spinner-border text-primary mb-2",role:"status"},null,-1),e("div",{class:"text-muted"},"Memuat dokumen...",-1)]))):K.value.length?(a(),o("div",Me,[e("ul",Le,[(a(!0),o(k,null,V(K.value,(l,I)=>(a(),o("li",{key:l.id,class:"mb-2"},[e("div",$e,[e("div",{onClick:m=>le(l),class:"flex-grow-1 d-flex align-items-center"},[e("i",{class:w([l.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),e("span",Ne,[p(i(I+1)+". "+i(l.text)+" ",1),e("span",je,i(l.files.length),1)])],8,Be),e("button",{class:"btn btn-sm btn-success ml-2",onClick:m=>ne(l)},"+ Upload",8,Re)]),x(e("ul",Ae,[(a(!0),o(k,null,V(l.files,m=>(a(),o("li",{key:m.id,class:"cursor-pointer p-1 rounded hover-bg-light small"},[e("div",qe,[e("div",{onClick:ue=>oe(m),class:"d-flex align-items-center"},[t[10]||(t[10]=e("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),e("span",null,i(m.file_name),1),e("span",{class:w(["badge badge-sm ml-2",z(m.status)])},i(m.status||"Pending"),3)],8,Ee),m.status==="Rejected"?(a(),o("button",{key:0,class:"btn btn-sm btn-outline-danger ml-2",onClick:ue=>ie(m,l)},"Reupload",8,Ke)):_("",!0)]),m.status==="Rejected"&&m.verif_notes?(a(),o("div",ze,[t[11]||(t[11]=e("i",{class:"fas fa-info-circle"},null,-1)),p(" Catatan: "+i(m.verif_notes),1)])):_("",!0)]))),128)),l.files.length?_("",!0):(a(),o("li",Ge," Tidak ada file diupload. "))],512),[[pe,l.expanded]])]))),128))])])):(a(),o("div",Je,t[12]||(t[12]=[e("span",{class:"text-muted"},"Data tidak ditemukan.",-1)])))])])])]),U.value?(a(),o("div",Oe,[e("div",Qe,[e("div",He,[e("div",We,[t[14]||(t[14]=e("h5",{class:"modal-title"},"ðŸ“„ Preview Dokumen",-1)),e("button",{type:"button",class:"close",onClick:t[2]||(t[2]=l=>{U.value=null,v.value=null})},t[13]||(t[13]=[e("span",null,"Ã—",-1)]))]),e("div",Xe,[e("div",Ye,[e("div",Ze,[e("table",et,[e("tbody",null,[e("tr",null,[t[15]||(t[15]=e("th",{style:{width:"40%"}},"Tipe Dokumen",-1)),e("td",null,i(((u=v.value)==null?void 0:u.doc_type_text)||"â€”"),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Nomor Dokumen",-1)),e("td",null,i(((r=v.value)==null?void 0:r.doc_number)||"â€”"),1)]),e("tr",null,[t[17]||(t[17]=e("th",null,"Tanggal Dokumen",-1)),e("td",null,i(((d=v.value)==null?void 0:d.doc_date)||"â€”"),1)]),e("tr",null,[t[18]||(t[18]=e("th",null,"Parameter",-1)),e("td",null,i(((h=v.value)==null?void 0:h.parameter)||"â€”"),1)]),e("tr",null,[t[19]||(t[19]=e("th",null,"Status",-1)),e("td",null,[e("span",{class:w(["badge",z((J=v.value)==null?void 0:J.status)])},i(((O=v.value)==null?void 0:O.status)||"Pending"),3)])]),(Q=v.value)!=null&&Q.verif_notes?(a(),o("tr",tt,[t[20]||(t[20]=e("th",null,"Catatan Verifikator",-1)),e("td",st,i(v.value.verif_notes),1)])):_("",!0)])]),t[24]||(t[24]=e("h6",{class:"text-secondary mb-2"},[e("i",{class:"fas fa-clipboard-check mr-1"}),p(" Riwayat Verifikasi ")],-1)),N.value?(a(),o("div",lt,t[21]||(t[21]=[e("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),p(" Mengambil data... ")]))):S.value.length?(a(),o("ul",at,[(a(!0),o(k,null,V(S.value,(l,I)=>(a(),o("li",{key:I,class:"list-group-item py-2 px-2",style:{"line-height":"1.4"}},[e("div",null,[e("span",ot,i(l.status),1),t[22]||(t[22]=e("span",{class:"text-muted mx-1"},"oleh",-1)),e("span",nt,i(l.verifier_name),1),e("small",it," pada "+i(l.verified_at),1)]),l.notes?(a(),o("div",dt,[t[23]||(t[23]=e("i",{class:"fas fa-comment-dots mr-1"},null,-1)),p(i(l.notes),1)])):_("",!0)]))),128))])):(a(),o("div",rt,"Tidak ada log verifikasi."))]),e("div",ut,[e("iframe",{src:`${U.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",style:{height:"70vh",border:"1px solid #ccc"}},null,8,ct)])])])])])])):_("",!0),P.value?(a(),o("div",mt,[e("div",pt,[e("div",vt,[e("div",ft,[e("h5",_t,"Upload Dokumen Pegawai: "+i((H=b.value)==null?void 0:H.text),1),e("button",{type:"button",class:"close",onClick:G},t[25]||(t[25]=[e("span",null,"Ã—",-1)]))]),e("div",bt,[e("form",{onSubmit:ve(re,["prevent"]),id:"uploadForm"},[e("input",{type:"hidden",value:(W=b.value)==null?void 0:W.id},null,8,gt),e("div",ht,[t[26]||(t[26]=e("label",null,"Tipe Dokumen",-1)),e("input",{type:"text",class:"form-control",value:(X=b.value)==null?void 0:X.text,readonly:""},null,8,yt)]),e("div",xt,[t[27]||(t[27]=e("label",null,"Nomor Dokumen",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.doc_number=l),type:"text",class:"form-control",required:"",autofocus:""},null,512),[[T,n.value.doc_number]])]),e("div",kt,[t[28]||(t[28]=e("label",null,"Tanggal Dokumen",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.doc_date=l),type:"date",class:"form-control",required:""},null,512),[[T,n.value.doc_date]])]),e("div",wt,[t[29]||(t[29]=e("label",null,"Pilih Parameter (Opsional)",-1)),t[30]||(t[30]=e("br",null,null,-1)),e("div",Ct,[(a(!0),o(k,null,V(fe(j).docParameters,l=>(a(),o("button",{key:l,type:"button",class:w(["btn btn-xs btn-outline-secondary mb-1",{active:n.value.parameter===l}]),onClick:I=>n.value.parameter=l},i(l),11,Dt))),128))]),e("div",Ut,[x(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.parameter=l),type:"text",class:"form-control",readonly:""},null,512),[[T,n.value.parameter]]),e("div",Ft,[e("button",{type:"button",class:"btn btn-info",onClick:t[6]||(t[6]=l=>n.value.parameter="")},"Reset")])]),t[31]||(t[31]=e("small",{class:"form-text text-muted mb-2"},[e("strong",null,"Info:"),p(" Gunakan parameter diatas jika dokumen pada tipe ini bersifat multiple atau lebih dari satu, seperti "),e("em",null,"Akte Kelahiran Anak"),p(", "),e("em",null,"SKP 2 Tahun Terakhir"),p(", "),e("em",null,"SK Jabatan"),p(", dan sejenisnya. ")],-1))]),e("div",Pt,[t[32]||(t[32]=e("label",null,"Pilih File (PDF)",-1)),e("div",St,[e("input",{type:"file",class:"custom-file-input",id:"exampleInputFile",accept:"application/pdf",onChange:de,required:""},null,32),e("label",It,i(n.value.fileName||"Pilih file"),1)])]),y.value?(a(),o("div",Tt,[e("div",Vt,[e("div",{class:w(["progress-bar progress-bar-striped progress-bar-animated",se.value]),role:"progressbar",style:_e({width:f.value+"%"}),"aria-valuenow":f.value,"aria-valuemin":"0","aria-valuemax":"100"},i(f.value)+"% ",15,Mt)])])):_("",!0)],32)]),e("div",Lt,[e("button",{type:"submit",class:"btn btn-primary",disabled:y.value,form:"uploadForm"},[y.value?(a(),o("span",Bt,t[33]||(t[33]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Uploading... ")]))):(a(),o("span",Nt," Upload "))],8,$t)])])])])):_("",!0)],64)}}},Rt=Z(jt,[["__scopeId","data-v-30c5356d"]]),At={__name:"UserDocs",setup(R){const $=he(),C=c(null);return ge(()=>{C.value=parseInt($.params.id,10)}),(A,g)=>(a(),ye(Rt,{userId:C.value},null,8,["userId"]))}},Gt=Z(At,[["__scopeId","data-v-f467faa0"]]);export{Gt as default};
